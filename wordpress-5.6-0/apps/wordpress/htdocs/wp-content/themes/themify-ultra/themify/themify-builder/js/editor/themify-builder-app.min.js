'use strict';var tb_app;
(function(h,z,v,x,r,p,m,n){"function"===typeof r.document.ondragstart&&(r.document.ondragstart=x.document.ondragstart=null);const I=h.ui.sortable.prototype._mouseStart,C="undefined"!==typeof themifyScript&&themifyScript.is_fullSection;h.ui.sortable.prototype._mouseStart=function(a,b,d){if("mousedown"===a.type&&1===a.which){const b=a.target.classList;if(b.contains("tb_subrow_holder")||b.contains("tb_grid_drag")||b.contains("tb_column_action")&&a.target.parentNode.classList.contains("sub_column")||("row"===
c.ActionBar.type||"subrow"===c.ActionBar.type)&&!b.contains("tb_move")&&null!==a.target.parentNode.closest(".tb_clicked"))return a.stopImmediatePropagation(),a.preventDefault(),!1;this._trigger("beforeStart",a,[this,this._uiHash()])}I.apply(this,[a,b,d])};n===h.fn.themifySerializeObject&&(h.fn.themifySerializeObject=function(){for(var a={},b=this.length-1;-1<b;--b){var c=this[b].type;if(this[b].classList.contains("wp-editor-area")&&tinyMCE!==n){var e=tinyMCE.get(this[b].id);e&&(this[b].value=e.getContent())}if(""!==
this[b].value&&("text"===c||"number"===c||"radio"===c||"checkbox"===c||"textarea"===c||"select-one"===c||"hidden"===c||"email"===c||"select"===c||"select-multiple"===c)&&(this[b].name||this[b].id)){e=this[b].name?this[b].name:this[b].id;var f=this[b].value;"radio"===c||"checkbox"===c?f=this[b].checked&&f:"select-multiple"===c&&(f=h(this[b]).val());a[e]!==n&&"radio"!==c?(!a[e].push&&(a[e]=[a[e]]),f&&a[e].push(f)):f&&(a[e]=f)}}return a});var c=tb_app={activeModel:null,Models:{},Collections:{},Mixins:{},
Views:{Modules:{},Rows:{},SubRows:{},Columns:{}},Forms:{},Constructor:{},Utils:{},Instances:{Builder:{}}},A={},y=null;c.builderIndex=0;c.mode="default";c.autoSaveCid=null;c.hasChanged=null;c.editing=!1;c.scrollTo=!1;c.eventName=!1;c.beforeEvent=!1;c.saving=!1;c.activeBreakPoint="desktop";c.zoomMeta={isActive:!1,size:100};c.isPreview=!1;c.clearOnModeChange=null;c.Models.Module=z.Model.extend({defaults:{element_id:null,elType:"module",mod_name:"",mod_settings:{}},initialize(){c.Models.Registry.register(this.cid,
this);let a=this.get("element_id");a&&1!==A[a]||(a=c.Utils.generateUniqueID(),this.set({element_id:a},{silent:!0}));A[a]=1},toRenderData(){const a=this.get("mod_name");return{icon:c.Utils.getIcon("ti-"+themifyBuilder.modules[a].icon).outerHTML,name:themifyBuilder.modules[a].name,excerpt:this.getExcerpt()}},getExcerpt(a){a=a||this.get("mod_settings");return this.limitString(a.content_text||a.content_box||a.plain_text||"",100)},limitString(a,b){let c="";""!==a&&(a=this.stripHtml(a).toString(),c=a.length>
b?a.substr(0,b):a);return c},stripHtml(a){const b=p.createElement("div");b.innerHTML=a;return b.textContent||b.innerText||""},setData(a){c.Utils.clearElementId([a]);a=c.Views.init_module(a);a.model.trigger("custom:change",a)},backendLivePreview(){h(".tb_element_cid_"+this.cid).find(".module_excerpt").text(this.getExcerpt())},getPreviewSettings(){return _.extend({cid:this.cid},themifyBuilder.modules[this.get("mod_name")].defaults)},getIDattr(){return this.get("element_id")?this.get("element_id"):c.Utils.generateUniqueID()}});
c.Models.SubRow=z.Model.extend({defaults:{element_id:null,elType:"subrow",gutter:"gutter-default",column_alignment:C?"col_align_middle":"col_align_top",column_h:"",desktop_dir:"ltr",tablet_dir:"ltr",tablet_landscape_dir:"ltr",mobile_dir:"ltr",col_mobile:"-auto",col_tablet_landscape:"-auto",col_tablet:"-auto",cols:{},styling:{}},initialize(){c.Models.Registry.register(this.cid,this);let a=this.get("element_id");a&&1!==A[a]||(a=c.Utils.generateUniqueID(),this.set({element_id:a},{silent:!0}));A[a]=1},
setData(a){c.Utils.clearElementId([a]);a=c.Views.init_subrow(a);a.model.trigger("custom:change",a)}});c.Models.Column=z.Model.extend({defaults:{element_id:null,elType:"column",grid_class:"",component_name:"column",modules:{},styling:{}},initialize(){c.Models.Registry.register(this.cid,this);let a=this.get("element_id");a&&1!==A[a]||(a=c.Utils.generateUniqueID(),this.set({element_id:a},{silent:!0}));A[a]=1},setData(a){c.Utils.clearElementId([a]);a=c.Views.init_column(a);a.model.trigger("custom:change",
a)}});c.Models.Row=z.Model.extend({defaults:{element_id:null,elType:"row",gutter:"gutter-default",column_alignment:C?"col_align_middle":"col_align_top",column_h:"",desktop_dir:"ltr",tablet_dir:"ltr",tablet_landscape_dir:"ltr",mobile_dir:"ltr",col_mobile:"-auto",col_tablet_landscape:"-auto",col_tablet:"-auto",cols:{},styling:{}},initialize(){c.Models.Registry.register(this.cid,this);let a=this.get("element_id");a&&1!==A[a]||(a=c.Utils.generateUniqueID(),this.set({element_id:a},{silent:!0}));A[a]=1},
setData(a){c.Utils.clearElementId([a]);a=c.Views.init_row(a);a.model.trigger("custom:change",a)}});c.Collections.Rows=z.Collection.extend({model:c.Models.Row});c.Models.Registry={items:{},register(a,b){this.items[a]=b},lookup(a){return this.items[a]||null},remove(a){this.items[a]=null;delete this.items[a]},destroy(){for(let a in this.items)this.items[a].destroy();this.items={}}};c.Models.setValue=function(a,b,d){d=d||!1;c.Models.Registry.lookup(a).set(b,{silent:d})};c.vent=_.extend({},z.Events);c.Views.register_module=
function(a){"default"!==c.mode&&(this.Modules[c.mode]=this.Modules.default.extend(a))};c.Views.init_module=function(a,b){if(themifyBuilder.modules[a.mod_name]===n)return!1;!0===b&&a.mod_settings===n&&themifyBuilder.modules[a.mod_name].defaults!==n&&(a.mod_settings=_.extend({},themifyBuilder.modules[a.mod_name].defaults));a=a instanceof c.Models.Module?a:new c.Models.Module(a);b=new (this.get_module())({model:a,type:c.mode});return{model:a,view:b}};c.Views.get_module=function(){return this.Modules[c.mode]};
c.Views.unregister_module=function(){"default"!==c.mode&&(this.Modules[c.mode]=null,delete this.Modules[c.mode])};c.Views.module_exists=function(){return this.Modules.hasOwnProperty(c.mode)};c.Views.register_column=function(a){"default"!==c.mode&&(this.Columns[c.mode]=this.Columns.default.extend(a))};c.Views.init_column=function(a){a=a instanceof c.Models.Column?a:new c.Models.Column(a);const b=new (this.get_column())({model:a,type:c.mode});return{model:a,view:b}};c.Views.get_column=function(){return this.Columns[c.mode]};
c.Views.unregister_column=function(){"default"!==c.mode&&(this.Columns[c.mode]=null,delete this.Columns[c.mode])};c.Views.column_exists=function(){return this.Columns.hasOwnProperty(c.mode)};c.Views.register_subrow=function(a){"default"!==c.mode&&(this.SubRows[c.mode]=this.SubRows.default.extend(a))};c.Views.init_subrow=function(a){a=a instanceof c.Models.SubRow?a:new c.Models.SubRow(a);const b=new (this.get_subrow())({model:a,type:c.mode});return{model:a,view:b}};c.Views.get_subrow=function(){return this.SubRows[c.mode]};
c.Views.unregister_subrow=function(){"default"!==c.mode&&(this.SubRows[c.mode]=null,delete this.SubRows[c.mode])};c.Views.subrow_exists=function(){return this.SubRows.hasOwnProperty(c.mode)};c.Views.register_row=function(a){"default"!==c.mode&&(this.Rows[c.mode]=this.Rows.default.extend(a))};c.Views.init_row=function(a){var b=a.attributes;return b===n||b.cols!==n&&(0<Object.keys(b.cols).length||0<b.cols.length)||b.styling!==n&&0<Object.keys(b.styling).length?(a=a instanceof c.Models.Row?a:new c.Models.Row(a),
b=new (this.get_row())({model:a,type:c.mode}),{model:a,view:b}):!1};c.Views.get_row=function(){return this.Rows[c.mode]};c.Views.unregister_row=function(){"default"!==c.mode&&(this.Rows[c.mode]=null,delete this.Rows[c.mode])};c.Views.row_exists=function(){return this.Rows.hasOwnProperty(c.mode)};c.Views.BaseElement=z.View.extend({type:"default",initialize(){this.listenTo(this.model,"custom:change",this.modelChange);this.listenTo(this.model,"destroy",this.remove);this.listenTo(this.model,"edit",this.edit);
this.listenTo(this.model,"duplicate",this.duplicate);this.listenTo(this.model,"save",this.save);this.listenTo(this.model,"importExport",this.importExport);this.listenTo(this.model,"delete",this.delete);this.listenTo(this.model,"copy",this.copy);this.listenTo(this.model,"visibility",this.visibility);this.listenTo(this.model,"paste",this.paste);this.listenTo(this.model,"change:view",this.setView)},setView(a){this.setElement(a)},modelChange(){this.$el.attr(_.extend({},_.result(this,"attributes")));var a=
this.render(),b=c.beforeEvent.data("cid"),d=p.getElementsByClassName("tb_element_cid_"+b)[0];d.parentNode.replaceChild(a.el,d);"visual"===c.mode?this.model.trigger("visual:change"):("row"===c.eventName&&(b=this.$el.data("cid")),c.undoManager.push(b,c.beforeEvent,this.$el,c.eventName),c.Mixins.Builder.update(this.$el))},remove(){this.$el.remove()},visibility(a,b){a="module"===this.model.get("elType")?"mod_settings":"styling";const c=this.model.get(a),e=b.name;!0===b.checked?delete c[e]:c[e]=b.value;
b={};b[a]=c;this.model.set(b,{silent:!0})},copy(a,b){b=this.$el;var d=this.model;a=d.get("elType");"column"===a&&(a=d.get("component_name"));null!==c.activeModel&&ThemifyConstructor.saveComponent();b=this.getData(b,a);Object.keys(c.GS.styles).length&&(d=c.GS.findUsedItems(b),!1!==d&&d.length&&(b.attached_gs=d));c.Utils.clearElementId([b]);"sub-column"===a&&(a="column");m.Clipboard.set(a,b)},paste(a,b,d){a=this.$el;var e=this.model,f=e.get("elType"),g=null;"column"===f?f=e.get("component_name"):"module"===
f&&(g=e.get("mod_name"));"sub-column"===f&&(f="column");var l="style"===b||null!==b&&b!==n&&b.classList.contains("tb_paste_style");b=m.Clipboard.get(f);!1===l&&!1===b&&"column"===f&&(b=m.Clipboard.get("module"),f="module",g=b.mod_name);if(!1===b||!0===l&&"module"===f&&g!==b.mod_name)!0!==d&&m.alertWrongPaste();else{c.eventName="row";if(!0===l){var k=ThemifyStyles.getStyleOptions("module"===f?g:f);d="module"===f?"mod_settings":"styling";var h=this.getData(a,"column"===f?e.get("component_name"):f),
q=function(a){if(-1!==a.indexOf("breakpoint_")||-1!==a.indexOf("_apply_all"))return!0;let b=-1!==a.indexOf("_color")?"color":-1!==a.indexOf("_style")?"style":!1;if(!1!==b){if(b=a.replace("_"+b,"_width"),k[b]!==n&&"border"===k[b].type)return!0}else if(-1!==a.indexOf("_unit")){if(b=a.replace(/_unit$/ig,"",""),k[b]!==n)return!0}else if(-1!==a.indexOf("_w")){if(b=a.replace(/_w$/ig,"",""),k[b]!==n&&"font_select"===k[b].type)return!0}else if(k[a]!==n&&"radio"===k[a].type)return!0;return!1};h[d]===n&&(h[d]=
{});for(var t in b[d])k[t]!==n||q(t)?(h[d][t]=b[d][t],k[t]!==n&&(!0===k[t].isFontColor&&b[d][k[t].g+"-gradient"]!==n?h[d][k[t].g+"-gradient"]=b[d][k[t].g+"-gradient"]:(k[t].posId!==n&&b[d][k[t].posId]!==n&&(h[d][k[t].posId]=b[d][k[t].posId]),k[t].repeatId!==n&&b[d][k[t].repeatId]!==n&&(h[d][k[t].repeatId]=b[d][k[t].repeatId])))):delete b[d][t];b.used_gs!==n&&(h.used_gs=b.used_gs);k=null;b=h;delete b.element_id}"column"===f&&(b.grid_class=c.Utils.filterClass(a.prop("class")),a.hasClass("first")?b.grid_class+=
" first":a.hasClass("last")&&(b.grid_class+=" last"),t=a[0].style.width,b.grid_width=t?t.replace("%",""):null,b.component_name=e.get("component_name"));!1===l&&c.Utils.clearElementId([b]);c.hasChanged=!0;!1===l&&"module"===f&&"column"===e.get("elType")&&(e=c.Views.init_module({mod_name:g},!0),f=e.view.render().$el,a[0].getElementsByClassName("tb_holder")[0].appendChild(f[0]),e=e.model,a=f);c.beforeEvent=m.clone(a);e.setData(b);null!==c.activeModel&&m.Lightbox.close()}},importExport(a,b){const d=b.classList.contains("tb_import")?
"import":"export",e=this,f=this.$el,g=this.model;let l=g.get("elType");l="column"===l?g.get("component_name"):l;b=l.charAt(0).toUpperCase()+l.slice(1);const k="subrow"===l?"Sub-Row":"sub-column"===l?"Sub-Column":b;b={contructor:!0,loadMethod:"html",data:{component_form:{name:ThemifyConstructor.label[d+"_tab"].replace("%s",b),options:[{id:"tb_data_field",type:"textarea",label:ThemifyConstructor.label.import_label.replace("%s",k),help:ThemifyConstructor.label[d+"_data"].replace("%s",b),"class":"fullwidth",
rows:13}]}}};"import"===d&&(b.save={});m.Lightbox.$lightbox[0].style.display="none";m.Lightbox.open(b,function(){r.document.body.classList.add("tb_standalone_lightbox")},function(){const b=this.$lightbox;b.addClass("tb_import_export_lightbox");this.setStandAlone(a.clientX,a.clientY);if("import"===d)b.find(".builder_save_button").on("click.tb_import",function(a){a.preventDefault();a.stopPropagation();a=JSON.parse(b.find("#tb_data_field").val());if("column"===l&&"sub-column"===a.component_name||"sub-column"===
l&&"column"===a.component_name)a.component_name=l,a.grid_class=f.closest(".module_column").prop("class");if(a.component_name===n||a.component_name!==l)m.alertWrongPaste();else{c.eventName="row";c.hasChanged=!0;c.beforeEvent=m.clone(f);var d=function(a){a=c.Utils.clear(a);g.setData(a);m.Lightbox.close()};a.used_gs!==n?c.GS.setImport(a.used_gs,d,a):d(a)}});else{let a=e.getData(f,l);a.component_name=l;const d=c.GS.findUsedItems(a);if(!1!==d){const b={};for(let a=d.length-1;-1<a;--a){let e=c.GS.styles[d[a]],
f=h.extend(!0,{},e.data[0]);"row"===e.type||"subrow"===e.type?f=f.styling:f.cols!==n?(f=f.cols[0])&&(f="column"===e.type?f.styling:f.modules!==n?f.modules[0].mod_settings:n):f=n;f!==n&&0<Object.keys(f).length&&(b[d[a]]={title:e.title,type:e.type,data:c.Utils.clear(f,!1)})}Object.keys(b).length&&(a.used_gs=b)}a=JSON.stringify(a);b.find("#tb_data_field").val(a).on("click",function(){h(this).trigger("focus").trigger("select")})}v.body.one("themify_builder_lightbox_close",function(){b.removeClass("tb_import_export_lightbox");
r.document.body.classList.remove("tb_standalone_lightbox");"import"===d&&b.find(".builder_save_button").off("click.tb_import")})})},getData(a,b){var d={};switch(b){case "row":case "subrow":d=c.Utils._getRowSettings(a.closest(".module_"+b)[0],b);break;case "module":d=c.Models.Registry.lookup(a.closest(".active_module").data("cid")).attributes;break;case "column":case "sub-column":a=a.closest(".module_column"),d=a.closest("column"===b?".module_row":".module_subrow"),d=c.Utils._getRowSettings(d[0],"column"===
b?"row":"subrow").cols[a.index()]}return c.Utils.clear(d)},duplicate(a,b){a=this.$el;b=m.clone(a);null!==c.activeModel&&m.Lightbox.$lightbox.is(":visible")&&ThemifyConstructor.saveComponent();a.removeClass("tb_element_cid_"+this.model.cid);b.hide().insertAfter(a);const d=this.getData(b,this.model.get("elType"));c.eventName="duplicate";c.beforeEvent=b;c.hasChanged=!0;this.model.setData(d);a.addClass("tb_element_cid_"+this.model.cid)},edit(a,b){if(c.isPreview)return!0;"breadcrumb"!==a?c.ActionBar.breadCrumbsPath.lightbox=
null:a=null;let d=c.hasChanged=!1,e=m.Lightbox.$lightbox,f=this.model.get("elType"),g=!1,l="module"===f?this.model.get("mod_name"):f,k=!1;if(null!==a){const e=b.classList;let q=e.contains("tb_dragger")?b.getAttribute("data-id"):null;if(null!==q&&""===b.getAttribute("data-v"))return;"dblclick"===a.type&&this.model.cid!==c.autoSaveCid&&c.ActionBar.clear();k=null!==q||e.contains("tb_styling");if(!0===k)this.model.set({styleClicked:!0},{silent:!0}),null!==q&&(g=function(a){var b=e.contains("tb_dragger_padding")?
"padding":"margin",d="padding"===b?"p":"m";const g=ThemifyConstructor.label[d];let k=n;if("module"===f){let e;k=a.getElementsByClassName("tb_styling_tab_nav")[0];if(k!==n){if(c.EdgeDrag.modules[l]!==n&&c.EdgeDrag.modules[l][b]!==n&&(q=q.replace(/_left|_right|_bottom|_top$/ig,""),c.EdgeDrag.modules[l][b][q]!==n&&(e=c.EdgeDrag.getTabId(ThemifyConstructor.data[l].styling.options.options,q,d),null!==e))){b=k.getElementsByClassName("tb_tab_wrapper")[0].getElementsByTagName("a");for(d=b.length-1;-1<d;--d)if(b[d].getAttribute("href")===
"#tb_1_"+e){b[d].click();break}b=null}e=k.getElementsByClassName("current")[0].getElementsByTagName("a")[0].getAttribute("href");k=a.querySelector(e)}}k===n&&(k=a);const t=k.getElementsByClassName("tb_style_toggle");for(let a=t.length-1;-1<a;--a)if(t[a].textContent===g){t[a].classList.contains("tb_closed")&&t[a].click();setTimeout(function(){h("#tb_lightbox_container").scrollTop(t[a].offsetTop)},10);break}});else if(e.contains("tb_visibility_component"))d=!0,this.model.set({visibileClicked:!0},{silent:!0});
else if(!0===(e.contains("tb_swap")?!1:"layout-part"===l?!0:v.body.triggerHandler("tb_edit_"+l,[a,this.el,this.model]))&&"visual"===c.mode&&!c.Forms.LayoutPart.id&&("dblclick"===a.type||e.contains("tb_edit"))){c.activeModel=this.model;c.Forms.LayoutPart.edit(this.el);return}}null!==c.activeModel&&null!==c.autoSaveCid&&this.model.cid!==c.autoSaveCid&&ThemifyConstructor.saveComponent(!0);c.activeModel=this.model;if(c.autoSaveCid===this.model.cid){a=null;if(!0===k)a=e.find('a[href="#tb_options_styling"]'),
this.model.unset("styleClicked",{silent:!0});else if(!0===d)a=e.find('a[href="#tb_options_visibility"]'),this.model.unset("visibileClicked",{silent:!0});else if("module"===f||"row"===f)a=e.find('a[href="#tb_options_setting"]');null!==a&&0<a.length&&(a[0].click(),!1!==g&&!0===k&&g(m.Lightbox.$lightbox[0].querySelector("#tb_lightbox_container")))}else m.Lightbox.open({loadMethod:"inline",templateID:l},!1,g),!1===c.GS.isGSPage&&(c.ActionBar.hideContextMenu(),("row"!==l||"row"===l&&null!==c.ActionBar.breadCrumbsPath.lightbox)&&
m.Lightbox.$lightbox[0].getElementsByClassName("tb_action_breadcrumb")[0].appendChild(c.ActionBar.getBreadCrumbs(c.Instances.Builder[c.builderIndex].el.getElementsByClassName("tb_element_cid_"+this.model.cid)[0])))},delete(a,b,d){let e=this.$el;a=this.model;b=a.cid;let f=a.get("elType");if(!0===d||confirm(themifyBuilder.i18n[f+"DeleteConfirm"])){d=e.closest(".module_row");var g="row",l="",k,u={};"row"===f?(u.pos_cid=d.next(".module_row"),u.pos="before",0===u.pos_cid.length&&(u.pos="after",u.pos_cid=
d.prev(".module_row")),g="delete_row",u.pos_cid=u.pos_cid.data("cid")):b=d.data("cid");d=m.clone(d);"row"!==f&&(k=e.closest(".module_subrow"));a.destroy();k&&0<k.length&&0===k.find(".active_module").length&&k.addClass("tb_row_empty");"row"!==f&&(l=h(".tb_element_cid_"+b),k=l.closest(".module_row"),0===k.find(".active_module").length&&k.addClass("tb_row_empty"));c.hasChanged=!0;c.undoManager.push(b,d,l,g,u);c.toolbar.pageBreakModule.countModules();null!==c.activeModel&&c.activeModel.cid===a.cid&&m.Lightbox.$lightbox.find(".tb_close_lightbox")[0].click()}},
save(a){null!==c.activeModel&&null!==c.autoSaveCid&&ThemifyConstructor.saveComponent(!0);var b=this.model.get("elType"),d={contructor:!0,loadMethod:"html",save:{done:"save"},data:{}},e=this.model.cid;d.data["s"+b]={options:[{id:"item_title_field",type:"text",label:ThemifyConstructor.label.title},{id:"item_layout_save",type:"checkbox",label:"",options:[{name:"layout_part",value:ThemifyConstructor.label.slayout_part}],new_line:!1,after:"",help:'Any changes made to a Layout Part are saved and reflected everywhere else they are being used (<a href="https://themify.me/docs/builder#layout-parts" target="_blank">learn more</a>)'}]};
m.Lightbox.$lightbox[0].style.display="none";m.Lightbox.open(d,function(){r.document.body.classList.add("tb_standalone_lightbox")},function(d){var f=this.$lightbox,l=function(a){if("keypress"!==a.type||13===a.keyCode){a.preventDefault();a.stopPropagation();m.showLoader("show");a=c.Models.Registry.lookup(e);switch(b){case "row":var f=b;var g=c.Utils._getRowSettings(h(".tb_element_cid_"+e)[0]);c.Utils.clearElementId([g],!0);break;case "module":f=a.get("mod_name"),g={mod_name:f,element_id:c.Utils.generateUniqueID(),
mod_settings:a.get("mod_settings")}}g=c.Utils.clear(g);var l=ThemifyStyles.builder_id;a=h.extend(c.Forms.serialize(d),{action:"tb_save_custom_item",item:JSON.stringify(g),tb_load_nonce:themifyBuilder.tb_load_nonce,postid:l,type:b});f=c.GS.findUsedItems(g);!1!==f&&(a.usedGS=f);var k=a.item_layout_save;h.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:a,success(a){if("success"===a.status){var d=function(a){h("#tb_module_panel",r.document).find(".tb_module_panel_search_text").val("");
if(k){c.hasChanged=!0;var d={mod_name:"layout-part",mod_settings:{selected_layout_part:a.post_name}};delete a.status;0<ThemifyConstructor.layoutPart.data.length&&ThemifyConstructor.layoutPart.data.push(a);var f=h(".tb_element_cid_"+e);let g,l=m.clone(f),k;"row"===b?(k=c.Views.init_row({cols:[{grid_class:"col-full first last",element_id:c.Utils.generateUniqueID(),modules:[d]}]}).view.render(),d=c.Models.Registry.lookup(k.$el.find(".active_module").data("cid"))):(d=c.Views.init_module(d),k=d.view.render(),
d=d.model);f.replaceWith(k.el);"visual"===c.mode?(h(p).ajaxComplete(function J(a,d,e){-1!==e.data.indexOf("tb_load_module_partial",3)&&(h(this).off("ajaxComplete",J),g="row"===b?c.liveStylingInstance.$liveStyledElmt.closest(".module_row"):c.liveStylingInstance.$liveStyledElmt,c.undoManager.push(k.$el.data("cid"),l,g,"row"))}),d.trigger("custom:preview:refresh",d.get("mod_settings"))):(g=k.el,c.Mixins.Builder.updateModuleSort(k.$el),c.undoManager.push(k.$el.data("cid"),l,g,"row"))}if(!0===c.toolbar.libraryItems.is_init){f=
h(".tb_library_item_list");a=c.toolbar.libraryItems.template([a]);"visual"===c.mode&&(f=f.add(c.toolbar.$el.find(".tb_library_item_list")));f=f.get();for(let b=0,c=f.length;b<c;++b)f[b].insertAdjacentHTML("afterbegin",a),f[b].previousElementSibling.getElementsByClassName("current")[0].click();c.toolbar.libraryItems.bindEvents(!0)}m.showLoader("hide");m.Lightbox.close()};k?(ThemifyStyles.builder_id=a.id,c.Utils.saveCss([g],"",a.id).done(function(){ThemifyStyles.builder_id=l;d(a)})):d(a)}else alert(a.msg)}})}};
f.addClass("tb_save_module_lightbox");this.setStandAlone(a.clientX,a.clientY);f.on("click.saveLayout",".builder_save_button",l).on("keypress.saveLayout","input",l);v.body.one("themify_builder_lightbox_close",function(){f.removeClass("tb_save_module_lightbox").off(".saveLayout");r.document.body.classList.remove("tb_standalone_lightbox")})})}});c.Views.BaseElement.extend=function(a){const b=this,c=z.View.extend.apply(this,arguments);c.prototype.events=_.extend({},this.prototype.events,a.events);c.prototype.initialize=
function(){"function"===typeof b.prototype.initialize&&b.prototype.initialize.apply(this,arguments);"function"===typeof a.initialize&&a.initialize.apply(this,arguments)};return c};c.Views.Modules["default"]=c.Views.BaseElement.extend({tagName:"div",attributes(){const a=this.model.get("mod_settings"),b={"data-cid":this.model.cid,"class":"active_module module-"+this.model.get("mod_name")+" tb_"+this.model.get("element_id")+" tb_element_cid_"+this.model.cid};if("visual"===c.mode){if(b["class"]+=" tb_module_front",
"hide_all"===a.visibility_all||"hide"===a.visibility_desktop||"hide"===a.visibility_tablet||"hide"===a.visibility_tablet_landscape||"hide"===a.visibility_mobile)b["class"]+=" tb_visibility_hidden"}else b["class"]+=" tb_module";a.custom_css_id!==n&&""!==a.custom_css_id&&(b.id=a.custom_css_id);return b},template:"visual"===c.mode?null:wp.template("builder_module_item"),initialize(){this.listenTo(this.model,"dom:module:unsaved",this.removeUnsaved)},removeUnsaved(){this.model.destroy()},render(){"visual"!==
c.mode&&(this.el.innerHTML=this.template(this.model.toRenderData()));c.Utils.visibilityLabel(this.el);return this}});c.Views.Columns["default"]=c.Views.BaseElement.extend({tagName:"div",attributes(){const a={"class":"module_column tb_element_cid_"+this.model.cid+" tb_"+this.model.get("element_id")+" tf_box "+this.model.get("grid_class"),"data-cid":this.model.cid};this.model.get("grid_width")&&(a.style="width:"+this.model.get("grid_width")+"%");a["class"]+="column"!==this.model.get("component_name")?
" sub_column":" tb-column";return a},render(){const a=this.model.get("modules");this.el.innerHTML=m.templateCache.get("tmpl-builder_column_item");if(a){const d=this.el.getElementsByClassName("tb_holder")[0];for(let e in a)if(a[e]!==n&&null!==a[e]){var b=a[e];(b=b.cols===n?c.Views.init_module(b):c.Views.init_subrow(b))&&d.appendChild(b.view.render().el)}"sub-column"===this.model.get("component_name")&&d.classList.add("tb_subrow_holder")}return this}});c.Views.SubRows["default"]=c.Views.BaseElement.extend({tagName:"div",
attributes(){return{"class":"module_subrow themify_builder_sub_row active_module tb_element_cid_"+this.model.cid+" clearfix tf_box tf_w tb_"+this.model.get("element_id"),"data-cid":this.model.cid}},render(){const a=this.model.get("cols"),b=Object.keys(a).length;this.el.innerHTML=m.templateCache.get("tmpl-builder_subrow_item");if(0<b){const d=this.el.getElementsByClassName("subrow_inner")[0];let e=!1;for(let f=0;f<=b;++f)a[f]!==n&&null!==a[f]&&(a[f].component_name="sub-column",d.appendChild(c.Views.init_column(a[f]).view.render().el),
!1===e&&a[f].modules!==n&&0<a[f].modules.length&&(e=!0));!1===e&&this.el.classList.add("tb_row_empty")}c.Utils.selectedGridMenu(this.el,"subrow");c.Utils.visibilityLabel(this.el);return this}});c.Views.Rows["default"]=c.Views.BaseElement.extend({tagName:"div",attributes(){const a=this.model.get("styling"),b={"class":"module_row themify_builder_row tb_element_cid_"+this.model.cid+" clearfix tf_box tb_"+this.model.get("element_id"),"data-cid":this.model.cid};null!==a&&(a.custom_css_row!==n&&""!==a.custom_css_row&&
(b["class"]+=" "+a.custom_css_row),a.custom_css_id!==n&&""!==a.custom_css_id&&(b.id=a.custom_css_id));return b},render(){const a=this.model.get("cols"),b=Object.keys(a).length;let d=!1;this.el.innerHTML=m.templateCache.get("tmpl-builder_row_item");const e=this.el.getElementsByClassName("row_inner")[0];if(0<b)for(let f=0;f<=b;++f)a[f]!==n&&null!==a[f]&&(a[f].component_name="column",e.appendChild(c.Views.init_column(a[f]).view.render().el),!1===d&&a[f].modules!==n&&(0<a[f].modules.length||"object"===
typeof a[f].modules&&0<Object.keys(a[f].modules).length)&&(d=!0));else c.Utils._addNewColumn({newclass:"col-full",component:"column"},e);!1===d&&this.el.classList.add("tb_row_empty");c.Utils.selectedGridMenu(this.el,"row");c.Utils.visibilityLabel(this.el);return this}});c.Views.Builder=z.View.extend({type:"default",lastRow:null,events:{"click .tb_import_layout_button":"importLayoutButton"},initialize(){this.$el.off("tb_init tb_new_row").on("tb_init",this.init.bind(this)).on("tb_init",this.newRowAvailable.bind(this))},
init(a){c.Mixins.Builder.rowSort(this.$el);"visual"===c.mode?(c.Mixins.Builder.updateModuleSort(this.$el),setTimeout(function(){c.Utils._onResize(!0)},1500)):(c.Mixins.Builder.updateModuleSort(this.$el),c.Mixins.Builder.initModuleDraggable(c.toolbar.$el.find(".tb_module_panel_modules_wrap").first(),".tb_module"),c.Mixins.Builder.initModuleDraggable(c.toolbar.$el,".tb_row_grid"));const b=this;setTimeout(function(){c.ActionBar.init();c.Utils.setCompactMode(b.el.getElementsByClassName("module_column"));
b.insertLayoutButton();"visual"!==c.mode&&c.GS.init()},1E3);A={}},render(){const a=this.collection;c.Utils.clearLastEmptyRow(a.models);for(let b=0,d=a.models.length;b<d;++b){let d=c.Views.init_row(a.models[b]);!1!==d&&this.el.appendChild(d.view.render().el)}c.Utils.columnDrag(!1,!1);return this},insertLayoutButton(){this.removeLayoutButton();this.lastRowAddBtn();var a=this.el.getElementsByClassName("module_row");a[0]!==n&&2>a.length&&a[0].classList.contains("tb_row_empty")&&(a=p.createElement("a"),
a.className="tb_import_layout_button",a.href="#",a.textContent=themifyBuilder.i18n.text_import_layout_button,this.el.appendChild(a))},removeLayoutButton(){const a=this.el.getElementsByClassName("tb_import_layout_button");for(let b=a.length-1;-1<b;--b)a[b].parentNode.removeChild(a[b])},importLayoutButton(a){c.Views.Toolbar.prototype.loadLayout(a)},newRowAvailable(a,b){const d=this.el.children,e=d.length;let f=!0;if(0!==e&&!0!==b)for(b=e-1;-1<b;--b)if(d[b].classList.contains("module_row")){f=!1;break}if(!0===
f)return a=c.Views.init_row(c.Utils.grid(a||1)[0]).view.render().$el,a[0].className+=" tb_new_row",this.el.insertBefore(a[0],this.lastRow),c.Utils.setCompactMode(a[0].getElementsByClassName("module_column")),c.Mixins.Builder.update(a),c.Utils.calculateHeight(),a},lastRowShowHide(a){this.lastRow&&(a?this.lastRow.classList.remove("hide"):(this.lastRow.classList.remove("expanded"),this.lastRow.classList.add("hide")))},lastRowAddBtn(){if(!0!==c.GS.isGSPage){var a=p.getElementById("tb_add_container"),
b=p.createElement("div");null!==a&&a.parentNode.removeChild(a);this.lastRow=p.createElement("div");var d=null;this.lastRow.id="tb_add_container";b.className="tb_last_add_btn";b.textContent="+";this.lastRow.appendChild(b);this.lastRow.addEventListener("click",function(a){a.preventDefault();const b=a.target,e=b.closest(".tb_row_grid");null!==e?(this.classList.remove("expanded"),c.Mixins.Builder.rowDrop(c.Utils.grid(e.dataset.col),h("<div>").insertBefore(this),!0,!0)):b.classList.contains("tb_add_blocks")?
(this.classList.remove("expanded"),c.toolbar.common.show(a,h(this).find(".tb_last_add_btn")),c.toolbar.common.clicked=this.previousElementSibling?h(this.previousElementSibling):null,c.toolbar.common.btn[0].querySelector('[data-target="tb_module_panel_rows_wrap"]').click()):b.classList.contains("tb_last_add_btn")&&(null===d&&(d=!0,this.appendChild(p.getElementById("tmpl-last_row_add_btn").content.cloneNode(!0))),this.classList.add("expanded"))});this.el.appendChild(this.lastRow)}}});c.Mixins.Builder=
{before:null,zindex:null,r:null,w:null,h:null,type:null,moduleHolderArgs:null,isFullWidth:null,update(a){if("visual"===c.mode){var b=null!==c.activeModel?c.activeModel.get("elType"):c.Models.Registry.lookup(a.data("cid")).get("elType");c.Utils.loadContentJs(a,b)}a=a.closest(".module_row");c.Utils.columnDrag(a.find(".row_inner"),!1);c.Utils.columnDrag(a.find(".subrow_inner"),!1);c.Mixins.Builder.updateModuleSort(a)},dragScroll(a,b){function d(a,b){k=!0;if(null===l){l=!0;var c=this!==n?this.id:null;
c||(c=b);a=("tb_toolbar"===c||"wpadminbar"===c?"-":"+")+("="+g*u+"px");f.stop().animate({scrollTop:a},{duration:1,complete(){!0===k&&(10>u&&++u,l=null,d(null,c))}})}}var e=h("body",r.document);"visual"===c.mode&&(e=e.add(v.body));this.top===n&&(this.top=c.toolbar.$el,this.top=this.top.add(h("#tb_fixed_bottom_scroll",r.document)),"visual"!==c.mode&&(this.top=this.top.add("#wpadminbar")));if(!0===b)this.top.off("mouseenter mouseleave"),"row"===a&&"visual"===c.mode&&c.toolbar.$el.find('.tb_zoom[data-zoom="100"]').trigger("click"),
e.removeClass("tb_drag_start tb_drag_"+a);else{var f=null,g=1,l=null,k=!0,u=1;"visual"!==c.mode&&(f=h(".edit-post-layout__content").first(),0===f.length?f=null:g/=2);null===f&&(f="desktop"===c.activeBreakPoint?h("body,html"):h("body,html",r.document));e.addClass("tb_drag_start tb_drag_"+a);"row"===a&&"visual"===c.mode&&c.toolbar.$el.find('.tb_zoom[data-zoom="50"]').trigger("click");if(0<g)this.top.off("mouseenter").on("mouseenter",d).off("mouseleave").on("mouseleave",function(){u=1;l=k=null;f.stop()})}},
columnSort(a){var b,d;a.find(".row_inner, .subrow_inner").sortable({items:"> .module_column",handle:"> .tb_column_action .tb_column_dragger",axis:"x",placeholder:"tb_state_highlight",tolerance:"pointer",cursorAt:{top:20,left:20},beforeStart(a,c,g){v.body.addClass("tb_drag_start");b=m.clone(g.item.closest(".module_row"));d=g.item.siblings();d.css("marginLeft",0)},start(a,b){h(".tb_state_highlight").width(b.item.width())},stop(a,b){v.body.removeClass("tb_drag_start");d.css("marginLeft","")},update(a,
d){a=d.item.closest(".ui-sortable");d=a.children(".module_column");d.removeClass("first last");a[0].classList.contains("direction-rtl")?(d.last().addClass("first"),d.first().addClass("last")):(d.first().addClass("first"),d.last().addClass("last"));c.Utils.columnDrag(a,!1);c.Utils.setCompactMode(d);a=a.closest(".module_row");c.undoManager.push(a.data("cid"),b,a,"row")}})},rowSort(a){var b=this,d,e={items:">.module_row",handle:">.tb_row_action",axis:"y",placeholder:"tb_state_highlight",containment:"visual"===
c.mode?"parent":"body",tolerance:"pointer",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!1,beforeStart(a,e,l){b.before||(c.ActionBar.hoverCid=null,d=c.ActionBar.disable=!0,b.before=l.item.next(".module_row"),0===b.before.length&&(b.before=l.item.prev(".module_row"),d=!1),b.before=b.before.data("cid"),b.dragScroll("row"))},start(){a.sortable("refreshPositions")},stop(a,e){c.ActionBar.disable=null;b.before=d=null;b.dragScroll("row",!0)},update(a,e){if("visual"===c.mode&&!e.item[0].classList.contains("tb_row_grid")){var f=
"desktop"===c.activeBreakPoint?h("html,body"):h("body",r.document);f.scrollTop(e.item.offset().top);f=null}"sortupdate"===a.type&&b.before?(c.hasChanged=!0,a=e.item.next(".module_row"),f=!0,0===a.length&&(a=e.item.prev(".module_row"),d=f=!1),a=a.data("cid"),c.undoManager.push(e.item.data("cid"),null,null,"row_sort",{bnext:d,before:b.before,anext:f,after:a})):e.item[0].classList.contains("predesigned_row")||e.item[0].classList.contains("tb_page_break_module")||"row"===e.item.data("type")?"row"===e.item.data("type")?
c.toolbar.libraryItems.get(e.item.data("id"),"row",function(a){Array.isArray(a)||(a=Array(a));b.rowDrop(a,e.item)}):e.item[0].classList.contains("tb_page_break_module")?(b.rowDrop(c.toolbar.pageBreakModule.get(),e.item),c.toolbar.pageBreakModule.countModules()):c.toolbar.preDesignedRows.get(e.item.data("slug"),function(a){b.rowDrop(a,e.item)}):e.item[0].classList.contains("tb_row_grid")&&b.subRowDrop(e.item.data("slug"),e.item)}};"visual"===c.mode&&(e.helper=function(){return h('<div class="tb_sortable_helper"/>')});
a.sortable(e)},updateModuleSort(a,b){if(!0!==c.GS.isGSPage){var d=h(".tb_holder",a),e=this;if(b)return d.filter(".ui-sortable").sortable(b),!1;d.each(function(){h(this).data({uiSortable:null,sortable:null})});this.moduleHolderArgs={placeholder:"tb_state_highlight",items:">.active_module,>div>.active_module",connectWith:".tb_holder",revert:100,scroll:!1,cancel:".tb_disable_sorting,.tb_action_wrap:not(.tb_subrow_action)",cursorAt:{top:10,left:90},beforeStart(a,b,d){c.ActionBar.disable=!0;c.ActionBar.hoverCid=
null;e.before||(e.r=d.item.closest(".module_row"),0<e.r.length?(e.before=m.clone(e.r),e.zindex=e.r.css("zIndex"),"auto"===e.zindex&&(e.zindex=""),e.r.css("zIndex",2)):e.r=null,e.w=d.item[0].style.width,e.h=d.item[0].style.height,d.item.css({width:180,height:30}),e.type="module",d.item[0].classList.contains("module_subrow")?e.type+=" tb_drag_subrow":d.item[0].classList.contains("tb_row_grid")&&(e.type="column"),e.dragScroll(e.type))},start(a,b){if(b.item[0].classList.contains("module_subrow")||b.item[0].classList.contains("tb_row_grid"))h(".ui-sortable.tb_subrow_holder").sortable("disable"),
h(".ui-sortable.tb_holder").sortable("refresh")},stop(a,b){c.ActionBar.disable=null;c.ActionBar.clear();"visual"===c.mode&&b.helper&&h(b.helper).remove();b.item.css({width:e.w,height:e.h,display:""});e.dragScroll(e.type,!0);e.r&&e.r.css("zIndex",e.zindex);if(b.item[0].classList.contains("module_subrow")||b.item[0].classList.contains("tb_row_grid"))h(".ui-sortable.tb_subrow_holder").sortable("enable"),h(".ui-sortable.tb_holder").sortable("refresh");e.before=e.w=e.h=e.r=e.zindex=e.type=null},update(a,
b){b.item.css({width:e.w,height:e.h});if(b.item[0].classList.contains("tb_module_dragging_helper")){a=h(b.item.clone(!1));if(b.item.data("id")){var f=b.item.closest(".module_row");0<f.length&&(e.before=m.clone(f),e.before.find(".tb_module_dragging_helper").remove())}b.item.after(a);e.moduleDrop(a,null,e.before)}else{if(b.sender&&(a=b.sender.closest(".module_row"),b.sender.closest(".module_row").toggleClass("tb_row_empty",0===a.find(".active_module").length),a=b.sender.closest(".module_subrow"),0<
a.length&&a.toggleClass("tb_row_empty",0===a.find(".active_module").length),b.item[0].classList.contains("module_subrow")&&0<b.item.parent().closest(".module_subrow").length)){d.sortable("cancel");return}e.before&&(c.hasChanged=!0,b.item[0].classList.contains("module_subrow")||b.item.closest(".module_subrow").removeClass("tb_row_empty"),a=b.item.closest(".module_row"),a.removeClass("tb_row_empty"),c.undoManager.push(b.item.data("cid"),e.before,a,"sort",{before:e.before.data("cid"),after:a.data("cid")}),
e.before=null,v.body.triggerHandler("tb_"+e.type+"_sort",[b.item]))}}};"visual"===c.mode&&(this.moduleHolderArgs.helper=function(){return h('<div class="tb_sortable_helper"/>')});d.sortable(this.moduleHolderArgs)}},initModuleDraggable(a,b){var d=this,e=h.extend(!0,{},this.moduleHolderArgs);e.update=!1;e.appendTo=p.body;e.items=b;".tb_row_grid"===b&&(e.connectWith=[e.connectWith,"visual"===c.mode?"#themify_builder_content-"+themifyBuilder.post_ID:"#tb_row_wrapper"]);e.stop=function(b,c){h(this).sortable("cancel");
c.item.removeClass("tb_sortable_helper tb_module_dragging_helper");d.moduleHolderArgs.stop(b,c);c.item[0].classList.contains("tb_row_grid")&&a.sortable("refresh")};e.start=function(b,c){c.item.addClass("tb_sortable_helper tb_module_dragging_helper");d.moduleHolderArgs.start(b,c);c.item[0].classList.contains("tb_row_grid")&&a.sortable("refresh")};e.helper=function(a,b){return h('<div class="tb_sortable_helper tb_module_dragging_helper">'+b.text()+"</div>")};a.sortable(e)},initRowDraggable(a,b){const d=
this;a.find(b).draggable({appendTo:v.body,helper:"clone",revert:"invalid",connectToSortable:"visual"===c.mode?"#themify_builder_content-"+themifyBuilder.post_ID:"#tb_row_wrapper",cursorAt:{top:10,left:40},start(a,b){d.dragScroll("row");b.helper.addClass("tb_module_dragging_helper tb_sortable_helper").find(".tb_predesigned_rows_image").remove()},stop(a,b){d.dragScroll("row",!0)}})},initModuleVisualDrag(a){const b=this;c.toolbar.$el.find(a).ThemifyDraggable({iframe:"#tb_iframe",dropitems:".tb_holder",
elements:".active_module",type:"module",onDragBefore(a,b){c.ActionBar.disable=!0},onDragEnd(){c.ActionBar.disable=null},onDrop(a,c,f){b.moduleDrop(c,!1,m.clone(f.closest(".module_row")))}})},initRowGridVisualDrag(){const a=this;c.toolbar.$el.find(".tb_row_grid").ThemifyDraggable({iframe:"#tb_iframe",dropitems:".tb_holder:not('.tb_subrow_holder'),.themify_builder_content:not('.not_editable_builder')>.module_row",elements:".active_module",cancel:".tb_subrow_holder",append:!1,type:"column",onDragBefore(a,
d){c.ActionBar.disable=!0},onDragEnd(){c.ActionBar.disable=null},onDrop(b,c,e){a.subRowDrop(c.data("slug"),c)}})},initRowVisualDrag(a){const b=this;c.toolbar.$el.find(a).ThemifyDraggable({iframe:"#tb_iframe",dropitems:".themify_builder_content:not('.not_editable_builder')>.module_row",append:!1,type:"row",onDragBefore(a,b){c.ActionBar.disable=!0;c.toolbar.$el.find('.tb_zoom[data-zoom="50"]').click()},onDragEnd(){c.ActionBar.disable=null},onDrop(a,e,f){e.addClass("tb_state_highlight").find(".tb_predesigned_rows_image").remove();
e.show();c.Utils.setCompactMode(e.offset().top);"row"===e.data("type")?c.toolbar.libraryItems.get(e.data("id"),"row",function(a){if(!Array.isArray(a)){a=Array(a);const b=c.GS.findUsedItems(a);!1!==b&&b.length&&(a[0].used_gs=b)}b.rowDrop(a,e)}):e[0].classList.contains("tb_page_break_module")?(b.rowDrop(c.toolbar.pageBreakModule.get(),e),c.toolbar.pageBreakModule.countModules()):c.toolbar.preDesignedRows.get(e.data("slug"),function(a){b.rowDrop(a,e)})}})},subRowDrop(a,b){c.ActionBar.clear();var d=0<
b.parent(".themify_builder_content,#tb_row_wrapper").length;if(d||0===b.closest(".sub_column").length){a=c.Utils.grid(a);if(!d){var e=m.clone(b.closest(".module_row"));e.find(".tb_row_grid").remove();var f="row"}a=(d?c.Views.init_row({cols:a[0].cols}):c.Views.init_subrow({cols:a[0].cols})).view.render().$el;if(d||b[0].parentNode.classList.contains("tb_holder")||b[0].parentNode.parentNode.classList.contains("tb_holder"))b[0].parentNode.replaceChild(a[0],b[0]),a[0].className+=" tb_element_clicked",
c.ActionBar.type="subrow";else{var g=b.next(".tb_holder");0<g.length?g.prepend(a):(g=b.prev(".tb_holder"),g.append(a))}if(d){e=a.next(".module_row");var l=!0;0===e.length&&(l=!1,e=a.prev(".module_row"));e=e.data("cid");f="grid_sort"}c.Utils.setCompactMode(a[0].getElementsByClassName("module_column"));c.Mixins.Builder.update(a);b.remove();c.hasChanged=!0;b=a.closest(".module_row");d||b.removeClass("tb_row_empty");b.find(".tb_row_grid").remove();c.Utils.scrollToDropped(a[0]);c.undoManager.push(b.data("cid"),
e,b,f,{next:l})}else b.remove()},rowDrop(a,b,d,e){function f(){var a=b.prev(".module_row");if(0===a.length){var d="visual"===c.mode?b.closest(".themify_builder_content").data("postid"):null;a=!1}else a=a.data("cid");b[0].innerHTML="";c.ActionBar.type="row";b[0].parentNode.replaceChild(l,b[0]);c.hasChanged=!0;c.Instances.Builder[c.builderIndex].removeLayoutButton();c.undoManager.push("","","","predesign",{prev:a,rows:k,bid:d});a=0;for(d=k.length;a<d;++a){var e=k[a][0].getElementsByClassName("module_column");
0===a&&k[a][0].classList.add("tb_element_clicked");c.Utils.setCompactMode(e);c.Mixins.Builder.update(k[a])}c.Utils.scrollToDropped(k[0][0]);m.showLoader("hide");c.Utils.calculateHeight()}c.ActionBar.clear();var g=function(a){for(var b in a)if(a[b].styling&&0<Object.keys(a[b].styling).length||a[b].modules&&0<Object.keys(a[b].modules).length)return!0;return!1},l=p.createDocumentFragment(),k=[],h=[];e||c.Utils.clearLastEmptyRow(a);for(let b=0,f=a.length;b<f;++b)if(!0===d||a[b].styling&&0<Object.keys(a[b].styling).length||
a[b].cols&&g(a[b].cols))if(e=c.Views.init_row(a[b]),!1!==e){e=e.view.render();l.appendChild(e.el);if("visual"===c.mode){let a=e.el.querySelectorAll("[data-cid]");h[e.el.dataset.cid]=1;for(let b=0,c=a.length;b<c;++b)h[a[b].dataset.cid]=1}k.push(e.$el)}"visual"===c.mode?(c.bootstrap(h,f),h=null):f()},moduleDrop(a,b,d){function e(e){function f(e){l||k.model.set({is_new:1},{silent:!0});e=!0===e?k.model.getPreviewSettings():k.model.get("mod_settings");b?b.hasClass("tb_module_front")?b.after(h.el):b.append(h.el):
a.replaceWith(h.el);l?c.activeModel=k.model:k.model.trigger("edit",null);c.hasChanged=!0;let f=!1;if("visual"===c.mode&&"layout-part"!==k.model.get("mod_name")&&1<=Object.keys(e).length){var t=e.cid;"part"===g||"ajax"===a.data("type")?(f=!0,k.model.trigger("custom:preview:refresh",e)):"module"!==g?k.model.trigger("custom:preview:live",e):c.Utils.loadContentJs(h.$el,"module")}l&&(f&&(e=k.view.$el.find(".tb_preview_component").detach(),k.view.$el.prepend(e)),d&&(t=h.$el.closest(".module_row"),t.removeClass("tb_row_empty").find(".tb_module_dragging_helper").remove(),
h.$el.closest(".module_subrow").removeClass("tb_row_empty"),c.undoManager.push(t.data("cid"),d,t,"row"),t=t.data("cid"),c.Instances.Builder[c.builderIndex].removeLayoutButton(),c.activeModel=null),c.Utils.calculateHeight());c.Utils.scrollToDropped(null,t)}const k=c.Views.init_module(e,!0),h=k.view.render();"visual"===c.mode&&l?(e=[],e[k.model.cid]=1,c.bootstrap(e,f)):f(!0);return h}c.ActionBar.clear();if(a[0].classList.contains("tb_row_grid"))this.subRowDrop(a.data("slug"),a);else{var f={mod_name:a.data("module-slug")},
g=a.data("type"),l="part"===g||"module"===g;if(l)c.toolbar.libraryItems.get(a.data("id"),g,e);else return e(f);"visual"!==c.mode&&h(".themify-wp-editor-holder").addClass("themify-active-holder")}},toJSON(a){const b=[];a=a.children;for(let d=0,e=a.length;d<e;++d)if(a[d].classList.contains("module_row")){let e=c.Utils._getRowSettings(a[d]);0<Object.keys(e).length&&b.push(e)}return b},columnHover(a){for(var b=a.closest(".sub_column"),d=c.Instances.Builder[c.builderIndex].el.getElementsByClassName("tb_hover_sub_column"),
e=d.length-1;-1<e;--e)d[e].classList.remove("tb_hover_sub_column");d=c.Instances.Builder[c.builderIndex].el.getElementsByClassName("tb_action_overlap");for(e=d.length-1;-1<e;--e)d[e].classList.remove("tb_action_overlap");if(null!==b){var f=b.parentNode.closest(".module_column");if(!f.classList.contains("tb_hover_sub_column")&&(f.classList.add("tb_hover_sub_column"),d=b.getElementsByClassName("tb_column_action")[0],d!==n)){e=d.getBoundingClientRect();var g=!0;f=5>e.left?f.closest(".module_row").getElementsByClassName("tb_row_action")[0]:
b.closest(".module_subrow").getElementsByClassName("tb_subrow_action")[0];f!==n&&(g=f.getBoundingClientRect(),g=Math.abs(e.left-g.left)<e.width?Math.abs(g.top-e.top)>e.height:!0);!0===g?d.classList.remove("tb_action_overlap"):d.classList.add("tb_action_overlap")}}!0!==this.isFullWidth&&(b=null!==b?b.parentNode.closest(".module_column"):a.closest(".module_column"),!1!==this.isFullWidth&&(a=null!==b?b.closest(".module_row"):a.closest(".module_row"),null!==a&&(a.offsetWidth<p.body.clientWidth?(this.isFullWidth=
!0,p.body.classList.remove("tb_page_row_fullwidth")):(this.isFullWidth=!1,p.body.classList.add("tb_page_row_fullwidth")))),null!==b&&null!==b.parentNode.parentNode.closest(".fullwidth")&&(a=b.getElementsByClassName("tb_column_action")[0],a!==n&&a.getBoundingClientRect().right>=p.body.clientWidth&&a.classList.add("tb_action_outside")))}};c.undoManager={stack:[],is_working:!1,index:-1,btnUndo:null,btnRedo:null,compactBtn:null,init(){this.btnUndo=c.toolbar.el.getElementsByClassName("tb_undo_btn")[0];
this.btnRedo=c.toolbar.el.getElementsByClassName("tb_redo_btn")[0];this.compactBtn=c.toolbar.el.getElementsByClassName("tb_compact_undo")[0];c.toolbar.$el.find(".tb_undo_redo").on("click",this.do_change.bind(this));if(!themifyBuilder.disableShortcuts&&(h(r.document).on("keydown",this.keypres.bind(this)),"visual"===c.mode))h(p).on("keydown",this.keypres.bind(this))},push(a,b,d,e,f){c.hasChanged&&(c.editing=!1,d&&(d=m.clone(d)),"visual"!==c.mode||"duplicate"!==e&&"sort"!==e||v.trigger("tfsmartresize"),
this.stack.splice(this.index+1,this.stack.length-this.index),this.stack.push({cid:a,type:e,data:f,before:b,after:d}),this.index=this.stack.length-1,this.updateUndoBtns(),"visual"===c.mode&&(c.Forms.LayoutPart.isSaved=null,v.body.triggerHandler("builder_dom_changed",[e])))},set(a){var b=a[0].querySelectorAll("[data-cid]");b=Array.prototype.slice.call(b);b.unshift(a[0]);a=0;for(var d=b.length;a<d;++a){var e=c.Models.Registry.lookup(b[a].getAttribute("data-cid"));e&&e.trigger("change:view",b[a])}},doScroll(a){return a},
keypres(a){if(90===a.which&&"INPUT"!==p.activeElement.tagName&&"TEXTAREA"!==p.activeElement.tagName)if(!0===a.ctrlKey&&!0===a.shiftKey||!0===a.metaKey&&!0===a.shiftKey)a.preventDefault(),this.hasRedo()&&this.changes(!1);else if(!0===a.ctrlKey||!0===a.metaKey)a.preventDefault(),this.hasUndo()&&this.changes(!0)},changes(a){c.ActionBar.clearClicked();var b=a?0:1;if(null!==c.activeModel){if(!0===c.hasChanged){ThemifyConstructor.saveComponent(!1);h(this.btnUndo).triggerHandler("click");return}m.Lightbox.close()}var d=
this.stack[this.index+b];if(d!==n){this.is_working=!0;b="";var e=d.type,f=h(".tb_element_cid_"+d.cid),g=!1;c.eventName=e;if("row"===e)a?(b=m.clone(d.before),g=d.cid):(b=m.clone(d.after),g=d.before.data("cid"),f=h(".tb_element_cid_"+g)),this.doScroll(f),this.set(b),b.toggleClass("tb_row_empty",0===b.find(".active_module").length),f.replaceWith(b);else if("duplicate"===e)a?this.doScroll(h(".tb_element_cid_"+d.after.data("cid"))).remove():(this.doScroll(f),b=m.clone(d.after),g=d.before.data("cid"),this.set(b),
f.after(b));else if("delete_row"===e)a?(b=m.clone(d.before),g=d.cid,f=h(".tb_element_cid_"+d.data.pos_cid),this.doScroll(f),this.set(b),"after"===d.data.pos?f.after(b):f.before(b)):this.doScroll(f).remove();else if("sort"===e)g=d.cid,a?(f=d.data.before,b=m.clone(d.before)):(f=d.data.after,b=m.clone(d.after),"visual"===c.mode&&b.find(".active_module").css({display:"block",height:"auto"})),this.doScroll(b),this.set(b),d=h(".tb_element_cid_"+g).closest(".module_row"),h(".tb_element_cid_"+g).remove(),
d.toggleClass("tb_row_empty",0===d.find(".active_module").length),d=null,h(".tb_element_cid_"+f).replaceWith(b),d=b.closest(".module_row"),d.toggleClass("tb_row_empty",0===d.find(".active_module").length),d=null;else if("row_sort"===e){g=d.cid;var l=d.data[a?"bnext":"anext"];d=h(".tb_element_cid_"+d.data[a?"before":"after"]);f=h(".tb_element_cid_"+g);b=m.clone(f);f.remove();f=null;this.set(b);l?d.before(b):d.after(b);this.doScroll(b)}else if("save"===e){g=d.cid;e=c.Models.Registry.lookup(g);var k=
"module"===e.get("elType"),u=k?"mod_settings":"styling";if(k&&d.data.column)a?(d=h(".tb_element_cid_"+g).closest(".module_row"),g=!1,this.doScroll(f).remove()):(g=d.data.column.data("cid"),b=m.clone(d.data.column),f=h(".tb_element_cid_"+g),this.doScroll(f),this.set(b),f.replaceWith(b),d=b.closest(".module_row")),d.toggleClass("tb_row_empty",0===d.find(".active_module").length),d=null;else{this.doScroll(f);k={};a?(b=m.clone(d.before),k[u]=d.data.bsettings):(b=m.clone(d.after),k[u]=d.data.asettings);
if("visual"===c.mode){d=h.extend(!0,{},d.data.styles);for(var q in d){var t=ThemifyStyles.getSheet(q);t=t.cssRules?t.cssRules:t.rules;for(l in d[q])if(t[l])for(var w in d[q][l])t[l].style["backgroundClip"===w||"background-clip"===w?"WebkitBackgroundClip":w]=a?d[q][l][w].b:d[q][l][w].a}d=c.activeModel;l=k[u][c.GS.key]!==n?k[u][c.GS.key].split(" "):[];c.activeModel=e;c.GS.liveInstance=null;c.GS.generateValues(null,l,!0);c.activeModel=d;c.GS.liveInstance=null}e.set(k,{silent:!0});k=null;this.set(b);
f.replaceWith(b)}}else if("predesign"===e)if(f=d.data.rows,a)for(this.doScroll(h(".tb_element_cid_"+f[0].data("cid"))),l=0,e=f.length;l<e;++l)h(".tb_element_cid_"+f[l].data("cid")).remove();else{q=p.createDocumentFragment();b=[];l=0;for(e=f.length;l<e;++l)w=m.clone(f[l]),q.appendChild(w[0]),b.push(w);!1!==d.data.prev?this.doScroll(h(".tb_element_cid_"+d.data.prev)).after(q):this.doScroll("visual"===c.mode?h("#themify_builder_content-"+d.data.bid):h("#tb_row_wrapper")).prepend(q);l=0;for(e=b.length;l<
e;++l)this.set(b[l]),c.Mixins.Builder.update(b[l])}else if("import"===e){f=h('[data-postid="'+d.data.bid+'"]');d=a?d.data.before:d.data.after;var B=this;d=m.clone(d);f.children().remove();f.prepend(d);d.each(function(){B.set(h(this))})}else"grid_sort"===e&&(a?h(".tb_element_cid_"+d.cid).remove():(f=h(".tb_element_cid_"+d.before),b=m.clone(d.after),g=d.cid,d.data.next?f.before(b):f.after(b),this.set(b)));g&&(c.ActionBar.hoverCid=null,c.Mixins.Builder.update(h(b)));a?--this.index:++this.index;this.is_working=
!1;this.updateUndoBtns();c.toolbar.pageBreakModule.countModules();c.Utils.calculateHeight()}},hasRedo(){return this.index<this.stack.length-1},hasUndo(){return-1!==this.index},disable(){this.btnUndo.classList.add("tb_disabled");this.btnRedo.classList.add("tb_disabled");this.compactBtn.classList.add("tb_disabled")},updateUndoBtns(){var a=this.hasUndo(),b=this.hasRedo();a?this.btnUndo.classList.remove("tb_disabled"):this.btnUndo.classList.add("tb_disabled");b?this.btnRedo.classList.remove("tb_disabled"):
this.btnRedo.classList.add("tb_disabled");a||b?this.compactBtn.classList.remove("tb_disabled"):this.compactBtn.classList.add("tb_disabled")},reset(){this.stack=[];this.index=-1;this.updateUndoBtns()},do_change(a){a.preventDefault();a.stopPropagation();!1!==this.is_working||a.currentTarget.classList.contains("tb_disabled")||this.changes(a.currentTarget.classList.contains("tb_undo_btn"))}};c.Views.Toolbar=z.View.extend({events:{"click .tb_import":"import","click .tb_load_layout":"loadLayout","click .tb_save_layout":"saveLayout",
"click .tb_dup_link":"duplicate","click .tb_toolbar_save":"save","click .tb_toolbar_backend_edit a":"save","click .tb_toolbar_close_btn":"panelClose","click .tb_breakpoint_switcher":"breakpointSwitcher","click .tb_popular_devices li":"deviceSwitcher","change .tb_change_mode input":"modChange","click .tb_float_minimize":"minimize","click .tb_float_close":"closeFloat","click .tb_toolbar_add_modules":"openFloat","click .tb_custom_css":"addCustomCSS","click .tb_zoom":"zoom","click .tb_toolbar_zoom_menu_toggle":"zoom",
"click .tb_toolbar_builder_preview":"previewBuilder","click .js-tb_module_panel_acc":"toggleAccordion"},lightboxStorageKey:"tb_module_panel",render(){const a=this;var b={};for(var d in themifyBuilder.modules){var e=p.createElement("div"),f=p.createElement("div");let a=p.createElement("span"),l=p.createElement("strong"),k=p.createElement("a"),h=themifyBuilder.modules[d].icon;e.className="tb_module_outer tb-module-"+d;e.dataset.categories=themifyBuilder.modules[d].category;themifyBuilder.modules[d].favorite&&
(e.className+=" favorited");f.className="tb_module tb-module-type-"+d;a.className="tb_favorite tb_disable_sorting";l.className="module_name";l.textContent=themifyBuilder.modules[d].name;k.href="#";k.className="tf_plus_icon add_module_btn tb_disable_sorting";k.dataset.type="module";k.title=themifyBuilder.i18n.add_module;f.dataset.moduleSlug=d;themifyBuilder.modules[d].type&&(f.dataset.type=themifyBuilder.modules[d].type);h&&(a.appendChild(c.Utils.getIcon("ti-star")),f.appendChild(c.Utils.getIcon("ti-"+
h)));f.appendChild(a);f.appendChild(l);f.appendChild(k);e.appendChild(f);f=themifyBuilder.modules[d].favorite?["favorite"]:themifyBuilder.modules[d].category;for(let a=0,c=f.length;a<c;++a)b[f[a]]===n&&(b[f[a]]=p.createDocumentFragment()),b[f[a]].appendChild(e.cloneNode(!0))}d=this.el.getElementsByClassName("tb_module_category_content");for(e=d.length-1;-1<e;--e)if(f=d[e].getAttribute("data-category"))n!==b[f]?d[e].appendChild(b[f]):d[e].parentNode.style.display="none";"visual"===c.mode&&r.document.body.appendChild(this.el);
b=function(){a.Panel.init();c.undoManager.init();a.pageBreakModule.init();a.preDesignedRows.init();a.libraryItems.init();a.common.init();setTimeout(function(){a.setMode();a.help.init();setTimeout(function(){a.Revisions.init()},1200);"visual"===c.mode&&(c.Mixins.Builder.initModuleVisualDrag(".tb_module"),c.Mixins.Builder.initRowGridVisualDrag())},800);"visual"===c.mode&&(a.$el.on("click",".tb_favorite",a.toggleFavoriteModule),a.unload());v.body.on("click",".tb_favorite",a.toggleFavoriteModule);a.draggable();
"true"===localStorage.getItem("tb_panel_closed")?a.closeFloat():a.Panel.setFocus()};if("visual"===c.mode)r.jQuery("body").one("themify_builder_ready",b);else b()},setMode(){localStorage.getItem("tb_mode")?c.ActionBar.isHoverMode=null:(c.ActionBar.isHoverMode=!0,this.el.getElementsByClassName("tb_change_mode")[0].getElementsByClassName("tb-checkbox")[0].checked=!0);!0===c.ActionBar.isInit&&c.ActionBar.changeMode()},modChange(a){a.stopPropagation();a.currentTarget.classList.contains("tb_mode")?(!0===
a.currentTarget.checked?(localStorage.removeItem("tb_mode"),c.ActionBar.isHoverMode=!0):(localStorage.setItem("tb_mode",1),c.ActionBar.isHoverMode=null),c.ActionBar.clear(),c.ActionBar.clearClicked(),c.ActionBar.clearSelected(),c.ActionBar.changeMode()):a.currentTarget.classList.contains("tb_right_click_mode")?(!0===a.currentTarget.checked?localStorage.removeItem("tb_right_click"):localStorage.setItem("tb_right_click",1),c.ActionBar.initRightClick()):a.currentTarget.classList.contains("tb_padding_dragging_mode")&&
(!0===a.currentTarget.checked?localStorage.removeItem("tb_disable_padding_dragging"):localStorage.setItem("tb_disable_padding_dragging",1),c.EdgeDrag.init())},getStorage(){var a=localStorage.getItem(this.lightboxStorageKey);return a?JSON.parse(a):null},updateStorage(){var a=this.$el.find("#tb_module_panel"),b=a.position(),c=a.outerHeight();0>=c&&(c=(c=this.getStorage())?c.height:"");a={top:b.top,left:b.left,width:a.outerWidth(),height:c};localStorage.setItem(this.lightboxStorageKey,JSON.stringify(a))},
getPanelClass(a){return 195>=a?"tb_float_xsmall":270>=a?"tb_float_small":400>=a?"tb_float_medium":"tb_float_large"},_setResponsiveTabs(a){for(var b=c.toolbar.el.getElementsByClassName("tb_module_types"),d=b.length-1;-1<d;--d)"tb_float_xsmall"===a?(b[d].classList.add("tb_ui_dropdown_items"),b[d].parentNode.classList.add("tb_compact_tabs")):(b[d].classList.remove("tb_ui_dropdown_items"),b[d].parentNode.classList.remove("tb_compact_tabs"))},resize(){for(var a=this.el.getElementsByClassName("tb_modules_panel_wrap")[0],
b=this,c,e,f,g,l=a.getElementsByClassName("tb_resizable"),k,u,q=null,t=function(d){var l=c+g-d.clientX,h=null;if("w"===u||"sw"===u||"nw"===u){var t=a.style.width;h=parseInt(a.style.left)+parseInt(t)-l}if("w"!==u){if("y"===u||"-y"===u||"sw"===u||"se"===u||"nw"===u||"ne"===u)if(t="-y"===u||"ne"===u||"nw"===u?e+f-d.clientY:f+d.clientY-e,50<=t&&t<=q){if("-y"===u||"ne"===u||"nw"===u)a.style.top=parseInt(a.style.top)+parseInt(a.style.height)-t+"px";a.style.height=t+"px"}"sw"!==u&&"nw"!==u&&(l=g+d.clientX-
c)}if("y"!==u&&"-y"!==u){if(500<l||120>l)t=l,l=120>l?120:500,null!==h&&(h=h+t-l);null!==h&&(a.style.left=h+"px");a.style.width=l+"px";d=b.getPanelClass(l);k!==d&&(k&&a.classList.remove(k),a.classList.add(d),k=d,b._setResponsiveTabs(d))}},w=function(){r.document.body.classList.remove("tb_start_animate");r.document.body.classList.remove("tb_panel_resize");r.document.removeEventListener("mousemove",t,{passive:!0});r.document.removeEventListener("mouseup",w,{passive:!0});c=g=u=k=null;b.updateStorage()},
B=l.length-1;-1<B;--B)l[B].addEventListener("mousedown",function(b){1===b.which&&(r.document.body.classList.add("tb_start_animate"),r.document.body.classList.add("tb_panel_resize"),u=this.dataset.axis,c=b.clientX,e=b.clientY,q=h(x).height()-50,f=parseInt(h(a).outerHeight(),10),g=parseInt(h(a).outerWidth(),10),r.document.addEventListener("mousemove",t,{passive:!0}),r.document.addEventListener("mouseup",w,{passive:!0}))},{passive:!0})},setFloat(){var a=this.Panel.el.find("#tb_module_panel");a[0].classList.add("tb_panel_floating");
var b=this.getStorage();b&&(a[0].style.width=b.width+"px",a[0].style.height=b.height+"px");b=this.getPanelClass(a.width());a[0].classList.add(b);this._setResponsiveTabs(b)},removeFloat(){this.Panel.el.find("#tb_module_panel").css({top:"",width:"",height:"",left:"",right:"",bottom:""}).removeClass("tb_panel_floating tb_float_xsmall tb_float_small tb_float_medium tb_float_large tb_is_minimize")},draggable(){var a=this.$el.find("#tb_module_panel"),b=this;if(!m.Lightbox.dockMode.get()){a[0].classList.add("tb_panel_floating");
var d=this.getStorage(),e=null;if(d){for(var f in d)a[0].style[f]=d[f]+"px";e=d.width}else e=a.width();d=this.getPanelClass(e);a[0].classList.add(d);this._setResponsiveTabs(d)}a.draggable({handle:".tb_drag_handle",cancel:".tb_module_types",scroll:!0,start(a,d){r.document.body.classList.add("tb_panel_drag");b.setFloat();m.Lightbox.dockMode.get()&&(m.Lightbox.dockMode.close(),setTimeout(function(){c.Utils._onResize(!0)},100))},drag(a,b){"visual"===c.mode&&m.Lightbox.dockMode.drag(a,b)},stop(a,d){r.document.body.classList.remove("tb_panel_drag");
m.Lightbox.dockMode.drag(a,d);if(m.Lightbox.dockMode.get())b.removeFloat(),b._setResponsiveTabs(!1);else{a=h(r).height()-30;var e=d.position.top,f={};0>e?f.top=0:e>a&&(f.top=a);for(var g in f)d.helper[0].style[g]=f[g]+"px";b.updateStorage()}"visual"===c.mode&&h(p).triggerHandler("mouseup")}});this.resize()},minimize(a){a.preventDefault();a.stopPropagation();a=h(a.currentTarget).closest("#tb_module_panel");if(a.hasClass("tb_is_minimize")){a.removeClass("tb_is_minimize");const b=this.getStorage();a.css("height",
b?b.height:"")}else a.addClass("tb_is_minimize");"visual"===c.mode&&h(p).triggerHandler("mouseup")},import(a){a.preventDefault();a.stopPropagation();var b=a.currentTarget.getAttribute("data-component"),d=r.document.getElementsByTagName("body")[0],e={contructor:"file"!==b,dataType:"json",data:{action:"builder_import",type:b}};if("file"!==b||confirm(themifyBuilder.i18n.importFileConfirm))if("file"===b)a=r.document.getElementById("tb_import_filestb_plupload_browse_button"),null===a?(a=p.createElement("input"),
b=p.createElement("div"),e=p.createElement("span"),b.id="tb_import_filestb_plupload_upload_ui",b.style.display="none",a.type="button",a.id="tb_import_filestb_plupload_browse_button",e.className="ajaxnonceplu",e.id=themifyBuilder.import_nonce,b.appendChild(a),b.appendChild(e),d.appendChild(b),c.Utils.builderPlupload("",a.parentNode)):a.click();else{m.Lightbox.$lightbox[0].style.display="none";var f=h(a.currentTarget.closest("ul")),g=f.offset(),l=g.top+f.height()-40;v.body.off("themify_builder_lightbox_close.import");
f.addClass("tb_current_menu_selected");null!==c.Forms.LayoutPart.id&&(l-=x.pageYOffset+60);m.Lightbox.open(e,function(){d.classList.add("tb_standalone_lightbox")},function(){this.$lightbox[0].classList.add("tb_import_post_lightbox");this.setStandAlone(g.left,l,!0);v.body.one("themify_builder_lightbox_close.import",function(){d.classList.remove("tb_standalone_lightbox");m.Lightbox.$lightbox[0].classList.remove("tb_import_post_lightbox");f.removeClass("tb_current_menu_selected");d=null});h("#tb_submit_import_form",
m.Lightbox.$lightbox).one("click",function(a){a.preventDefault();m.LiteLightbox.confirm(themifyBuilder.i18n.dialog_import_page_post,function(a){h.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"builder_import_submit",nonce:themifyBuilder.tb_load_nonce,data:c.Forms.serialize("tb_options_import"),importType:"no"===a?"replace":"append",importTo:themifyBuilder.post_ID},beforeSend(a){m.showLoader("show")},success(a){a.builder_data!==n?c.Forms.reLoad(a,themifyBuilder.post_ID):
m.showLoader("error");m.Lightbox.close()}})},{buttons:{no:{label:ThemifyConstructor.label.replace_builder},yes:{label:ThemifyConstructor.label.append_builder}}})})})}},unload(){"visual"===c.mode&&p.head.insertAdjacentHTML("afterbegin",'<base target="_parent">');r.onbeforeunload=function(){return c.editing||!c.hasChanged&&!c.undoManager.hasUndo()?null:"Are you sure"}},panelClose(a){a.preventDefault();r.location.reload(!0)},loadLayout(a){a.preventDefault();a.stopPropagation();var b=this,d=r.document.body,
e=h(a.currentTarget.closest("ul"));a=b.layoutsList?{loadMethod:"html",data:b.layoutsList}:{data:{action:"tb_load_layout"}};m.Lightbox.$lightbox[0].style.display="none";e.addClass("tb_current_menu_selected");v.body.off("themify_builder_lightbox_close.loadLayout");m.Lightbox.open(a,function(){d.classList.add("tb_load_layout_active");d.classList.add("tb_standalone_lightbox")},function(){function a(){l.on("click.loadLayout",".layout_preview img",function(a){a.preventDefault();a.stopPropagation();var d=
h(this).closest(".layout_preview");m.LiteLightbox.confirm(themifyBuilder.i18n.confirm_template_selected,function(a){var e=d.closest("ul").data("group"),f=function(d){if("no"!==a){var e="visual"!==c.mode?p.getElementById("tb_row_wrapper"):p.getElementsByClassName("themify_builder_content-"+themifyBuilder.post_ID)[0];e=c.Mixins.Builder.toJSON(e);var f=[],g;for(g in e)f.push(e[g]);e=null;for(g in d)f.push(d[g]);d=f;f=null}!0!==b.is_set&&h.ajax({type:"POST",url:themifyBuilder.ajaxurl,data:{action:"set_layout_action",
nonce:themifyBuilder.tb_load_nonce,mode:"no"!==a?1:0,id:themifyBuilder.post_ID},success(){b.is_set=!0}});c.Forms.reLoad(d,themifyBuilder.post_ID);m.Lightbox.close()};if("pre-designed"===e){m.showLoader("show");var g=d.data("slug"),k=themifyBuilder.paths.layout_template.replace("{SLUG}",g);if(!c.layouts_selected)c.layouts_selected={};else if(c.layouts_selected[g]){c.Utils.clearElementId(c.layouts_selected[g]);f(JSON.parse(c.layouts_selected[g]));return}h.get(k,null,null,"text").done(function(a){c.layouts_selected[g]=
a;let b=JSON.parse(a);-1!==a.indexOf(c.GS.key)?h.getJSON(themifyBuilder.paths.layout_template.replace("{SLUG}",g+"-gs")).done(function(a){const d={};for(let b in a)a[b]["class"]!==n?d[a[b]["class"]]=a[b]:d[b]=a[b];c.GS.setImport(d,function(){f(b)},b)}).fail(function(a,c,d){f(b)}):f(b)}).fail(function(a,b,c){m.LiteLightbox.alert(ThemifyConstructor.label.layout_error.replace("{FILE}",k))}).always(function(){m.showLoader()})}else h.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tb_set_layout",
nonce:themifyBuilder.tb_load_nonce,layout_slug:d.data("slug"),layout_group:e,mode:"no"!==a?1:0},beforeSend(){"visual"===c.mode&&m.showLoader("show")},success(a){a.data?(a.gs&&(c.GS.styles=h.extend(!0,{},a.gs,c.GS.styles)),f(a.data),m.showLoader()):(m.showLoader("error"),alert(a.msg),m.Lightbox.close())}})},{buttons:{no:{label:ThemifyConstructor.label.layout_replace},yes:{label:ThemifyConstructor.label.layout_append}}})})}function g(){a();const b=k.find(".layout_preview_list");u.show().find("li").on("click",
function(a){a.preventDefault();a.stopPropagation();this.classList.contains("current")||(a=b,this.classList.contains("all")||(b.hide(),a=b.filter("[data-category"+(""!==themifyBuilder.paths.layouts_index?"*":"")+'="'+h(this).text()+'"]')),a.show(),h(this).addClass("current").siblings().removeClass("current"),u.parent().find(".tb_ui_dropdown_label").html(h(this).text()));c.Utils.hideOnClick(u)});u.find(".tb_selected_cat").click();l.find("#tb_layout_search").on("keyup",function(){let a=h.trim(h(this).val());
var c=b;""!==a&&(c=u.find("li.all"),c[0].classList.contains("current")||c.click(),b.hide(),c=b.find(".layout_title:contains("+a+")").closest(".layout_preview_list"));c.show()})[0].focus();v.body.one("themify_builder_lightbox_close.loadLayout",function(){l.off("click.loadLayout")[0].classList.remove("tb_predesigned_lightbox");k.find("#tb_layout_search").off("keyup");k=l=null;d.classList.remove("tb_load_layout_active");d.classList.remove("tb_standalone_lightbox");e.removeClass("tb_current_menu_selected")})}
var l=this.$lightbox,k=l.find("#tb_tabs_pre-designed");if(0===k.length)d.classList.remove("tb_load_layout_active"),d.classList.remove("tb_standalone_lightbox"),e.removeClass("tb_current_menu_selected"),a();else{l[0].classList.add("tb_predesigned_lightbox");this.setStandAlone(r.innerWidth/2,(r.document.documentElement.clientHeight-l.height())/2,!0);var u=k.find(".tb_ui_dropdown_items");b.layoutsList?g():h.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tb_load_predesigned_layouts",
nonce:themifyBuilder.tb_load_nonce,src:themifyBuilder.paths.layouts_index,id:themifyBuilder.post_ID},success(a){const d=JSON.parse(a.data);if(""===themifyBuilder.paths.layouts_index){var e=Object.keys(d);c.layouts_selected={};for(var f=e.length-1;-1<f;--f)c.layouts_selected[d[e[f]].slug]=d[e[f]].data}{a=a.selected;e={};f=p.createDocumentFragment();const t=p.createDocumentFragment();for(let b=0,g=d.length;b<g;++b){var h=p.createElement("li"),q=p.createElement("div");let g=p.createElement("div"),k=
p.createElement("img"),l=p.createElement("div");var m=p.createElement("div");h.className="layout_preview_list";h.dataset.category=d[b].category;q.className="layout_preview";q.dataset.id=d[b].id;q.dataset.slug=d[b].slug;g.className="thumbnail";k.src=d[b].thumbnail;k.alt=d[b].title;k.title=d[b].title;l.className="layout_action";m.className="layout_title";m.textContent=d[b].title;l.appendChild(m);n!==d[b].url&&(m=p.createElement("a"),m.className="layout-preview-link",m.href=d[b].url,m.target="_blank",
m.title=themifyBuilder.i18n.preview,m.appendChild(c.Utils.getIcon("ti-search")),l.appendChild(m));g.appendChild(k);q.appendChild(g);q.appendChild(l);h.appendChild(q);f.appendChild(h);if(d[b].category){h=String(d[b].category).split(",");for(let b=0,c=h.length;b<c;++b)""!==h[b]&&1!==e[h[b]]&&(q=p.createElement("li"),q.textContent=h[b],t.appendChild(q),e[h[b]]=1,h[b]===a&&(q.className="tb_selected_cat"))}}u[0].appendChild(t);k[0].getElementsByClassName("tb_layout_lists")[0].appendChild(f);b.layoutsList=
l[0].getElementsByClassName("tb_options_tab_wrapper")[0].cloneNode(!0);g()}},error(){m.LiteLightbox.alert(h("#tb_load_layout_error",k).show().text())}})}})},saveLayout(a){a.preventDefault();a.stopPropagation();const b={contructor:!0,loadMethod:"html",save:{},data:{save_as_layout:{options:[{id:"layout_title_field",type:"text",label:ThemifyConstructor.label.title},{id:"layout_img_field",type:"image",label:ThemifyConstructor.label.image_preview},{id:"layout_img_field_id",type:"hidden"},{id:"postid",
type:"hidden",value:themifyBuilder.post_ID}]}}},d=h(a.currentTarget.closest("ul"));d.addClass("tb_current_menu_selected");m.Lightbox.$lightbox[0].style.display="none";m.Lightbox.open(b,function(){r.document.body.classList.add("tb_standalone_lightbox")},function(){const b=this.$lightbox;b.find(".builder_save_button").one("click",function(a){a.stopPropagation();a.preventDefault();h.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tb_save_custom_layout",nonce:themifyBuilder.tb_load_nonce,
form_data:c.Forms.serialize(b[0])},beforeSend(){m.showLoader("show")},success(a){"success"===a.status?(m.showLoader(),m.Lightbox.close()):(m.showLoader("error"),alert(a.msg))}})});b.addClass("tb_savead_lightbox");this.setStandAlone(a.clientX,a.clientY);v.body.one("themify_builder_lightbox_close",function(){b.removeClass("tb_savead_lightbox").find(".builder_save_button").off("click");r.document.body.classList.remove("tb_standalone_lightbox");d.removeClass("tb_current_menu_selected")})})},duplicate(a){function b(){d.Revisions.ajax({action:"tb_duplicate_page",
tb_is_admin:"visual"!==c.mode},function(a){a&&(r.location.href=h("<div/>").html(a).text())})}a.preventDefault();a.stopPropagation();const d=this;confirm(themifyBuilder.i18n.confirm_on_duplicate_page)&&c.Utils.saveBuilder(b)},addCustomCSS(a){a.preventDefault();a.stopPropagation();null!==c.activeModel&&ThemifyConstructor.saveComponent(!0);null===y&&(y=themifyBuilder.custom_css,delete themifyBuilder.custom_css);y||(y="");const b={contructor:!0,loadMethod:"html",save:{},data:{css:{options:[{id:"custom_css",
type:"textarea",rows:17,class:"fullwidth"},{id:"custom_css_m",type:"message",label:"",comment:ThemifyConstructor.label.cus_css_m},{id:"postid",type:"hidden",value:themifyBuilder.post_ID}]}}},d=a.currentTarget;d.classList.add("tb_tooltip_active");m.Lightbox.$lightbox[0].style.display="none";r.document.body.classList.add("tb_standalone_lightbox");m.Lightbox.open(b,null,function(){const b=this.$lightbox,f=b[0].querySelector("#custom_css");f.value=y;"visual"===c.mode&&f.addEventListener("input",function(){let a=
p.getElementById("tb_custom_css_tmp");null===a&&(a=p.createElement("style"),a.type="text/css",a.id="tb_custom_css_tmp",p.head.appendChild(a));a.innerHTML=this.value.trim()});b.addClass("tb_custom_css_lightbox").find(".builder_save_button").one("click",function(a){a.stopImmediatePropagation();a.preventDefault();y=f.value.trim();m.Lightbox.close()});this.setStandAlone(a.clientX,a.clientY);v.body.one("themify_builder_lightbox_close",function(){y||(y="",d.classList.add("tb_tooltip_active"));const a=p.getElementById("tb_custom_css_tmp");
a&&(a.innerHTML=y);r.document.body.classList.remove("tb_standalone_lightbox")})})},Revisions:{init(){c.toolbar.$el.find(".tb_revision").on("click",this.revision.bind(this))},revision(a){a.preventDefault();a.stopPropagation();a.currentTarget.classList.contains("tb_save_revision")?this.saveEvent():this.load(a)},load(a){const b=this,c=h("body",r.document),e=h(a.currentTarget.closest("ul")),f=e.offset();e.addClass("tb_current_menu_selected");m.Lightbox.$lightbox[0].style.display="none";v.body.off("themify_builder_lightbox_close.revisions");
b.ajax({action:"tb_load_revision_lists"},function(a){m.Lightbox.open({contructor:!0,loadMethod:"html",data:{revision:{html:h(a)[0]}}},function(){c.addClass("tb_standalone_lightbox")},function(){this.$lightbox[0].classList.add("tb_revision_lightbox");this.setStandAlone(f.left,f.top,!0);c.on("click.revision",".js-builder-restore-revision-btn",b.restore.bind(b)).on("click.revision",".js-builder-delete-revision-btn",b.delete.bind(b));v.body.one("themify_builder_lightbox_close.revisions",function(){e.removeClass("tb_current_menu_selected");
c.off(".revision").removeClass("tb_standalone_lightbox");m.Lightbox.$lightbox[0].classList.remove("tb_revision_lightbox")})})})},ajax(a,b){a=h.extend({},a,{tb_load_nonce:themifyBuilder.tb_load_nonce,postid:themifyBuilder.post_ID,sourceEditor:"visual"===c.mode?"frontend":"backend"});return h.ajax({type:"POST",url:themifyBuilder.ajaxurl,data:a,beforeSend(){m.showLoader("show")},complete(){m.showLoader("hide")},success(a){h.isFunction(b)&&b.call(this,a)}})},saveEvent(a){const b=this;m.LiteLightbox.prompt(themifyBuilder.i18n.enterRevComment,
function(c){null!==c&&b.saveRevision(c,a)})},saveRevision(a,b){const d=c.Utils.saveBuilder(null,0,!0);this.ajax({action:"tb_save_revision",rev_comment:a,data:JSON.stringify(c.Utils.clear(d.data)),postid:d.id},b)},restore(a){a.preventDefault();a.stopPropagation();const b=h(a.currentTarget).data("rev-id"),d=this,e=function(){d.ajax({action:"tb_restore_revision_page",revid:b},function(a){a.builder_data?(c.Forms.reLoad(a,themifyBuilder.post_ID),m.Lightbox.close()):(m.showLoader("error"),alert(a.data))})};
m.LiteLightbox.confirm(themifyBuilder.i18n.confirmRestoreRev,function(a){"yes"===a?d.saveEvent(e):e()},{buttons:{no:{label:ThemifyConstructor.label.save_no},yes:{label:ThemifyConstructor.label.save}}})},delete(a){a.preventDefault();a.stopPropagation();if(confirm(themifyBuilder.i18n.confirmDeleteRev)){var b=h(a.currentTarget);a=b.data("rev-id");this.ajax({action:"tb_delete_revision",revid:a},function(a){a.success?b.closest("li").remove():(m.showLoader("error"),alert(a.data))})}}},save(a){a.preventDefault();
a.stopPropagation();const b=0<h(a.currentTarget).closest(".tb_toolbar_backend_edit").length?h(a.currentTarget).prop("href"):!1;themifyBuilder.is_gutenberg_editor&&!1!==b?(c.undoManager.reset(),c._backendSwitchFrontend(b)):c.Utils.saveBuilder(function(a,e){"success"!==e?alert(themifyBuilder.i18n.errorSaveBuilder):!1!==b&&("visual"===c.mode?(sessionStorage.setItem("focusBackendEditor",!0),r.location.href=b):(c.undoManager.reset(),c._backendSwitchFrontend(b)))})},libraryItems:{items:[],is_init:null,
init(){h(p).one("tb_panel_tab_tb_module_panel_library_wrap",this.load.bind(this))},load(a,b){const d=this;b=h(b).find(".tb_module_panel_library_wrap");b.addClass("tb_busy");h.ajax({type:"POST",url:themifyBuilder.ajaxurl,data:{action:"tb_get_library_items",nonce:themifyBuilder.tb_load_nonce,part:"all",pid:themifyBuilder.post_ID},success(a){d.setData(a);b.removeClass("tb_busy");d.is_init=!0},error(){b.removeClass("tb_busy");m.showLoader("error");d.init();c.toolbar.$el.find(".tb_library_item_list").html("<h3>Failed to load Library Items.</h3>")}})},
get(a,b,d){if(this.items[a]!==n)d(this.items[a]);else{const e=this;h.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tb_get_library_item",nonce:themifyBuilder.tb_load_nonce,type:b,id:a},beforeSend(a){m.showLoader("show")},success(b){b.content.gs&&(c.GS.styles=h.extend(!0,{},b.content.gs,c.GS.styles),delete b.content.gs);m.showLoader("hide");"success"===b.status?(e.items[a]=b.content,d(b.content)):m.showLoader("error")},error(){m.showLoader("error")}})}},template(a){let b=
"";for(let c=0,e=a.length;c<e;++c){let d="part";-1!==a[c].post_type.indexOf("_rows",5)?d="row":-1!==a[c].post_type.indexOf("_module",5)&&(d="module");b+='<div class="tb_library_item tb_item_'+d+'" data-type="'+d+'" data-id="'+a[c].id+'">';b+='<div class="tb_library_item_inner"><span>'+a[c].post_title+"</span>";b+='<a href="#" class="remove_item_btn tb_disable_sorting tf_close" title="Delete"></a></div></div>'}return b},bindEvents(a){"visual"===c.mode?(c.Mixins.Builder.initModuleVisualDrag(".tb_item_module,.tb_item_part"),
c.Mixins.Builder.initRowVisualDrag(".tb_item_row")):(c.Mixins.Builder.initRowDraggable(c.toolbar.$el.find(".tb_module_panel_library_wrap").first(),".tb_item_row"),c.Mixins.Builder.initModuleDraggable(c.toolbar.$el.find(".tb_library_item_list").first(),".tb_item_module,.tb_item_part"));if(c.toolbar.common.btn||"visual"===c.mode&&(c.toolbar.common.is_init||a))c.Mixins.Builder.initRowDraggable(c.toolbar.common.btn.find(".tb_module_panel_library_wrap").first(),".tb_item_row"),c.Mixins.Builder.initModuleDraggable(c.toolbar.common.btn.find(".tb_library_item_list").first(),
".tb_item_module,.tb_item_part")},setData(a){a='<span class="tb_no_content" style="display:none">No library content found.</span>'+this.template(a);var b=h(".tb_library_item_list");"visual"===c.mode&&(b=b.add(c.toolbar.$el.find(".tb_library_item_list")));b=b.get();for(let c=b.length-1;-1<c;--c)b[c].insertAdjacentHTML("afterbegin",a),b[c].previousElementSibling.getElementsByClassName("current")[0].click();v.body.on("click",".remove_item_btn",this.delete.bind(this));if("visual"===c.mode)c.toolbar.$el.on("click",
".remove_item_btn",this.delete.bind(this));this.bindEvents()},delete(a){a.preventDefault();a.stopPropagation();let b=h(a.currentTarget).closest(".tb_library_item"),d=b.data("type");if(confirm(themifyBuilder.i18n[d+"LibraryDeleteConfirm"])){const a=b.data("id");h.ajax({type:"POST",url:themifyBuilder.ajaxurl,data:{action:"tb_remove_library_item",nonce:themifyBuilder.tb_load_nonce,id:a},beforeSend(a){m.showLoader("show")},success(e){m.showLoader("hide");if(e){var f=0<b.closest("#"+c.toolbar.common.btn.prop("id")).length?
c.toolbar.$el.find(".tb_item_"+d+'[data-id="'+a+'"]'):c.toolbar.common.btn.find(".tb_item_"+d+'[data-id="'+a+'"]');b=b.add(f);if("part"===d){b=b.add(h(".themify_builder_content-"+a).closest(".active_module"));f=ThemifyConstructor.layoutPart.data;for(var l=f.length-1;-1<l;--l)if(f[l].post_name===e){ThemifyConstructor.layoutPart.data.splice(l,1);break}}e=b.parent().siblings(".tb_library_types").find(".current");b.remove();e.trigger("click")}else m.showLoader("error")},error(){m.showLoader("error")}})}}},
preDesignedRows:{is_init:null,rows:{},items:{},currentCategory:"All",categories:{All:{isLoaded:!1}},loadingItems:!1,init(){setTimeout(function(){var a=r.document.createElement("meta");const b=r.document.head,c=[{href:"//themify.me",rel:"dns-prefetch preconnect"},{href:"//fonts.googleapis.com",rel:"dns-prefetch preconnect"},{href:"//maps.googleapis.com",rel:"dns-prefetch preconnect"},{href:themifyBuilder.paths.rows_index,rel:"prefetch"},{href:themifyBuilder.paths.layouts_index,rel:"prefetch"}];a.content=
"on";a.setAttribute("http-equiv","x-dns-prefetch-control");b.appendChild(a);for(let d in c)a=r.document.createElement("link"),a.setAttribute("crossorigin",!0),a.rel=c[d].rel,a.href=c[d].href,b.appendChild(a)},7E3);h(p).one("tb_panel_tab_tb_module_panel_rows_wrap",this.load.bind(this))},load(a,b){const d=this;b=h(b).find(".tb_predesigned_rows_list");b.addClass("tb_busy");h.getJSON(themifyBuilder.paths.rows_index).done(function(a){d.setData(a,b)}).fail(function(a,f,g){d.setData({},b);d.is_init=null;
m.showLoader("error");c.toolbar.$el.find(".tb_predesigned_rows_container").append("<h3>"+ThemifyConstructor.label.rows_fetch_error+"</h3>");h(p).one("tb_panel_tab_tb_module_panel_rows_wrap",d.load.bind(d))})},masonry(a){const b=a.querySelectorAll('.predesigned_row:not([data-masonry="done"])');for(let d=0,g=b.length;d<g;d++)a:{var c=b[d],e=parseInt(x.top.getComputedStyle(a).getPropertyValue("grid-row-gap"));const f=parseInt(x.top.getComputedStyle(a).getPropertyValue("grid-auto-rows"));if(isNaN(e)||
isNaN(f))break a;const g=c.getElementsByClassName("tb_predesigned_rows_image")[0].getBoundingClientRect().height+c.getElementsByClassName("tb_predesigned_rows_title")[0].getBoundingClientRect().height;e=Math.ceil((g+e)/(f+e));c.style.gridRowEnd="span "+e;5<e&&(c.dataset.masonry="done")}},loadItems(a){this.loadingItems=!0;const b=this.currentCategory,c=p.createDocumentFragment();if(!0===this.categories.All.isLoaded||!0===this.categories[b].isLoaded)return this.loadingItems=!1,c;var e=0,f=Object.keys(this.items),
g=f.length;for(let d=0;d<g&&!(10<=e&&n==a);d++){let g=this.items[f[d]];var h=""!==a?new RegExp(a,"i"):!1;if(!h||!h.test(g.title))continue;var k=g.category.split(",");if("All"!==b&&-1===k.indexOf(b))continue;delete this.items[f[d]];h="";for(let a=0,b=k.length;a<b;++a)h+=this.categories[k[a]].hash;k=p.createElement("div");let l=p.createElement("figure"),u=p.createElement("div"),m=new Image,r=p.createElement("a");k.className="predesigned_row "+h;k.setAttribute("data-slug",g.slug);l.className="tb_predesigned_rows_image";
u.className="tb_predesigned_rows_title";u.textContent=m.alt=m.title=g.title;m.src=g.thumbnail===n||""===g.thumbnail?"https://placeholdit.imgix.net/~text?txtsize=24&txt="+encodeURI(g.title)+"&w=181&h=77":g.thumbnail;m.width=500;m.height=300;r.href="#";r.className="tf_plus_icon add_module_btn tb_disable_sorting";r.dataset.type="predesigned";l.appendChild(m);l.appendChild(r);k.appendChild(l);k.appendChild(u);c.appendChild(k);++e}this.categories[b].isLoaded=10>e&&n===a;return c},setData(a){this.items=
a;var b=[];a=p.createDocumentFragment();const d=this;for(let a=0,c=this.items.length;a<c;++a){var e=this.items[a].category.split(",");for(let a=0,c=e.length;a<c;++a){var f=v.hash(e[a]);-1===b.indexOf(e[a])&&(b.push(e[a]),this.categories[e[a]]={hash:"tb"+f})}}b.sort();for(let c=0,d=b.length;c<d;++c)e=p.createElement("li"),e.setAttribute("data-slug",v.hash(b[c])),e.textContent=b[c],a.appendChild(e);b=h(".tb_module_panel_container .tb_ui_dropdown .tb_ui_dropdown_items");e=h(".tb_predesigned_rows_container");
"visual"===c.mode&&(e=e.add(c.toolbar.$el.find(".tb_predesigned_rows_container")),b=b.add(c.toolbar.$el.find(".tb_module_panel_container .tb_ui_dropdown .tb_ui_dropdown_items")));b=b.get();e=e.get();f=this.loadItems();for(let c=b.length-1;-1<c;--c){b[c].appendChild(a.cloneNode(!0));e[c].appendChild(f.cloneNode(!0));let g=e[c].getElementsByTagName("img");0<g.length?(g=g[g.length-1],h(g).one("load",function(){d.initCallback(h(this).closest(".tb_predesigned_rows_container")[0],!0)})):d.initCallback(e[c],
!0)}v.body.on("click",".tb_module_panel_container .tb_ui_dropdown_items li",this.filter.bind(this));if("visual"===c.mode)h("body",r.document).on("click",".tb_module_panel_container .tb_ui_dropdown_items li",this.filter.bind(this))},initCallback:function(a,b){b&&(a.closest(".tb_module_panel_rows_wrap").addEventListener("scroll",this.scrollLoadMore.bind(this),{passive:!0}),this.is_init=!0);var d=h(a);"visual"===c.mode?c.Mixins.Builder.initRowVisualDrag(".predesigned_row"):c.Mixins.Builder.initRowDraggable(c.toolbar.$el.find(".tb_predesigned_rows_container").first(),
".predesigned_row");c.toolbar.common.is_init&&c.Mixins.Builder.initRowDraggable(c.toolbar.common.btn.find(".tb_predesigned_rows_container").first(),".predesigned_row");b&&d.closest(".tb_predesigned_rows_list").removeClass("tb_busy").closest(".tb_module_panel_tab").find(".tb_ui_dropdown").css("visibility","visible");h(a).parents("#tb_module_panel_dropdown").length&&this.masonry(a);this.loadingItems=!1},get(a,b){m.showLoader("show");if(this.rows[a]!==n)"function"===typeof b&&b(this.rows[a]);else{var d=
this;h.getJSON(themifyBuilder.paths.row_template.replace("{SLUG}",a)).done(function(e){c.Utils.clearElementId(e);d.rows[a]=e;-1!==JSON.stringify(e).indexOf(c.GS.key)?h.getJSON(themifyBuilder.paths.row_template.replace("{SLUG}",a+"-gs")).done(function(a){const d={};for(let b in a)a[b]["class"]!==n?d[a[b]["class"]]=a[b]:d[b]=a[b];c.GS.setImport(d,b,e)}).fail(function(a,c,d){"function"===typeof b&&b(e)}):"function"===typeof b&&b(e)}).fail(function(a,b,c){m.showLoader("error");alert(ThemifyConstructor.label.row_fetch_error)})}},
filter(a){a.preventDefault();a.stopPropagation();a=h(a.currentTarget);const b=a.data("slug"),d=a.closest(".tb_module_panel_tab"),e=d.find(".tb_ui_dropdown_label"),f=d.find(".predesigned_row"),g=a.text();this.currentCategory=g;this.addNewItems();e.text(g);d.find(".tb_module_panel_search_text").val("");const l=b?"tb"+b:!1;e.data("active",l);a.addClass("current").siblings().removeClass("current");f.each(function(){!l||this.classList.contains(l)?h(this).show():h(this).hide()}).filter(":visible").each(function(a){0===
(a+1)%4?h(this).addClass("tb_column_break"):h(this).removeClass("tb_column_break")});c.Utils.hideOnClick(d.find(".tb_ui_dropdown_items"))},addNewItems:function(a){this.currentCategory=n!==a?"All":this.currentCategory;if(!this.categories[this.currentCategory].isLoaded){var b=h(".tb_module_panel_container .tb_ui_dropdown .tb_ui_dropdown_items"),d=h(".tb_predesigned_rows_container");"visual"===c.mode&&(d=d.add(c.toolbar.$el.find(".tb_predesigned_rows_container")),b=b.add(c.toolbar.$el.find(".tb_module_panel_container .tb_ui_dropdown .tb_ui_dropdown_items")));
b=b.get();d=d.get();a=this.loadItems(a);var e=this;for(b=b.length-1;-1<b;--b){d[b].appendChild(a.cloneNode(!0));let c=d[b].getElementsByTagName("img");0<c.length?(c=c[c.length-1],h(c).one("load",function(){e.initCallback(h(this).closest(".tb_predesigned_rows_container")[0])})):e.initCallback(d[b])}}},scrollLoadMore:function(a){this.loadingItems||!0===this.categories[this.currentCategory].isLoaded||(a=a.target,a=Math.max(a.scrollHeight-(a.scrollTop+a.offsetHeight),0),0<a&&200>=a&&this.addNewItems())}},
pageBreakModule:{init(){"visual"===c.mode?c.Mixins.Builder.initRowVisualDrag(".tb_page_break_module"):c.Mixins.Builder.initRowDraggable(c.toolbar.$el.find(".tb_module_panel_modules_wrap").first(),".tb_page_break_module")},countModules(){const a="visual"===c.mode?p.getElementsByClassName("module-page-break"):p.getElementsByClassName("tb-page-break");for(let b=a.length-1;-1<b;--b)"visual"===c.mode?a[b].getElementsByClassName("page-break-order")[0].textContent=b+1:a[b].getElementsByClassName("page-break-overlay")[0].textContent=
"PAGE BREAK - "+(b+1)},get(){return[{cols:[{grid_class:"col-full first last",modules:[{mod_name:"page-break"}]}],column_alignment:"col_align_middle",styling:{custom_css_row:"tb-page-break"}}]}},common:{btn:null,is_init:null,clicked:null,init(){const a=this;let b=p.createElement("div"),d=c.toolbar.$el;b.className="tb_modules_panel_wrap";b.id="tb_module_panel_dropdown";this.btn=h(b);d=d.add(m.Lightbox.$lightbox);"visual"!==c.mode&&null!==p.querySelector(".edit-post-layout__content")?h(".edit-post-layout__content")[0].appendChild(this.btn[0]):
v.body[0].appendChild(this.btn[0]);if("visual"===c.mode)c.toolbar.$el.find(".tb_module_types li").on("click",this.tabs.bind(this));v.body.on("click",".tb_module_types li",this.tabs.bind(this)).on("click",".tb_column_btn_plus",this.show.bind(this));d.on("click",".tb_clear_input",this.clear);c.toolbar.$el.find(".tb_module_panel_search_text").on("keyup",this.search.bind(this));this.btn.on("click",".add_module_btn,.js-tb_module_panel_acc",function(b){b.preventDefault();b.stopPropagation();let d,e=null,
l=this.classList,k=this.dataset.type;a.clicked||(a.clicked=c.Instances.Builder[c.builderIndex].newRowAvailable(1,!0),e=!0);if("module"===k)d=a.clicked.hasClass("tb_module_btn_plus")?a.clicked.parent():a.clicked.closest(".module_column").find(".tb_holder").last(),c.toolbar.Panel.add_module(b,d);else if("row"===k)d=a.clicked.hasClass("tb_module_btn_plus")?a.clicked.parent():a.clicked.closest(".module_column").find(".tb_holder").first(),c.toolbar.Panel.click_add_sub_row(b,d);else if(l.contains("js-tb_module_panel_acc"))c.toolbar.toggleAccordion(b);
else if("predesigned"===k||"page_break"===k)d=a.clicked.closest(".module_row"),"page_break"===k?c.toolbar.Panel.click_add_page_break(b,d):c.toolbar.preDesignedRows.get(h(b.currentTarget).closest(".predesigned_row").data("slug"),function(a){c.Mixins.Builder.rowDrop(a,e?d:h("<div>").insertAfter(d),!0)});l.contains("js-tb_module_panel_acc")||a.hide(!0)}).on("keyup",".tb_module_panel_search_text",this.search.bind(this)).on("click",".tb_clear_input",this.clear)},run(){var a=c.toolbar.$el.find("#tb_module_panel");
this.btn[0].insertAdjacentHTML("beforeend",a[0].innerHTML);this.btn.find(".tb_module_outer").show();a=this.btn.find(".tb_module_types").closest("div")[0];a.parentNode.parentNode.insertBefore(a,a.parentNode);a.parentNode.removeChild(a.nextElementSibling);this.btn.find(".tb_compact_tabs").removeClass("tb_compact_tabs").find(".tb_ui_dropdown_items").removeClass("tb_ui_dropdown_items");this.btn.find(".tb_module_panel_search_text").val("");c.Mixins.Builder.initModuleDraggable(this.btn,".tb_module");c.Mixins.Builder.initModuleDraggable(this.btn.find(".tb_rows_grid").first(),
".tb_row_grid");c.Mixins.Builder.initRowDraggable(this.btn,".tb_page_break_module");if(c.toolbar.libraryItems.is_init||"visual"===c.mode)c.Mixins.Builder.initModuleDraggable(this.btn.find(".tb_library_item_list").first(),".tb_item_module,.tb_item_part"),c.Mixins.Builder.initRowDraggable(this.btn.find(".tb_library_item_list").first(),".tb_item_row");(c.toolbar.preDesignedRows.is_init||"visual"===c.mode)&&c.Mixins.Builder.initRowDraggable(this.btn.find(".tb_predesigned_rows_container").first(),".predesigned_row");
this.is_init=!0;c.Mixins.Builder.initRowDraggable(this.btn.find(".tb_module_panel_rows_wrap").first(),".tb_page_break_module")},tabs(a){a.preventDefault();a.stopPropagation();a=h(a.currentTarget);const b=a.closest("ul");var d=a.data("target");const e=a.closest(".tb_modules_panel_wrap");e.find("."+a.data("hide")).hide();const f=e.find("."+d),g=e.find(".tb_no_content");0<f.length?(g.hide(),f.show()):g.show();a.closest("li").addClass("current").siblings().removeClass("current");e.find(".tb_module_panel_search_text").val("").focus().trigger("keyup");
h(p).triggerHandler("tb_panel_tab_"+d,e);d=b.parent().find(".tb_ui_dropdown_label");0<d.length&&d.text(a.text());c.Utils.hideOnClick(b)},show(a,b){a.preventDefault();a.stopPropagation();!c.activeModel&&r.document.body.classList.contains("tb_standalone_lightbox")&&m.Lightbox.close();null===this.is_init&&this.run();this.clicked&&this.clicked[0].classList.remove("clicked");this.clicked=b?b:h(a.currentTarget);var d=this.clicked.offset();a="visual"!==c.mode?h(".edit-post-layout__content"):!1;b=v.body;
let e=d.left+this.clicked.width()/2;d=d.top;!1!==a&&0<a.length&&(d+=a.scrollTop()-70,e=a.width()/2);e-=this.btn.outerWidth()/2;0>e&&(e=0);this.clicked.parents(".sub_column").length?this.btn[0].classList.add("tb_subrow_open"):this.btn[0].classList.remove("tb_subrow_open");this.btn.css({top:d,left:e}).show();this.resize();const f=this.btn[0].getElementsByClassName("tb_predesigned_rows_container")[0];f.closest(".tb_module_panel_rows_wrap").addEventListener("scroll",c.toolbar.preDesignedRows.scrollLoadMore.bind(c.toolbar.preDesignedRows),
{passive:!0});"visual"===c.mode&&(b=b.add(h("body",r.document)),"desktop"!==c.activeBreakPoint&&(h("body",r.document).height(p.body.scrollHeight+this.btn.outerHeight(!0)),v.body.css("padding-bottom",180)));b.addClass("tb_panel_dropdown_openend");this.clicked.addClass("clicked");"desktop"===c.activeBreakPoint&&setTimeout(function(){this.btn.find(".tb_module_panel_search_text").focus()}.bind(this),50);this.hide();c.ActionBar.clear();null!==c.activeModel&&(a=m.Lightbox.$lightbox[0].getElementsByClassName("builder_save_button")[0],
a!==n&&a.click());a=f.getElementsByTagName("img");0<a.length?(a=a[a.length-1],h(a).one("load",function(){c.toolbar.preDesignedRows.masonry(f)})):c.toolbar.preDesignedRows.masonry(f)},resize(){null!==this.btn&&c.Utils.addViewPortClass(this.btn[0])},hide(a){function b(){if(!0===a||!d.btn.is(":hover")){let a=v.body;null!==d.btn&&(d.btn.hide().css("width",""),d.clicked&&d.clicked[0].classList.remove("clicked"),d.clicked=null);h(p).off("click",b);h(r.document).off("click",b);"visual"===c.mode&&(a=a.add(h("body",
r.document)),"desktop"!==c.activeBreakPoint&&(h("body",r.document).height(p.body.scrollHeight),v.body.css("padding-bottom","")));a.removeClass("tb_panel_dropdown_openend")}}const d=this;if(!0===a)b();else{if("visual"===c.mode)h(r.document).on("click",b);h(p).on("click",b)}},search(a){var b=h(a.currentTarget);a=b.closest(".tb_modules_panel_wrap");const d=a.find(".tb_module_types .current").first().data("target");b=h.trim(b.val());let e=!1,f=!1,g=!1,l=!1,k=!1;"tb_module_panel_modules_wrap"===d?(e=a.find(".tb_module_outer"),
g=!0):"tb_module_panel_rows_wrap"===d&&c.toolbar.preDesignedRows.is_init?(c.toolbar.preDesignedRows.addNewItems(b),f=a.find(".tb_ui_dropdown_label").data("active"),e=a.find(".predesigned_row"),k=!0):"tb_module_panel_library_wrap"===d&&(e=a.find(".tb_library_item"),f=a.find(".tb_library_types .current").data("target"),l=!0);if(!1!==e){const d=""===b,q=d?!1:new RegExp(b,"i");e.each(function(){if(f&&!this.classList.contains(f))return!0;let a=g?h(this).find(".module_name"):l?h(this).find(".tb_library_item_inner span"):
h(this).find(".tb_predesigned_rows_title");d||q.test(a.text())?h(this).show():h(this).hide()});d?a.removeClass("tb_module_panel_searching"):a.addClass("tb_module_panel_searching");g?a.find(".tb_module_category_content").each(function(){this.parentElement.style.display="block";!1!==d||h(this).find(".tb_module_outer:visible").length||(this.parentElement.style.display="none")}):k&&c.toolbar.preDesignedRows.masonry(a[0].getElementsByClassName("tb_predesigned_rows_container")[0])}},clear(a){a.preventDefault();
a.stopPropagation();a=h(this).parent().children("input").first();0<a.length&&(a.val(""),a[0].hasAttribute("data-search")?a.trigger("keyup").focus():(a.trigger("change"),v.triggerEvent(a[0],"change")))}},help:{init(){h(".tb_help_btn",c.toolbar.$el).on("click",this.show.bind(this))},show(a){a.preventDefault();a.stopPropagation();const b=this;m.showLoader("show");return h.ajax({type:"POST",url:themifyBuilder.ajaxurl,data:{tb_load_nonce:themifyBuilder.tb_load_nonce,action:"tb_help"},complete(){m.showLoader("spinhide")},
success(a){r.document.body.insertAdjacentHTML("beforeend",a);a=h("#tb_help_lightbox",r.document.body);h(".tb_help_tab_link",a).on("click",b.mainTabs.bind(b));h(".tb_player_btn",a).on("click",b.play.bind(b));h(".tb_help_menu a",a).on("click",b.tabs.bind(b));h(".tb_close_lightbox",a).on("click",b.close.bind(b));a.slideDown()}})},play(a){a.preventDefault();a.stopPropagation();a=h(a.currentTarget).closest("a");const b=a.prop("href"),c=p.createElement("iframe");c.setAttribute("frameborder","0");c.setAttribute("allow",
"autoplay; fullscreen");c.setAttribute("src",b+"?rel=0&showinfo=0&autoplay=1&enablejsapi=1&html5=1&version=3");a.replaceWith(c)},tabs(a){a.preventDefault();a.stopPropagation();a=h(a.currentTarget);const b=h(".tb_help_video_wrapper",r.document),c=b.find(a.attr("href")),e=c.find(".tb_player_btn");b.find(".tb_player_wrapper").removeClass("current").hide();c.addClass("current").show();a.closest("li").addClass("current").siblings().removeClass("current");this.stopPlay();0<e.length?e.trigger("click"):this.startPlay()},
execute(a,b){a.contentWindow.postMessage('{"event":"command","func":"'+b+'","args":""}',"*")},stopPlay(){const a=this;h(".tb_player_wrapper",r.document).each(function(){if(!this.classList.contains("current")){let b=h(this).find("iframe");0<b.length&&a.execute(b[0],"pauseVideo")}})},startPlay(){const a=h(".tb_player_wrapper.current",r.document).find("iframe");0<a.length&&this.execute(a[0],"playVideo")},close(a,b){a.preventDefault();a.stopPropagation();h(a.currentTarget).closest("#tb_help_lightbox").slideUp("normal",
function(){h(this).next(".tb_overlay").remove();h(this).empty().remove();b&&b()})},mainTabs(a){a.preventDefault();a.stopPropagation();a=h(a.currentTarget);const b=h(".tb_help_lightbox_inner_wrapper",r.document);a.hasClass("tb_help_active_tab")||(b.find(".tb_help_active_tab").removeClass("tb_help_active_tab"),a.addClass("tb_help_active_tab"),b.attr("data-active-tab",a.data("type")))}},deviceSwitcher(a){const b=a.target,c=b.parentNode.previousElementSibling;c.classList.contains("tb_breakpoint_switcher")&&
(a.tb_device=[b.dataset.width,b.dataset.height],a.target=c,a.currentTarget=c,this.breakpointSwitcher(a))},breakpointSwitcher(a){a.preventDefault();a.stopPropagation();let b="desktop",d=h("body",r.document);const e=this;var f=a.currentTarget;const g="visual"===c.mode&&c.iframe[0].classList.contains("tb_resizing_start"),l=c.activeBreakPoint,k=function(){e.responsive_grids(b,l);const a=function(){c.Utils.setCompactMode(p.getElementsByClassName("module_column"));d.removeClass("tb_start_animate").toggleClass("tb_responsive_mode",
"desktop"!==b).removeClass("builder-breakpoint-"+l).addClass("builder-breakpoint-"+b);v.body.triggerHandler("themify_builder_change_mode",[l,b]);"visual"===c.mode&&(c.iframe[0].style.willChange="",setTimeout(function(){"desktop"!==c.activeBreakPoint?c.Utils.calculateHeight():r.document.body.style.height="";!g&&c.scrollTo&&(h(x).add(r.document).scrollTop(c.scrollTo.offset().top),c.scrollTo=!1);v.trigger("tf_isotop_layout")},150));c.ActionBar.disable=c.clearOnModeChange=null};"visual"===c.mode?c.Utils._onResize(!0,
function(){e.iframeScroll("desktop"!==b);"desktop"!==l&&"desktop"!==b||c.Mixins.Builder.updateModuleSort(null,"desktop"===b?"enable":"disable");c.ActionBar.hoverCid=null;c.EdgeDrag.clearEdges();setTimeout(a,g?1:100)}):a()};f.classList.contains("breakpoint-tablet")?b="tablet":f.classList.contains("breakpoint-tablet_landscape")?b="tablet_landscape":f.classList.contains("breakpoint-mobile")&&(b="mobile");if(n!==a.tb_device||!v.body[0].classList.contains("builder-breakpoint-"+b)){f="desktop"!==b?n!==
a.tb_device?"tablet_landscape"===b?a.tb_device[1]:a.tb_device[0]:c.Utils.getBPWidth(b)-1:"";if(l===b&&a.originalEvent!==n&&(f?f+"px":f)===c.iframe[0].style.width)return!1;c.ActionBar.disable=!0;var u=[];if("visual"===c.mode){null===c.clearOnModeChange&&c.ActionBar.clear();if(!g&&!c.isPreview){var q=c.Instances.Builder[0].el.children;const a=x.innerHeight,b=function(b){if(null!==b&&b!==n){const c=b.getBoundingClientRect();if(0>c.bottom&&0>c.top||c.top>a)b.style.display="none",u.push(b)}};for(let a=
q.length-1;-1<a;--a)b(q[a]);b(p.getElementById("headerwrap"));b(p.getElementById("footerwrap"))}d=d.add(v.body)}c.activeBreakPoint=b;d.addClass("tb_start_animate");if("visual"===c.mode)if(c.iframe[0].style.willChange="width",q=r.document.getElementsByClassName("tb_toolbar_zoom_menu")[0],q.classList.remove("tb_toolbar_zoom_active"),q.getElementsByClassName("tb_toolbar_zoom_menu_toggle")[0].dataset.zoom=100,"tablet_landscape"===b&&m.Lightbox.dockMode.get()&&(q=h(".tb_workspace_container",r.document).width(),
q<f&&(f=q)),c.iframe[0].parentNode.classList.remove("tb_zoom_bg"),g)k();else{r.document.body.offsetHeight;let d;c.isPreview&&(q={tablet_landscape:[1024,768],tablet:[768,1024],mobile:[375,667]},q[b]!==n&&(f=n===a.tb_device?q[b][0]:"tablet_landscape"===b?a.tb_device[1]:a.tb_device[0],d=n===a.tb_device?q[b][1]:"tablet_landscape"===b?a.tb_device[0]:a.tb_device[1]));c.iframe.one("transitionend",function(){for(let a=u.length-1;-1<a;--a)u[a].style.display="";setTimeout(k,10)});c.iframe[0].style.width=f?
f+"px":"";c.iframe[0].style.height=d?d+"px":""}else k()}},iframeScroll(a){const b=h(r.document);b.off("scroll.themifybuilderresponsive");if(a)b.on("scroll.themifybuilderresponsive",function(){x.scrollTo(0,h(this).scrollTop())})},responsive_grids(a,b){v.LoadCss(tbLocalScript.css_module_url+"responsive-column.css");const c=p.querySelectorAll(".row_inner,.subrow_inner"),e="desktop"===a,f=e||"desktop"===b;for(let d=c.length-1;-1<d;--d){var g=c[d].getAttribute("data-basecol");if(null!==g){let k=c[d].children;
var l=c[d].dataset["col_"+a];let q=k[0],t=k[k.length-1];if(!e){if("desktop"!==b){c[d].classList.remove("tb_3col");let a=c[d].getAttribute("data-col_"+b);a&&c[d].classList.remove(h.trim(a.replace("tb_3col","").replace("mobile","column").replace("tablet","column")))}if(l&&"-auto"!==l&&l!==a+"-auto"){if(l=c[d].getAttribute("data-col_"+a)){c[d].classList.add("tb_grid_classes");c[d].classList.add("col-count-"+g);l=l.split(" ");for(let a=0,b=l.length;a<b;++a)c[d].classList.add(h.trim(l[a].replace("mobile",
"column").replace("tablet","column")))}}else c[d].classList.remove("tb_grid_classes"),c[d].classList.remove("col-count-"+g)}if(f)for(let a=0,b=k.length;a<b;++a)g=h(k[a]).data("w"),g!==n&&(k[a].style.width=e?g+"%":"");"rtl"===c[d].getAttribute("data-"+a+"_dir")?(q.classList.remove("first"),q.classList.add("last"),t.classList.remove("last"),t.classList.add("first"),c[d].classList.add("direction-rtl")):(q.classList.remove("last"),q.classList.add("first"),t.classList.remove("first"),t.classList.add("last"),
c[d].classList.remove("direction-rtl"))}}},Panel:{el:null,init(){this.el=c.toolbar.$el.find(".tb_toolbar_add_modules_wrap");this.el.on("click",".add_module_btn",this.initEvents.bind(this));this.compactToolbar();"visual"===c.mode&&m.Lightbox.dockMode.setDoc()},initEvents(a){a.preventDefault();a.stopPropagation();const b=a.currentTarget.dataset.type;"module"===b?this.add_module(a):"row"===b?this.click_add_sub_row(a):"page_break"===b?this.click_add_page_break(a):"predesigned"===b&&c.toolbar.preDesignedRows.get(a.currentTarget.closest(".predesigned_row").dataset.slug,
function(a){var b=c.Instances.Builder[c.builderIndex].$el.find(".module_row").last();c.Mixins.Builder.rowDrop(a,h("<div>").insertAfter(b),!0)})},setFocus(){c.toolbar.el.getElementsByClassName("tb_module_panel_search_text")[0].focus()},add_module(a,b){a.preventDefault();a.stopPropagation();b&&0!==b.length||(b=c.Instances.Builder[c.builderIndex].newRowAvailable(1,!0).find(".tb_holder").first());c.Mixins.Builder.moduleDrop(h(a.currentTarget).closest(".tb_module"),b)},click_add_sub_row(a,b){a.preventDefault();
a.stopPropagation();const d=b?!0:!1;b=b||c.Instances.Builder[c.builderIndex].$el.find(".module_row").last();a=h(a.currentTarget).closest(".tb_row_grid").data("slug");d?b.hasClass("tb_module_front")?c.Mixins.Builder.subRowDrop(a,h("<div>").insertAfter(b)):c.Mixins.Builder.subRowDrop(a,h("<div>").appendTo(b)):c.Mixins.Builder.rowDrop(c.Utils.grid(a),h("<div>").insertAfter(b),!0,!0)},click_add_page_break(a,b){a.preventDefault();a.stopPropagation();b=b||c.Instances.Builder[c.builderIndex].$el.find(".module_row").last();
c.Mixins.Builder.rowDrop(c.toolbar.pageBreakModule.get(),h("<div>").insertAfter(b),!0);c.toolbar.pageBreakModule.countModules()},compactToolbar(){function a(){c.toolbar.$el.outerWidth()<b?r.document.body.classList.add("tb_compact_toolbar"):r.document.body.classList.remove("tb_compact_toolbar");c.toolbar.common.resize()}const b="visual"===c.mode?850:750;h(r).on("resize.compact",a);if("visual"===c.mode)r.jQuery("body").one("themify_builder_ready",a);else a()}},toggleFavoriteModule(){var a=h(this),b=
a.closest(".tb_module_outer"),d=a.parent().data("module-slug");h.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tb_module_favorite",module_name:d,module_state:+!b.hasClass("favorited")},beforeSend(a){function e(a,b){function f(){if(a.length){if(b)var f=0<a.closest("#tb_module_panel_dropdown").length?c.toolbar.$el:h("#tb_module_panel_dropdown");a.removeAttr("style");var g=a.data("categories").split(","),k=a.closest(".tb_module_panel_modules_wrap"),l=k.find('.tb_module_category_content[data-category="favorite"]');
if(a.hasClass("favorited")){for(var m=g.length-1;0<=m;m--){var n=k.find('.tb_module_category_content[data-category="'+g[m]+'"]').parent();n.find(".tb_module_outer.tb-module-"+d).css({opacity:0,transform:"scale(0.5)"}).remove();n.find(".tb_module_outer").length||n.css({display:"none"})}l.parent().css({display:"block"});a.clone().css({opacity:0,transform:"scale(0.5)"}).appendTo(l).css({opacity:1,transform:"scale(1)"})}else for(m=g.length-1;0<=m;m--){n=k.find('.tb_module_category_content[data-category="'+
g[m]+'"]');let b=a.clone().css({opacity:0,transform:"scale(0.5)"}).appendTo(n);n.parent().css({display:"block"});b.css({opacity:1,transform:"scale(1)"})}b&&e(f.find(".tb-module-type-"+d).closest(".tb_module_outer"),!1);a.remove();l.find(".tb_module_outer").length||l.parent().css({display:"none"})}}if(a.length&&!a.is(":visible"))a.toggleClass("favorited"),f();else a.css({opacity:0,transform:"scale(0.5)"}).one("transitionend",function(){a.toggleClass("favorited").one("transitionend",f)})}e(b,!0)}})},
zoom(a){function b(){c.Utils._onResize(!0)}a.preventDefault();if("desktop"!==c.activeBreakPoint)return!0;var d=h(a.currentTarget);a=d.data("zoom");var e=h(".tb_iframe",r.document),f=d.closest(".tb_toolbar_zoom_menu");d.hasClass("tb_toolbar_zoom_menu_toggle")?(a="100"==a?50:100,d.data("zoom",a),d=d.next("ul").find('[data-zoom="'+a+'"]')):f.find(".tb_toolbar_zoom_menu_toggle").data("zoom",a);e.removeClass("tb_zooming_50 tb_zooming_75");d.parent().addClass("selected-zoom-size").siblings().removeClass("selected-zoom-size");
"50"==a||"75"==a?(d="50"==a?2:1.25,e.addClass("tb_zooming_"+a).one("transitionend",b).parent().addClass("tb_zoom_bg").css("height",Math.max(r.innerHeight*d,600)),f.addClass("tb_toolbar_zoom_active"),c.zoomMeta.isActive=!0,c.zoomMeta.size=a,v.body.addClass("tb_zoom_only")):(e.addClass("tb_zooming_"+a).one("transitionend",b).parent().css("height",""),f.removeClass("tb_toolbar_zoom_active"),c.zoomMeta.isActive=!1,v.body.removeClass("tb_zoom_only"))},previewBuilder(a){a.preventDefault();h(a.currentTarget).toggleClass("tb_toolbar_preview_active");
c.isPreview=!c.isPreview;c.isPreview||(c.iframe[0].style.height="");v.body.toggleClass("tb_preview_only themify_builder_active");h("body",r.document).toggleClass("tb_preview_parent");if(c.isPreview){a=p.getElementsByClassName("row_inner");for(var b=a.length-1;-1<b;--b)if(a[b].classList.contains("col-count-1")&&0===a[b].getElementsByClassName("active_module").length){var d=a[b].getElementsByClassName("module_column")[0];if((d=c.Models.Registry.lookup(d.getAttribute("data-cid")))&&0===Object.keys(d.get("styling")).length){d=
a[b].closest(".module_row");var e=c.Models.Registry.lookup(d.getAttribute("data-cid"));e&&0===Object.keys(e.get("styling")).length&&d.classList.add("tf_hide")}}}else h(".tf_hide.module_row").removeClass("tf_hide");"visual"===c.mode&&!r.document.body.classList.contains("tb_panel_minimized")&&m.Lightbox.dockMode.get()&&c.Utils._onResize(!0);c.vent.trigger("dom:preview")},toggleAccordion(a){h(a.currentTarget).closest(".tb_module_panel_tab_acc_component").toggleClass("tb_collapsed")},closeFloat(a){a&&
(a.preventDefault(),a.stopPropagation(),localStorage.setItem("tb_panel_closed",!0));r.document.body.classList.add("tb_panel_closed")},openFloat(a){a&&(a.preventDefault(),a.stopPropagation(),localStorage.removeItem("tb_panel_closed"));r.document.body.classList.remove("tb_panel_closed");c.toolbar.common.hide(!0)}});c.Forms={Data:{},Validators:{},parseSettings(a,b){var d="",e=a.classList;if(!e.contains("tb_row_js_wrapper")){var f=a.closest(".tb_field");if(null!==f&&!f.classList.contains("_tb_hide_binding")&&
("none"!==f.style.display||-1===f.className.indexOf("tb_group_element_"))&&(f=f.parentNode,f.classList.contains("tb_multi_fields")&&f.parentNode.classList.contains("_tb_hide_binding")))return!1}b=b?a.getAttribute("data-input-id"):a.getAttribute("id");if(e.contains("tb_lb_wp_editor"))tinyMCE!==n?(d=a.id,e=tinyMCE.get(d),d=null!==e?!1===e.hidden?e.getContent():switchEditors.wpautop(tinymce.DOM.get(d).value):a.value):d=a.value;else if(e.contains("themify-checkbox")){d=[];f=a.getElementsByClassName("tb-checkbox");
var g=e.contains("tb_switcher");a=0;for(e=f.length;a<e;++a)!0!==g&&!0!==f[a].checked||""===f[a].value||d.push(f[a].value);d=0<d.length?d.join("|"):g?"":!1}else if(e.contains("themify-layout-icon"))d=a.getElementsByClassName("selected")[0],d=d!==n?d.id:"";else if(e.contains("tb_search_input"))d=a.getAttribute("data-value"),e.contains("query_category_single")&&(a=a.closest(".tb_input").getElementsByClassName("query_category_multiple")[0],a=a===n?"":a.value.trim(),d=""!==a?a+"|"+(-1!==a.indexOf(",")?
"multiple":"single"):d+"|single");else if(e.contains("tb_radio_input_container")){e=a.getElementsByTagName("input");f=null;for(a=e.length-1;-1<a;--a)if(!0===e[a].checked){f=e[a];break}null===f||"desktop"!==c.activeBreakPoint&&f.classList.contains("responsive_disable")||(d=f.value)}else if(e.contains("tb_search_container"))d=a.previousElementSibling.dataset.value;else if(e.contains("tb_row_js_wrapper")){d=[];var l=a.getElementsByClassName("tb_repeatable_field_content");a=0;for(e=l.length;a<e;++a){f=
l[a].getElementsByClassName("tb_lb_option_child");d[a]={};for(var k=0,m=f.length;k<m;++k)(g=this.parseSettings(f[k],!0))&&(d[a][g.id]=g.v)}}else if(e.contains("module-widget-form-container"))d=h(a).find(":input").themifySerializeObject();else if(e.contains("tb_widget_select"))d=a.getElementsByClassName("selected")[0],d=d!==n?d.dataset.value:"";else if(e.contains("tb_sort_fields_parent")){f=a.children;d=[];a=0;for(e=f.length;a<e;++a)if(g=f[a].getAttribute("data-type")){k=f[a].getElementsByClassName("tb_sort_field_dropdown")[0];
g={type:g,id:f[a].getAttribute("data-id")};if(k!==n)for(g.val={},l=k.getElementsByClassName("tb_lb_sort_child"),k=l.length-1;-1<k;--k)(m=this.parseSettings(l[k],!0))&&(g.val[m.id]=m.v);else m=f[a].getElementsByTagName("input")[0],k=m.value,""!==k&&(g.val=JSON.parse(k));d.push(g)}0===d.length&&(d="")}else if(e.contains("tb_accordion_fields"))for(f=a.children,d={},a=0,e=f.length;a<e;++a){if(l=f[a].getAttribute("data-id"))m=f[a].getElementsByTagName("input")[0],k=f[a].getElementsByClassName("tb_accordion_fields_options")[0],
g={},k!==n?g.val=this.serialize(k,null,!0):(k=m.value,""!==k&&(g.val=JSON.parse(k))),d[l]=g}else if(e.contains("tb_toggleable_fields"))for(f=a.children,d={},a=0,e=f.length;a<e;++a){if(l=f[a].getAttribute("data-id"))m=f[a].getElementsByTagName("input")[0],k=f[a].getElementsByClassName("tb_toggleable_fields_options")[0],g={on:f[a].getElementsByClassName("tb_switcher")[0].getElementsByClassName("toggle_switch")[0].value},k!==n?g.val=this.serialize(k,null,!0):(k=m.value,""!==k&&(g.val=JSON.parse(k))),
d[l]=g}else if(d=a.value,x.tbpDynamic!==n&&b===tbpDynamic.field_name){if(""===d)return!1;"string"===typeof d&&(d=JSON.parse(d))}else{if(b===c.GS.key&&"desktop"!==c.activeBreakPoint)return!1;""!==d&&("builder_content"===b?"string"===typeof d&&(d=JSON.parse(d)):(a=a.getAttribute("data-opacity"),null!==a&&""!==a&&1!=a&&"0.99"!=a&&(d+="_"+a)))}if(d===n||null===d)d="";return{id:b,v:d}},serialize(a,b,c){c=c||!1;var d={};a="object"===typeof a?a:r.document.getElementById(a);if(null!==a){a=a.getElementsByClassName(c?
"tb_lb_option_child":"tb_lb_option");for(var f=a.length-1;-1<f;--f){var g=this.parseSettings(a[f],c);!1===g||!0!==b&&""===g.v||(d[g.id]=g.v)}}return d},LayoutPart:{cache:[],undo:null,old_id:null,isReload:null,id:null,init:!1,html:null,el:null,options:null,isSaved:null,scrollTo(a,b){c.scrollTo=c.Forms.LayoutPart.el},edit(a){function b(a){c.ActionBar.clear();p.getElementById("themify_builder_content-"+themifyBuilder.post_ID).insertAdjacentHTML("afterbegin",'<div class="tb_overlay"></div>');f.addClass("tb_active_layout_part").closest(".row_inner").find(".active_module").each(function(){this.classList.contains("tb_active_layout_part")||
this.insertAdjacentHTML("afterbegin",'<div class="tb_overlay"></div>')});var b="themify_builder_content-"+e.id;e.html=f[0].innerHTML;themifyBuilder.post_ID=ThemifyStyles.builder_id=e.id;f[0].insertAdjacentHTML("afterbegin",l.replace("#postID#",e.id));h("."+b).each(function(){h(this).closest(".active_module").find(".themify-builder-generated-css").first().prop("disabled",!0)});c.Instances.Builder[0].el.classList.remove("tb_active_builder");f.removeClass("active_module module").closest(".tb_holder").removeClass("tb_holder").addClass("tb_layout_part_parent").closest(".module_row").addClass("tb_active_layout_part_row");
g.attr("id",b).removeClass("not_editable_builder").addClass("tb_active_builder").empty();e.el=f;c.id=e.id;var d=[];c.builderIndex=1;c.Instances.Builder[c.builderIndex]=new c.Views.Builder({el:g,collection:new c.Collections.Rows(a),type:c.mode});a=c.Instances.Builder[c.builderIndex].render().el.querySelectorAll("[data-cid]");b=0;for(var k=a.length;b<k;++b)d[a[b].dataset.cid]=1;a=null;c.bootstrap(d,function(){f.triggerHandler("tb_layout_part_before_init");d=c.activeModel=null;c.Utils.loadContentJs(g);
c.id=!1;v.body.on("themify_builder_change_mode",e.scrollTo);c.hasChanged=null;c.Instances.Builder[c.builderIndex].$el.triggerHandler("tb_init");f.find(".tb_toolbar_save").on("click",e.save.bind(e));f.find(".tb_toolbar_close_btn").on("click",e.close.bind(e));f.find(".tb_load_layout").on("click",c.Views.Toolbar.prototype.loadLayout);f.find(".tb_toolbar_import ul a").on("click",c.Views.Toolbar.prototype.import);m.showLoader("hide");e.init=!1;e.undo=c.undoManager.stack;c.undoManager.btnUndo=f[0].getElementsByClassName("tb_undo_btn")[0];
c.undoManager.btnRedo=f[0].getElementsByClassName("tb_redo_btn")[0];c.undoManager.reset();f.find(".tb_undo_redo").on("click",function(a){c.undoManager.do_change(a)});"desktop"!==c.activeBreakPoint&&c.Mixins.Builder.updateModuleSort(null,"disable");"visual"===c.mode&&setTimeout(function(){c.Utils.checkAllimageSize()},500);c.ActionBar.disable=c.ActionBar.hoverCid=null;f.triggerHandler("tb_layout_part_after_init")})}c.ActionBar.disable=!0;m.showLoader("show");p.body.classList.add("tb_layout_part_edit");
if(null!==c.activeModel){var d=m.Lightbox.$lightbox[0].getElementsByClassName("builder_save_button")[0];d!==n&&d.click();d=null}r.document.body.classList.add("tb_layout_part_edit");var e=this,f=h(a).closest(".active_module"),g=f.find(".themify_builder_content"),l=m.templateCache.get("tmpl-small_toolbar");this.id=g.data("postid");this.old_id=themifyBuilder.post_ID;this.init=!0;this.isSaved=null;this.cache[this.id]!==n?b(this.cache[this.id]):h.ajax({type:"POST",dataType:"json",url:themifyBuilder.ajaxurl,
data:{action:"tb_layout_part_swap",nonce:themifyBuilder.tb_load_nonce,id:e.id},success(a){a.data&&(e.cache[e.id]=a.data,a.gs&&(c.GS.styles=h.extend(!0,{},a.gs,c.GS.styles)),b(a.data))}})},close(a){function b(){d.el.removeClass("tb_active_layout_part").addClass("active_module module").closest(".tb_layout_part_parent").addClass("tb_holder").removeClass("tb_layout_part_parent").closest(".module_row").removeClass("tb_active_layout_part_row");h("#tb_small_toolbar",d.el).remove();for(var a=e[0].querySelectorAll("[data-cid]"),
b=a.length-1;-1<b;--b){var f=a[b].dataset.cid,m=c.Models.Registry.lookup(f);m&&(m.destroy(),c.Models.Registry.remove(f))}e.removeAttr("id").addClass("not_editable_builder").removeClass("tb_active_builder");p.body.classList.remove("tb_layout_part_edit");r.document.body.classList.remove("tb_layout_part_edit");h(".tb_overlay").remove();c.undoManager.stack=d.undo;c.undoManager.index=d.undo.length-1;c.undoManager.btnUndo=c.toolbar.el.getElementsByClassName("tb_undo_btn")[0];c.undoManager.btnRedo=c.toolbar.el.getElementsByClassName("tb_redo_btn")[0];
themifyBuilder.post_ID=ThemifyStyles.builder_id=d.old_id;d.undo=d.isSaved=d.old_id=d.html=d.id=d.options=d.isReload=d.el=c.Instances.Builder[c.builderIndex]=null;delete c.Instances.Builder[c.builderIndex];c.builderIndex=0;v.body.off("themify_builder_change_mode",d.scrollTo);c.Mixins.Builder.updateModuleSort();c.undoManager.updateUndoBtns();"desktop"!==c.activeBreakPoint&&c.Mixins.Builder.updateModuleSort(null,"disable");c.ActionBar.hoverCid=null;c.ActionBar.clear();c.Instances.Builder[c.builderIndex].el.classList.add("tb_active_builder");
c.Instances.Builder[c.builderIndex].lastRowAddBtn()}a.preventDefault();a.stopPropagation();if(!c.hasChanged&&!c.undoManager.hasUndo()||null!==this.isSaved||confirm(themifyBuilder.i18n.layoutEditConfirm)){null!==c.activeModel&&m.Lightbox.close();var d=this,e=this.el.find(".themify_builder_content");if(null!==this.options){m.showLoader("show");a=c.Models.Registry.lookup(this.el.data("cid"));this.cache[this.id]=this.options;h(p).ajaxComplete(function q(a,f,u){if(-1!==u.data.indexOf("tb_load_module_partial",
3))if(h(this).off("ajaxComplete",q),200===f.status){d.el=c.liveStylingInstance.$liveStyledElmt;e=d.el.children(".themify_builder_content");var l=e[0].innerHTML,k="";d.el.children(".themify-builder-generated-css").each(function(){k+=this.outerHTML});h(".themify_builder_content-"+d.id).each(function(){var a=h(this).closest(".module");a.children("link.themify-builder-generated-css").remove();""!==k&&a[0].insertAdjacentHTML("afterbegin",k);this.innerHTML=l;c.Utils.loadContentJs(h(this))});k=l=null;m.showLoader("hide");
b()}else m.showLoader("error")});var f=h.extend(!0,{},a.get("mod_settings"));f.unsetKey=!0;a.trigger("custom:preview:refresh",f);f=null}else this.el[0].innerHTML=d.html,b(),h(".themify_builder_content-"+d.id).each(function(){h(this).closest(".active_module").find(".themify-builder-generated-css").removeAttr("disabled")}),c.Utils.loadContentJs(e)}},save(a,b){a.preventDefault();a.stopPropagation();if(null!==c.activeModel){var d=m.Lightbox.$lightbox[0].getElementsByClassName("builder_save_button")[0];
d!==n&&d.click();d=null}if(c.undoManager.hasUndo()||null!==this.isReload||b){var e=this;this.old_settings=this.html=null;m.showLoader("show");c.Utils.saveBuilder(function(d){d.success&&(e.options=d.data.builder_data,c.hasChanged=null,e.isSaved=!0,b&&e.close(a))},1)}else m.showLoader("show"),setTimeout(function(){m.showLoader("hide")},100)}},reLoad(a,b,d){function e(){"visual"===c.mode&&(c.liveStylingInstance.setCss(c.Mixins.Builder.toJSON(c.Instances.Builder[l].el)),c.Utils.loadContentJs(c.Instances.Builder[l].$el),
c.id=!1);c.Instances.Builder[c.builderIndex].$el.triggerHandler("tb_init");m.showLoader("hide");"visual"===c.mode&&"desktop"!==c.activeBreakPoint&&(h("body",r.document).height(p.body.scrollHeight),setTimeout(function(){h("body",r.document).height(p.body.scrollHeight)},2E3));d&&d();c.hasChanged=!0;"visual"===c.mode&&setTimeout(function(){c.Utils.checkAllimageSize()},500)}var f=a.builder_data!==n?a.builder_data:a;a.used_gs!==n&&(c.GS.styles=h.extend(!0,{},a.used_gs,c.GS.styles));var g=null!==c.Forms.LayoutPart.id,
l=c.builderIndex,k=null,u="";c.Mixins.Builder.updateModuleSort(null,"destroy");g||(c.Models.Registry.destroy(),c.Instances.Builder={});"visual"===c.mode?(u="#themify_builder_content-"+b,c.id=b,g||(c.liveStylingInstance.reset(),c.editing=!1,v.body.addClass("sidebar-none full_width"),h("#sidebar,.page-title").remove())):u="#tb_row_wrapper";if(g){b=c.Instances.Builder[l].el.querySelectorAll("[data-cid]");c.Forms.LayoutPart.isReload=!0;for(var q=0,t=b.length;q<t;++q){var w=b[q].dataset.cid,B=c.Models.Registry.lookup(w);
B&&(B.destroy(),c.Models.Registry.remove(w))}b=null;c.Instances.Builder[l].$el.empty()}c.Instances.Builder[l]=new c.Views.Builder({el:u,collection:new c.Collections.Rows(f),type:c.mode});c.Instances.Builder[l].render();c.undoManager.reset();if(g){k=[];b=c.Instances.Builder[l].el.querySelectorAll("[data-cid]");q=0;for(t=b.length;q<t;++q)k[b[q].dataset.cid]=1;b=null}"visual"===c.mode?c.bootstrap(k,e,a.used_gs!==n?a.used_gs:null):e()},isValidate(a){var b=a.getElementsByClassName("tb_must_validate"),
d=b.length;if(0===d)return!0;var e=!0;for(--d;-1<d;--d){var f=b[d].getElementsByClassName("tb_lb_option")[0],g=b[d].getAttribute("data-validation"),h=f.value;if(c.Forms.get_validator(g)(h))for(f.classList.remove("tb_field_error"),f=b[d].getElementsByClassName("tb_field_error_msg"),g=f.length-1;-1<g;--g)f[g].parentNode.removeChild(f[g]);else f.classList.contains("tb_field_error")||(e=p.createElement("span"),e.className="tb_field_error_msg",e.textContent=b[d].getAttribute("data-error-msg"),f.classList.add("tb_field_error"),
f="SELECT"===f.tagName?f.parentNode:f,f.parentNode.insertBefore(e,f.nextSibling)),e=!1}!1===e&&(a=m.Lightbox.$lightbox.find('[href="#'+a.getAttribute("id")+'"]')[0],a.parentNode.classList.contains("current")||a.click());return e}};c.Utils={onResizeEvents:[],gridClass:"col-full col2-1 col3-1 col4-1 col5-1 col6-1 col4-2 col4-3 col3-2".split(" "),_onResize(a,b){let d=h._data(x,"events"),e;d&&(d=d.resize);h(r).off("resize.tb_visual").on("resize.tb_visual",function(a){e&&clearTimeout(e);e=setTimeout(function(){v.trigger("tfsmartresize");
h(x).triggerHandler("tfsmartresize");if(c.zoomMeta.isActive){let a="50"==c.zoomMeta.size?2:1.25;h(".tb_workspace_container",r.document).css("height",Math.max(r.innerHeight*a,600))}},400)});if(d)for(let a=0,b=d.length;a<b;++a)d[a].handler!==n&&this.onResizeEvents.push(d[a].handler);h(x).off("resize");if(a){a=h.Event("resize",{type:"resize",isTrigger:!1});for(let b=0,c=this.onResizeEvents.length;b<c;++b)try{this.onResizeEvents[b].apply(x,[a,h])}catch(l){}v.trigger("tfsmartresize");h(x).triggerHandler("tfsmartresize");
"function"===typeof b&&b()}},_addNewColumn(a,b){a=c.Views.init_column({grid_class:a.newclass,component_name:a.component});b.appendChild(a.view.render().el)},filterClass(a){a=a.split(" ");for(var b=[],c=a.length-1;-1<c;--c)-1!==this.gridClass.indexOf(a[c])&&b.push(a[c]);return b.join(" ")},_getRowSettings(a,b){var d=[];b=b||"row";var e={},f,g=c.Models.Registry.lookup(a.getAttribute("data-cid"));if(g){a=a.getElementsByClassName(b+"_inner")[0];e=a.children;var h=this,k=function(a){a=a.children;for(var b=
0,d=a.length;b<d;++b){a[b].classList.contains("active_module")||k(a[b]);var e=c.Models.Registry.lookup(a[b].getAttribute("data-cid"));e&&(f=e.get("mod_settings"),e=w.push({mod_name:e.get("mod_name"),element_id:e.get("element_id")})-1,f&&0<Object.keys(f).length&&(delete f.cid,w[e].mod_settings=f),a[b].classList.contains("module_subrow")&&(w[e]=h._getRowSettings(a[b],"subrow")))}};b=0;for(var m=e.length;b<m;++b){var q={},t=c.Models.Registry.lookup(e[b].getAttribute("data-cid"));if(t){q=e[b].getElementsByClassName("tb_holder")[0];
var w=[];q!==n&&k(q);q=d.push({element_id:t.get("element_id"),grid_class:this.filterClass(e[b].className)});--q;w&&0<w.length&&(d[q].modules=w);var p=parseFloat(e[b].style.width);0<p&&!isNaN(p)&&(d[q].grid_width=p);(f=t.get("styling"))&&0<Object.keys(f).length&&(delete f.cid,d[q].styling=f)}}e={element_id:g.get("element_id"),cols:d,column_alignment:g.get("column_alignment"),gutter:g.get("gutter"),column_h:g.get("column_h")};m={gutter:"gutter-default",column_alignment:C?"col_align_middle":"col_align_top"};
d={desktop_dir:"ltr",tablet_dir:"ltr",tablet_landscape_dir:"ltr",mobile_dir:"ltr",col_tablet_landscape:"-auto",col_tablet:"-auto",col_mobile:"-auto"};for(b in e)""!==e[b]&&null!==e[b]&&e[b]!==m[b]||delete e[b];f=g.get("styling");for(b in d)g=a.getAttribute("data-"+b),null===g||""===g||g===d[b]||"-auto"===d[b]&&-1!==g.indexOf("-auto")||(e[b]=g.trim());f&&0<Object.keys(f).length&&(delete f.cid,e.styling=f)}return e},selectedGridMenu(a,b){var d=ThemifyConstructor.breakpointsReverse,e=c.Models.Registry.lookup(a.getAttribute("data-cid")),
f=a.getElementsByClassName(b+"_inner")[0],g=e.get("gutter"),h=e.get("column_alignment"),k=e.get("column_h"),m=e.get("desktop_dir"),q="row"===b?e.get("styling"):null;b=[];for(var t={},w=f.children,p=0,r=w.length;p<r;++p)w[p].className=w[p].className.replace(/first|last/ig,""),1!==r&&(0===p?w[p].className+="rtl"===m?" last":" first":p===r-1&&(w[p].className+="rtl"===m?" first":" last"));w=w.length;b.push("col-count-"+w);t["data-basecol"]=w;null!==q&&q.row_anchor!==n&&""!==q.row_anchor&&(a.getElementsByClassName("tb_row_anchor")[0].textContent=
q.row_anchor);"gutter-default"!==g&&b.push(g);k&&b.push("col_auto_height");h||(h="col_align_top");b.push(h);"ltr"!==m&&b.push("direction-rtl");for(a=d.length-1;-1<a;--a)m=e.get(d[a]+"_dir"),"ltr"!==m&&""!==m&&(t["data-"+d[a]+"_dir"]=m),"desktop"!==d[a]&&(w=e.get("col_"+d[a]),"-auto"!==w&&""!==w&&w!==n&&(t["data-col_"+d[a]]=w));for(p=b.length-1;-1<p;--p)b[p]&&f.classList.add(b[p]);for(p in t)f.setAttribute(p,t[p])},clear(a,b,d){b===n&&(b=Array.isArray(a));var e=!0===b?[]:{},f=x.tbpDynamic!==n?tbpDynamic.field_name:
!1;d||(d=1);for(var g in a)if(Array.isArray(a[g])){++d;var l=this.clear(a[g],!0,d);0<l.length&&(!0===b?e.push(l):e[g]=l)}else if(g===f)if("{}"===a[g]||""===a[g])delete a[g],delete e[g];else{l=a[g];"string"===typeof l&&(l=JSON.parse(l));for(var k in l)"undefined"===typeof l[k].repeatable&&(l[k].item===n?delete l[k]:a[k]!==n&&(delete a[k],delete e[k]));a[g]=e[g]=l}else if("object"===typeof a[g])++d,l=this.clear(a[g],!1,d),h.isEmptyObject(l)||(e[g]=l);else if(null!==a[g]&&a[g]!==n&&""!==a[g]&&"def"!==
a[g]&&""!==g&&"pixels"!==a[g]&&"default"!==a[g]&&"|"!==a[g]&&!("show"===a[g]&&0===g.indexOf("visibility_")||"unstick_when_condition"===g&&"hits"===a[g]||("stick_at_pos_val_unit"===g||"unstick_when_pos_val_unit"===g)&&"px"===a[g]))if("custom_parallax_scroll_speed"!==g||a[g]&&"0"!=a[g])if("unstick_when_element"===g&&"builder_end"===a[g]||"stick_at_check"===g&&"stick_at_check"!==a[g])delete e.unstick_when_el_row_id,delete e.unstick_when_el_mod_id,delete e.unstick_when_condition,delete a.unstick_when_el_row_id,
delete a.unstick_when_el_mod_id,delete a.unstick_when_condition,delete e.unstick_when_pos,delete e.unstick_when_pos_val,delete e.unstick_when_element,delete e.unstick_when_pos_val_unit,delete a.unstick_when_pos,delete a.unstick_when_pos_val,delete a.unstick_when_pos_val_unit,delete a.unstick_when_element,"stick_at_check"===g&&(delete a[g],delete e[g],delete a.stick_at_position,delete e.stick_at_position);else if("stick_at_position"===g&&"top"===a[g]||g===c.GS.key&&""===a[g].trim()||"background_gradient-css"===
g||"cover_gradient-css"===g||"cover_gradient_hover-css"===g||"background_image-type_image"===g||"custom_parallax_scroll_reverse_reverse"===g||"|single"===a[g]||"|multiple"===a[g]||("custom_parallax_scroll_reverse"===g||"custom_parallax_scroll_fade"===g||"visibility_all"===g||"sticky_visibility"===g)&&!a[g])delete a[g],delete e[g];else{if("builder_content"===g)"string"===typeof a[g]&&(a[g]=JSON.parse(a[g])),a[g]=this.clear(a[g],!0,1);else if(1===d){l=[];if("px"===a[g]&&-1!==g.indexOf("_unit",2)){var m=
g.replace("_unit","");a[m]||l.push(g)}else if(0===g.indexOf("checkbox_")&&-1!==g.indexOf("_apply_all",6)){a[g]?e[g]=a[g]:l.push(g);m=g.replace("_apply_all","").replace("checkbox_","");for(var q=["top","left","right","bottom"],t=3;-1<t;--t){var p=m+"_"+q[t]+"_unit";"px"===a[p]?l.push(p):a[p]!==n&&null!==a[p]&&""!==a[p]&&(e[p]=a[p])}}else-1!==g.indexOf("gradient",3)?("180"==a[g]||"linear"===a[g]||a[g]===h.ThemifyGradient.default||!1===a[g]&&-1!==g.indexOf("-circle-radial",3))&&l.push(g):("background_zoom"===
g&&""===a[g]||"none"===a[g]&&-1!==g.indexOf("frame_layout")||"solid"===a[g]||!1===a[g]&&(-1!==g.indexOf("_user_role",3)||-1!==g.indexOf("_appearance",3)))&&l.push(g);if(0<l.length){for(t=l.length-1;-1<t;--t)delete e[l[t]],delete a[l[t]];l.length=0;continue}}!0===b?e.push(a[g]):e[g]=a[g]}else delete e.custom_parallax_scroll_reverse,delete e.custom_parallax_scroll_fade,delete e[g],delete a.custom_parallax_scroll_reverse,delete a.custom_parallax_scroll_fade,delete a[g];return e},clearElementId(a,b){for(var d in a){!0===
b?a[d].element_id=c.Utils.generateUniqueID():delete a[d].element_id;var e=a[d].styling!==n?a[d].styling:a[d].mod_settings;if(e!==n){if(e.custom_css_id!==n&&""!==e.custom_css_id)for(var f=2;;){var g=e.custom_css_id+"-"+f.toString(),h=p.getElementById(g);if(null===h||null===h.closest(".module_row")){e.custom_css_id=g;break}++f}e.builder_content!==n&&(f="string"===typeof e.builder_content?JSON.parse(e.builder_content):e.builder_content,this.clearElementId(f,!0),e.builder_content=f)}a[d].cols!==n?this.clearElementId(a[d].cols,
b):a[d].modules!==n&&this.clearElementId(a[d].modules,b)}},clearLastEmptyRow(a){for(var b=a.length-1;-1<b;--b){var d=a[b].attributes!==n?a[b].attributes:a[b];if(d.styling===n||null===d.styling||0===Object.keys(d.styling).length){d=d.cols;var e=!0,f;for(f in d)if(d[f].modules!==n&&(0<d[f].modules.length||0<Object.keys(d[f].modules).length)||d[f].styling!==n&&null!==d[f].styling&&0<Object.keys(d[f].styling).length){e=!1;break}if(!0===e)a[b].cid!==n&&(c.Models.Registry.remove(a[b].cid),a[b].destroy()),
a.splice(b,1);else break}else break}},builderPlupload(a,b){var d=b?!0:!1;b=d?[b]:m.Lightbox.$lightbox[0].getElementsByClassName("tb_plupload_upload_uic");var e=b.length;if(0<e)for(a=d?!1:"new_elemn"===a?".plupload-clone":!1,this.pconfig===n&&(this.pconfig=JSON.parse(JSON.stringify(themify_builder_plupload_init)),this.pconfig.multipart_params._ajax_nonce=themifyBuilder.tb_load_nonce,this.pconfig.multipart_params.topost=themifyBuilder.post_ID),--e;-1<e;--e)if(!b[e].classList.contains("tb_plupload_init")&&
(!1===a||b[e].classList.contains(a))){var f=b[e],g=f.getAttribute("id").replace("tb_plupload_upload_ui",""),l=h.extend(!0,{},this.pconfig),k=f.getAttribute("data-extensions"),p=["browse_button","container","drop_element","file_data_name"];l.multipart_params.imgid=g;for(var q=p.length-1;-1<q;--q)l[p[q]]=g+this.pconfig[p[q]];l.filters[0].extensions=null!==k?k:null!==c.activeModel?l.filters[0].extensions.replace(/,zip|,txt/,""):"zip,txt";g=new r.plupload.Uploader(l);f.classList.add("tb_plupload_init");
d&&g.bind("init",function(a){h(a.settings.browse_button).click()});g.bind("FilesAdded",function(a,b){a.refresh();a.start();m.showLoader("show")});g.bind("Error",function(a,b){a=h(".prompt-box .show-error");h(".prompt-box .show-login").hide();a.show();0<a.length&&a.html('<p class="prompt-error">'+b.message+"</p>");h(".overlay, .prompt-box").fadeIn(500)});g.bind("FileUploaded",function(a,b,e){var f=JSON.parse(e.response);a=h("#tb_alert",r.document);e=200!==e.status||f.error?"error":"done";if(f.error)m.showLoader(e),
alert(f.error);else if(d){var g=h("#tb_row_wrapper").children().clone(!0);a.promise().done(function(){c.Forms.reLoad(f,themifyBuilder.post_ID);var a=h("#tb_row_wrapper").children().clone(!0);m.Lightbox.close();c.undoManager.push("","","","import",{before:g,after:a,bid:themifyBuilder.post_ID})})}else m.showLoader(e),a=this.getOption().container.closest(".tb_input"),e=a.getElementsByClassName("tb_uploader_input")[0],a=a.getElementsByClassName("thumb_preview")[0],e.value=f.large_url?f.large_url:f.url,
a!==n&&ThemifyConstructor.file.setImage(a,f.thumb),v.triggerEvent(e,"change")});g.init();f.classList.remove("plupload-clone")}},columnDrag(a,b,d,e){var f=this;b&&(b=a?a.children(".module_column"):h(".module_column"),b.css("width",""),f.setCompactMode(b));if(d&&e){a=a.children(".module_column");var g=("gutter-narrow"===d?1.6:"gutter-none"===d?0:3.2)-("gutter-narrow"===e?1.6:"gutter-none"===e?0:3.2);g=parseFloat(g*(a.length-1)/a.length);a.each(function(a){h(this).prop("style").width&&(a=parseFloat(h(this).prop("style").width)+
g,h(this).css("width",a+"%"))})}else{var l={"col6-1":14,"col5-1":17.44,"col4-1":22.6,"col4-2":48.4,"col2-1":48.4,"col4-3":74.2,"col3-1":31.2,"col3-2":65.6},k={"col6-1":15.33,"col5-1":18.72,"col4-1":23.8,"col4-2":49.2,"col2-1":49.2,"col4-3":74.539,"col3-1":32.266,"col3-2":66.05},p={"col6-1":16.666,"col5-1":20,"col4-1":25,"col4-2":50,"col2-1":50,"col4-3":75,"col3-1":33.333,"col3-2":66.666};(a?a.children(".module_column").find(".tb_grid_drag"):h(".tb_grid_drag")).each(function(){var a,b,d,e,g=0,n,u=
!1,r=0,G=!1,E,x,y,z=null,A=null,D;h(this).draggable({axis:"x",cursor:"col-resize",distance:0,scroll:!1,snap:!1,containment:".row_inner",helper(c){a=h(c.currentTarget);b=a.closest(".subrow_inner");0===b.length&&(b=a.closest(".row_inner"));n=a[0].classList.contains("tb_drag_right")?"w":"e";E="w"===n?"tb_grid_drag_right_tooltip":"tb_grid_drag_left_tooltip";G=m.clone(b.closest(".module_row"));b.addClass("tb_drag_column_start");return h('<div class="ui-widget-header tb_grid_drag_tooltip '+E+'"></div><div class="ui-widget-header tb_grid_drag_tooltip"></div>')},
start(c,f){d=b.children(".module_column");e=a.closest(".module_column");y=b[0].classList.contains("direction-rtl");"w"===n?(u=y?e.prev(".module_column"):e.next(".module_column"),g=a.outerWidth(),D=e.outerWidth()):(u=y?e.next(".module_column"):e.prev(".module_column"),D=g=e.outerWidth());g=parseInt(g);r=parseInt(u.outerWidth())-2;x=b.outerWidth();z=e.addClass("tb_drag_column_current").children("."+E)[0];A=e.children(".tb_grid_drag_tooltip").last()[0]},stop(a,m){h(".tb_grid_drag_tooltip").remove();
b.removeClass("tb_drag_column_start");a=Math.ceil(100*(e.outerWidth()/x));e.removeClass("tb_drag_column_current").css("width",a+"%");var q=l;a=3.2;b[0].classList.contains("gutter-narrow")?(q=k,a=1.6):b[0].classList.contains("gutter-none")&&(q=p,a=0);var t=a*(d.length-1);d.each(function(a){a!==u.index()&&(h(this).prop("style").width?a=parseFloat(h(this).prop("style").width):(a=h.trim(f.filterClass(h(this).attr("class")).replace("first","").replace("last","")),a=q[a]),t+=a)});u.css("width",100-t+"%");
u=u.add(e);f.setCompactMode(u);a=b.closest(".module_row");m=!0===c.hasChanged;c.hasChanged=!0;c.undoManager.push(a.data("cid"),G,a,"row");c.hasChanged=m;v.body.triggerHandler("tb_grid_changed",[a]);z=A=g=r=x=D=u=E=e=n=y=b=d=null},drag(a,b){if(u&&0<u.length&&(a=parseInt(b.position.left),a=g+("e"===n?-a:a),b=parseFloat(100*a/x),5<=b&&100>b)){var c=r;c+="w"===n?-(a-D):D-a;var d=parseFloat(100*c/x);5<d&&100>d&&(u.css("width",c+"px"),e.css("width",a+"px"),z.innerHTML=b.toFixed(2)+"%",A.innerHTML=d.toFixed(2)+
"%")}}})})}},grid(a){var b=[];a=parseInt(a);if(1===a)b.push({grid_class:"col-full"});else for(var c=0;c<a;++c)b.push({grid_class:"col"+a+"-1"});return[{cols:b}]},setCompactMode(a){a instanceof jQuery&&(a=a.get());for(var b=a.length-1;-1<b;--b)185>a[b].clientWidth?a[b].classList.add("compact-mode"):a[b].classList.remove("compact-mode")},initNewEditor(a){if(3<parseInt(tinyMCE.majorVersion)){var b=tinyMCEPreInit.mceInit.tb_lb_hidden_editor;b.elements=a;b.selector="#"+a;a=new tinyMCE.Editor(a,b,tinyMCE.EditorManager);
a.render();return a}},initQuickTags(a){"function"===typeof r.QTags&&(r.quicktags({id:a}),r.QTags._buttonsInit())},_getColClass(a){for(var b=0,c=a.length;b<c;++b)if(-1!==this.gridClass.indexOf(a[b]))return a[b].replace("col","")},saveBuilder(a,b,d){b=b||0;if(0===b){if(null!==c.activeModel||0<m.Lightbox.$lightbox.length&&m.Lightbox.$lightbox[0].classList.contains("tb_custom_css_lightbox")){var e=m.Lightbox.$lightbox[0].getElementsByClassName("builder_save_button")[0];e!==n&&e.click();e=null}m.showLoader("show")}var f=
Object.keys(c.Instances.Builder).length,g=c.Instances.Builder[b],l=this;e=g.$el.data("postid");g=c.Mixins.Builder.toJSON(g.el);if(!0===d)return{id:e,data:g};c.GS.setImport(c.GS.styles,null,null,!0);(function(a,b){null===y&&(y=themifyBuilder.custom_css,delete themifyBuilder.custom_css);a={action:"tb_save_data",tb_load_nonce:themifyBuilder.tb_load_nonce,id:a,custom_css:y,sourceEditor:"visual"===c.mode?"frontend":"backend"};l.saveCss(b,a.custom_css,a.id);a.data=JSON.stringify(c.Utils.clear(b));return h.ajax({type:"POST",
url:themifyBuilder.ajaxurl,cache:!1,data:a})})(e,g).always(function(d,e){++b;f===b?(h.isFunction(a)&&a.call(l,d,e),"success"!==e?m.showLoader("error"):(m.showLoader("hide"),c.editing=!0,v.body.triggerHandler("themify_builder_save_data",[d,e]))):setTimeout(function(){l.saveBuilder(a,b)},50)})},saveCss(a,b,d){return h.ajax({type:"POST",url:themifyBuilder.ajaxurl,cache:!1,data:{css:JSON.stringify(c.GS.createCss(a,null,!0)),action:"tb_save_css",custom_css:b,tb_load_nonce:themifyBuilder.tb_load_nonce,
id:d}})},loadContentJs(a,b){if(!1===c.saving){const b=h("video.wp-video-shortcode",a);0<b.length&&v.media(b,function(){b.each(function(){let a=h(this).closest(".mejs-mediaelement");0<a.length&&(this.removeAttribute("style"),this.setAttribute("id",this.getAttribute("id").replace("_html5","")),a.closest(".widget").html(this))});b.mediaelementplayer(r.wpmejsSettings!==n?r.wpmejsSettings:{})})}"module"===b&&"visual"===c.mode&&v.fontAwesome(a);v.reRun(a,b)},createClearBtn(a){a.siblings(".tb_clear_btn tf_close").click(function(){h(this).hide();
a.val("").trigger("keyup")})},toRGBA(a){return ThemifyStyles.toRGBA(a)},getColor(a){let b=a.value;""!==b&&(null!==a.getAttribute("data-minicolors-initialized")?b=h(a).minicolors("rgbaString"):(a=a.getAttribute("data-opacity"),""!==a&&null!==a&&"1"!=a&&"0.99"!=a&&(b=this.toRGBA(b+"_"+a))));return b},getIcon(a,b){if("undefined"!==typeof themifyBuilder.fontello_prefix&&(new RegExp(themifyBuilder.fontello_use_suffix?themifyBuilder.fontello_prefix+"$":"^"+themifyBuilder.fontello_prefix)).test(a))return b=
p.createElement("i"),b.setAttribute("class",a),b;a="tf-"+a.trim().replace(" ","-");const c=p.createElementNS("http://www.w3.org/2000/svg","use"),e=p.createElementNS("http://www.w3.org/2000/svg","svg");let f="tf_fa "+a;b&&(f+=" "+b);e.setAttribute("class",f);c.setAttributeNS(null,"href","#"+a);e.appendChild(c);return e},getBPWidth(a){a=Array.isArray(themifyBuilder.breakpoints[a])?themifyBuilder.breakpoints[a]:themifyBuilder.breakpoints[a].toString().split("-");return a[a.length-1]},transitionPrefix(){return"transitionend"},
generateUniqueID(){return(Math.random().toString(36).substr(2,4)+(new Date).getUTCMilliseconds().toString()).substr(0,7)},getUIDList(a){a=a||"row";const b=_.pluck(c.Models.Registry.items,"attributes");return _.where(b,{elType:a})||[]},scrollTo(a){("desktop"===c.activeBreakPoint?h("html,body"):h("body",r.document)).scrollTop(a)},scrollToDropped(a,b){a||(a=c.Instances.Builder[c.builderIndex].el.getElementsByClassName("tb_element_cid_"+b)[0]);if(a)if("visual"===c.mode)this.scrollTo(h(a).offset().top-
120);else if(b=p.getElementsByClassName("edit-post-layout__content")[0],b!==n){if(a.classList.contains("module_row"))a=a.offsetTop;else{let b=a.closest(".module_row");null!==b?(b=h(b),a=b.offset().top+200-b.offsetParent().offset().top):a=a.offsetTop}h(b).scrollTop(a)}},addViewPortClass(a){a.style.transition="none";this.removeViewPortClass(a);let b=this.isInViewport(a);if(!1!==b){b=b.split(" ");for(let c=b.length-1;-1<c;--c)""!==b[c]&&a.classList.add(b[c])}a.style.transition=""},removeViewPortClass(a){const b=
["top","left","bottom","right"];for(let c=4;-1<c;--c)a.classList.remove("tb_touch_"+b[c])},isInViewport(a){a=a.getBoundingClientRect();let b="";0>a.left?b="tb_touch_left":a.right-1>=p.documentElement.clientWidth&&(b="tb_touch_right");if(0>a.top)b+=" tb_touch_top";else if(a.bottom+1>=p.documentElement.clientHeight||x.innerHeight+x.scrollY>=p.body.offsetHeight&&a.bottom+20>=p.documentElement.clientHeight)b+=" tb_touch_bottom";return""===b?!1:b},checkImageSize(a){var b=a.getElementsByTagName("img")[0],
c=function(c){b.width<c?a.classList.add("tb_disable_object_fit"):a.classList.remove("tb_disable_object_fit")};if(b!==n){var e=b.naturalWidth;if(e&&b.complete)c(e);else{var f=new Image;f.onload=function(){c(f.width)};f.src=b.src}}else a.classList.remove("tb_disable_object_fit")},checkAllimageSize(){const a=c.Instances.Builder[c.builderIndex].el,b=c.Models.Registry.items;for(let c in b)if("image"===b[c].attributes.mod_name){let d=a.getElementsByClassName("tb_element_cid_"+b[c].cid)[0];d!==n&&this.checkImageSize(d)}},
hideOnClick(a){a[0]!==n&&(a=a[0]);if(a.classList.contains("tb_ui_dropdown_items")||a.classList.contains("tb_down"))a.classList.add("tb_hide_option"),a.previousElementSibling.blur(),setTimeout(function(){a.classList.remove("tb_hide_option")},500)},calculateHeight(){"visual"===c.mode&&"desktop"!==c.activeBreakPoint&&(r.document.body.style.height=p.body.scrollHeight+"px")},changeOptions(a,b){const d="INPUT"===a.tagName&&"hide_anchor"!==b?"keyup":"change",e=this;"keyup"===d&&a.setAttribute("data-prev",
a.value);e.custom_css_id=function(a,b,c,d){a=p.getElementById(d);return null===a||c[0].getAttribute("id")===d||null===a.closest(".module_row")?(c[0].setAttribute("id",d),!0):!1};e.row_anchor=function(a,b,d,e){"visual"===c.mode&&(d.removeClass(c.liveStylingInstance.getRowAnchorClass(a.getAttribute("data-prev"))),""!==e&&d.addClass(c.liveStylingInstance.getRowAnchorClass(e)),d.data("anchor",e).attr("data-anchor",e));c.hasChanged=!0;d.find(".tb_row_anchor").first().text(e.replace("#",""));return!0};
e.custom_css=function(a,b,d,e){"visual"===c.mode&&d.removeClass(a.getAttribute("data-prev")).addClass(e);return!0};e.layout=function(a,b,d,e){"visual"===c.mode&&c.liveStylingInstance.bindRowWidthHeight(b,e,d);return!0};e.hide_anchor=function(a,b,d,e){"visual"===c.mode&&"1"===e&&d.data("hideAnchor",e).attr("data-hide-anchor",e);return c.hasChanged=!0};a.addEventListener(d,function(a){var f=null!==c.activeModel&&c.ActionBar.cid===c.activeModel.cid,l=!m.Lightbox.$lightbox[0].contains(this),k="hide_anchor"!==
b?this.id:"hide_anchor",u="custom_css_id"===k,q=!0!==u||!1!==l&&!0!==f?n:m.Lightbox.$lightbox[0].getElementsByClassName("builder_save_button")[0];var t=!0===l&&!1===f?h(".tb_element_cid_"+c.ActionBar.cid):"visual"===c.mode?c.liveStylingInstance.$liveStyledElmt:h(".tb_element_cid_"+c.activeModel.cid);var w=!1===f&&!0===l?m.clone(t[0]):null;var r=this.value;"keyup"===d&&"custom_css"!==b?((r=r.trim())&&(r=r.replace(/[^a-zA-Z0-9\-_]+/gi,"")),this.value=r):"layout"===b?r=a.detail.val:"hide_anchor"===b&&
(r=this.checked?"1":"0");if(e[b].call(e,this,k,t,r)){u&&(h(this).next(".tb_field_error_msg").remove(),q!==n&&q.classList.remove("tb_disable_save"));if(!0===l){var v=function(){var a=r;"keyup"===d&&(this.removeEventListener("change",v,{passive:!0,once:!0}),this.removeAttribute("data-isInit"),a=this.value.trim());var b=t.data("cid"),e=c.Models.Registry.lookup(b),f=h.extend(!0,{},e.get("styling"));f||(f={});var g=h.extend(!0,{},f);f[k]=a;e.set({styling:f},{silent:!0});null!==w&&c.undoManager.push(b,
w,t,"save",{bsettings:g,asettings:h.extend(!0,{},f)})};"keyup"===d?this.getAttribute("data-isInit")||(this.setAttribute("data-isInit",1),this.addEventListener("change",v,{passive:!0,once:!0})):v()}c.hasChanged=!0}else u&&(a=p.createElement("span"),a.className="tb_field_error_msg",a.textContent=ThemifyConstructor.label.errorId,this.parentNode.insertBefore(a,this.nextSibling),q!==n&&q.classList.add("tb_disable_save"));!0===f&&(f=l?m.Lightbox.$lightbox.find("#"+k):h("#"+c.ActionBar.el.id).find("#"+k),
"keyup"===d?f.val(r).attr("data-prev",r):"layout"===b?(f.find(".selected").removeClass("selected"),""!==r?f.find("#"+r).addClass("selected"):f.children().first().addClass("selected")):"hide_anchor"===b&&(f.find("INPUT")[0].checked=this.checked));"keyup"===d&&this.setAttribute("data-prev",r)},{passive:!0})},visibilityLabel(a,b){if(b===n)if(null!==c.activeModel)b=c.Forms.serialize("tb_options_visibility");else{var d=c.Models.Registry.lookup(a.getAttribute("data-cid"));d&&(b="module"!==d.get("elType")?
d.get("styling"):d.get("mod_settings"))}if(b){d="";a=a.getElementsByClassName("tb_visibility_hint")[0];const c={visibility_desktop:themifyBuilder.i18n.de,visibility_mobile:themifyBuilder.i18n.mo,visibility_tablet:themifyBuilder.i18n.ta,visibility_tablet_landscape:themifyBuilder.i18n.ta_l,sticky_visibility:themifyBuilder.i18n.s_v};if(a!==n){if("hide_all"===b.visibility_all)d=themifyBuilder.i18n.h_a;else{let a;for(let e in c)a=""===d?"":", ",d+="hide"===b[e]?a+c[e]:""}""!==d?(b=a.getElementsByTagName("span")[0],
b===n&&(b=p.createElement("span"),a.appendChild(b)),b.textContent=d,a.classList.add("tb_has_visiblity")):a.classList.remove("tb_has_visiblity")}}}};c.ActionBar={cid:null,topH:null,type:null,disable:null,prevExpand:null,needClear:!0,el:null,breadCrumbs:null,breadCrumbsPath:{lightbox:null,rightClick:null},disablePosition:null,isInit:null,isHoverMode:!0,hoverCid:null,contextMenu:null,contextMenuAnimate:null,init(){if(null===this.isInit&&!0!==c.GS.isGSPage){this.isInit=!0;this.el=p.createElement("div");
this.breadCrumbs=p.createElement("ul");this.el.id="tb_component_bar";this.breadCrumbs.className="tb_action_breadcrumb";this.el.addEventListener("mousedown",this.mouseDown.bind(this));this.topH=c.toolbar.$el.height();"visual"===c.mode?p.body.appendChild(this.el):c.Instances.Builder[c.builderIndex].el.parentNode.appendChild(this.el);p.addEventListener("click",this.click.bind(this));p.addEventListener("dblclick",this.click.bind(this));c.Instances.Builder[0].el.addEventListener("mouseover",this.enter);
"visual"===c.mode&&r.document.addEventListener("click",this.click.bind(this));var a="visual"===c.mode?null:p.getElementById("tb_canvas_block");null===a?(p.addEventListener("keydown",this.actions.bind(this)),r.document.addEventListener("keydown",this.actions.bind(this))):a.addEventListener("keydown",this.actions.bind(this));this.changeMode();this.initRightClick(!0)}},changeMode(){this.hoverCid=null;var a=this,b=function(b){a.actions(b)};!0===this.isHoverMode?(p.body.classList.remove("tb_click_mode"),
p.body.classList.add("tb_hover_mode"),this.el.removeEventListener("click",b)):(p.body.classList.remove("tb_hover_mode"),p.body.classList.add("tb_click_mode"),this.el.addEventListener("click",b))},initRightClick(a){localStorage.getItem("tb_right_click")?!0===a?c.toolbar.el.getElementsByClassName("tb_right_click_mode")[0].checked=!1:(c.Instances.Builder[0].el.removeEventListener("contextmenu",this.rightClick),this.contextMenu=this.contextMenuAnimate=null):(c.Instances.Builder[0].el.addEventListener("contextmenu",
this.rightClick),c.ActionBar.el.removeEventListener("contextmenu",this.rightClick),!0!==this.isHoverMode&&c.ActionBar.el.addEventListener("contextmenu",this.rightClick))},enter(a){var b=c.ActionBar;c.Mixins.Builder.columnHover(a.target);if(!0===b.isHoverMode&&null===b.disablePosition&&null===b.disable){a.preventDefault();a.stopPropagation();var d=a.target,e=null,f=d.classList;if(null!==b.prevExpand&&b.prevExpand!==n)if(b.prevExpand.contains(d)){if(f.contains("tb_inner_action_more")||f.contains("tb_action_more")){var g=
d.getElementsByTagName("ul")[0];g!==n&&c.Utils.addViewPortClass(g)}g=b.prevExpand.getElementsByClassName("tb_row_settings")[0];if(g!==n){var l=p.getElementById(g.getAttribute("data-href"));if(l.contains(d))return;l.classList.remove("selected");g.classList.remove("selected")}if("module"===b.type||"column"===b.type){"column"===b.type&&(b.hoverCid=d.parentNode.getAttribute("data-cid"));return}}else{g="module"!==b.type;if(!1===g)"visual"!==c.mode?(g=d.closest(".active_module"),g=null!==g?g.getAttribute("data-cid")!==
b.hoverCid:!0):(l=d.closest(".tb_dragger_top"),null!==l&&l.classList.contains("tb_dragger_padding")&&c.EdgeDrag.setModulePosition(l));else if(f.contains("tb_clicked"))return;!0===g&&b.clear()}if(null===d.closest(".tb_dragger_lightbox")){if(f.contains("tb_action_wrap"))e=!f.contains("tb_clicked");else{if("LI"===d.nodeName&&f.contains("tb_row_settings")&&!f.contains("selected")){b.actions(a);return}if(!f.contains("tb_grid_drag")){d=h(d).closest("[data-cid]")[0];if(d===n)return;f=d.getAttribute("data-cid");
if(b.hoverCid===f)return;b.hoverCid=f;g=c.Models.Registry.lookup(f);f=g.get("elType");if("module"===f)e=!0;else if("visual"===c.mode){b.clear();c.EdgeDrag.addEdges(f,g,d);return}}}!0===e&&b.click(a)}}},rightClickGS(a,b,d){this.disable=!0;null!==c.activeModel&&h(".builder_save_button",ThemifyBuilderCommon.Lightbox.$lightbox).click();var e=c.Instances.Builder[c.builderIndex].el.getElementsByClassName("tb_element_clicked"),f=c.GS.key;b=b.split(" ");for(var g=b.length,l=e.length-1;-1<l;--l){var k=c.Models.Registry.lookup(e[l].getAttribute("data-cid")),
p=m.clone(e[l]),q="module"===k.get("elType")?"mod_settings":"styling",n=h.extend(!0,{},k.get(q)),w=h.extend(!0,{},n);c.activeModel=k;if(n[f])if(!0===d)a&&-1!==n[f].indexOf(a)&&(n[f]=n[f].split(" "),n[f].splice(n[f].indexOf(a),1),n[f]=n[f].join(" "));else for(var r=0;r<g;++r)-1===n[f].indexOf(b[r])&&(n[f]+=" "+b[r]);else{if(0===g)continue;n[f]=b.join(" ")}r={};r[q]=n;k.set(r,{silent:!0});c.GS.generateValues(a,n[f].split(" "),d);c.undoManager.push(k.cid,p,h(e[l]),"save",{bsettings:w,asettings:n})}this.disable=
null;c.activeModel=null},rightClick(a,b){a.stopImmediatePropagation();var d=c.ActionBar;if(null===d.contextMenuAnimate){d.contextMenuAnimate=!0;if(null===d.contextMenu){var e=function(a){a.stopPropagation();"click"===a.type&&null===a.target.closest(".tb_visibility_wrap")&&a.preventDefault();if("LI"===a.target.nodeName||a.target.classList.contains("toggle_switch")){var b="LI"===a.target.nodeName?a.target.getAttribute("data-action"):"visibility";if(b){d.disable=!0;d.hoverCid=null;if("undo"===b||"redo"===
b)if(a="undo"===b?c.undoManager.btnUndo:c.undoManager.btnRedo,"undo"===b&&c.undoManager.hasUndo()||"redo"===b&&c.undoManager.hasRedo())h(a).triggerHandler("click"),d.disable=null;else{d.disable=null;return}else{var e=this.classList.contains("tb_multiply_selected"),f=c.Instances.Builder[c.builderIndex].el.getElementsByClassName("tb_element_clicked"),g=n;"gs_in"!==b&&"move"!==b&&(!0!==e||"delete"!==b&&"paste"!==b||(g=!0),h(".builder_save_button",ThemifyBuilderCommon.Lightbox.$lightbox).click());if("reset"===
b)var l=c.activeModel,k=h.extend(!0,{},ThemifyConstructor.values),q=ThemifyConstructor.component,p=ThemifyConstructor.beforeData,u=!0===c.hasChanged,t="visual"===c.mode?c.liveStylingInstance.prefix:null,r="visual"===c.mode?c.liveStylingInstance.$liveStyledElmt:null;else{if("move"===b){d.disable=null;return}if("gs_in"===b){if(!1===e){b=c.Models.Registry.lookup(f[0].dataset.cid);var w=h.extend(!0,{},ThemifyConstructor.values);ThemifyConstructor.values="module"===b.get("elType")?b.get("mod_settings"):
b.get("styling")}if(b=c.GS.globalStylesHTML())a=d.contextMenu.querySelector("#tb_inline_gs"),a.innerHTML="",a.appendChild(b),a.getElementsByClassName("tb_gs_icon")[0].click(),a.querySelector('[data-action="insert"]').click(),a.classList.add("tb_inline_gs_show"),c.Utils.addViewPortClass(d.contextMenu);!1===e&&(ThemifyConstructor.values=w);d.disable=null;return}}for(e=f.length-1;-1<e;--e){var v=f[e].getAttribute("data-cid"),x=c.Models.Registry.lookup(v),y=x.get("elType");w="module"===y?x.get("mod_settings"):
x.get("styling");if("reset"===b||"gs_r"===b){if("gs_r"!==b||w[c.GS.key]!==n){if(null!==c.activeModel&&c.activeModel.cid===v){var z=ThemifyBuilderCommon.Lightbox.$lightbox.find(".reset-styling")[0];if(z!==n){z.click();continue}}z=m.clone(f[e]);var A;c.activeModel=x;"reset"===b&&(ThemifyConstructor.component=y,ThemifyConstructor.values=w);var C="module"===y?"mod_setting":"styling";"visual"===c.mode&&(c.liveStylingInstance.$liveStyledElmt?c.liveStylingInstance.prefix=ThemifyStyles.getBaseSelector("module"===
y?c.activeModel.get("mod_name"):y,c.activeModel.get("element_id")):c.liveStylingInstance.init(!0),c.liveStylingInstance.$liveStyledElmt=h(f[e]));y=h.extend(!0,{},w);"reset"===b?(w=ThemifyConstructor.resetStyling(a,null!==l&&l.cid!==v),"visual"===c.mode&&(A=h.extend(!0,{},w)),w=h.extend(!0,{},ThemifyConstructor.values)):(delete w[c.GS.key],c.GS.generateValues(null,[],!0));var H={};H[C]=w;x.set(H,{silent:!0});c.hasChanged=!0;c.undoManager.push(v,z,h(f[e]),"save",{bsettings:y,asettings:w,styles:A});
A=null}}else("delete"!==b&&"visibility"!==b||"column"!==y)&&x.trigger(b,a,a.target,g)}"reset"===b?(c.hasChanged=u,c.activeModel=l,ThemifyConstructor.values=k,ThemifyConstructor.component=q,ThemifyConstructor.beforeData=p,"visual"===c.mode&&(c.liveStylingInstance.$liveStyledElmt=r,c.liveStylingInstance.prefix=t)):"edit"!==b&&(c.activeModel=null);d.disable=null}"visibility"!==b&&d.hideContextMenu()}}},f=function(a){a.stopPropagation();a.target.classList.contains("tb_inner_action_more")&&(a=a.target.getElementsByTagName("ul")[0],
a!==n&&c.Utils.addViewPortClass(a))};d.contextMenu=p.getElementById("tb_right_click");null===d.contextMenu&&(d.contextMenu=p.getElementById("tmpl-builder_right_click").content,p.body.appendChild(d.contextMenu),d.contextMenu=p.getElementById("tb_right_click"),d.contextMenu.addEventListener("click",e),d.contextMenu.addEventListener("mouseover",f,{passive:!0}),d.contextMenu.getElementsByClassName("tb_r_name")[0].addEventListener("mousedown",function(a){1!==a.which||d.contextMenu.classList.contains("tb_multiply_selected")||
d.contextMenu.classList.contains("tb_component_column")||(a.preventDefault(),a.stopPropagation(),a=c.Instances.Builder[c.builderIndex].el.getElementsByClassName("tb_element_clicked")[0],a!==n&&(d.hideContextMenu(),d.cid=a.dataset.cid,d.moveComponent()))}))}var g=!0;!0!==d.isHoverMode&&null!==d.cid?b=c.Instances.Builder[c.builderIndex].el.querySelector('[data-cid="'+d.cid+'"]'):b?g=!1:b=h(a.target).closest("[data-cid]")[0];if(b===n)d.contextMenuAnimate=null;else{a.preventDefault();d.hideContextMenu(a.target.classList.contains("tb_bread"));
d.disablePosition=!0;p.body.classList.add("tb_right_click_open");d.contextMenu.className="tb_show_context";var l=a.pageX,k=a.pageY,u=c.Models.Registry.lookup(b.dataset.cid),q=u.get("elType"),t=function(e){if("transform"===e.propertyName){var f=c.Instances.Builder[c.builderIndex].el;e=this.getElementsByClassName("tb_r_name")[0];var h=this.getElementsByClassName("tb_action_breadcrumb")[0],m=function(a){a.preventDefault();a.stopPropagation();var b=a.target.getAttribute("data-id");b&&(this.removeEventListener("click",
m),d.hideContextMenu(!0),b=c.Instances.Builder[c.builderIndex].el.getElementsByClassName("tb_element_cid_"+b)[0],b!==n&&d.rightClick(a,b))};this.removeEventListener("transitionend",t,{passive:!0});this.className="tb_component_"+q;"module"===q&&(this.className+=" tb_module_"+u.get("mod_name"));h.innerHTML="";if(!0===a.ctrlKey||!0===a.metaKey)b.classList.add("tb_element_clicked");else if(!b.classList.contains("tb_element_clicked")){var p=f.getElementsByClassName("tb_element_clicked");for(var r=p.length-
1;-1<r;--r)p[r].classList.remove("tb_element_clicked");b.classList.add("tb_element_clicked")}p=f.getElementsByClassName("tb_element_clicked").length;1<p?(this.className+=" tb_multiply_selected",e.textContent=themifyBuilder.i18n.multiSelected):(f=null===d.breadCrumbsPath.rightClick?u.cid:d.breadCrumbsPath.rightClick[d.breadCrumbsPath.rightClick.length-1],d.breadCrumbsPath.rightClick=d.getBreadCrumbPath(c.Instances.Builder[0].el.getElementsByClassName("tb_element_cid_"+f)[0],"rightClick"),f=null,h.appendChild(d.getBreadCrumbs(b,
"rightClick")),e.textContent="module"===q?themifyBuilder.modules[u.get("mod_name")].name:q);h.addEventListener("click",m);var w=function(a){"transform"===a.propertyName?(this.removeEventListener("transitionend",w,{passive:!0}),c.Utils.addViewPortClass(this),d.contextMenuAnimate=null):(this.style.top=k+"px",!0===g&&(this.style.left=l+"px"))};this.addEventListener("transitionend",w,{passive:!0});c.undoManager.hasUndo()||(this.className+=" tb_undo_disabled");"column"===q&&(this.className+=" tb_visibility_disabled");
c.undoManager.hasRedo()||(this.className+=" tb_redo_disabled");this.className+=" tb_show_context"}};d.contextMenu.addEventListener("transitionend",t,{passive:!0});setTimeout(function(){d.contextMenu.className=""},18)}}},hideContextMenu(a){if(null!==this.contextMenu){this.contextMenu.style.top="";var b=this.contextMenu.querySelector("#tb_inline_gs");b.classList.contains("tb_inline_gs_show")&&b.classList.remove("tb_inline_gs_show");p.body.classList.remove("tb_right_click_open");this.disablePosition=
this.hoverCid=null;!0!==a&&(c.ActionBar.breadCrumbsPath.rightClick=null)}},mouseDown(a){1!==a.which||"row"!==this.type&&"subrow"!==this.type||!a.target.classList.contains("tb_move")||(a.preventDefault(),a.stopPropagation(),this.moveComponent())},moveComponent(){var a=c.Instances.Builder[c.builderIndex].el.getElementsByClassName("tb_element_cid_"+this.cid)[0];if(a!==n){var b=a.classList.contains("module_row")?a.getElementsByClassName("tb_row_action")[0]:a;a=h(a).offset();this.clear();if("function"===
typeof Event)var d=new Event("mousedown",{bubbles:!0,cancelable:!1});else d=p.createEvent("Event"),d.initEvent("mousedown",!0,!1);d.pageX=a.left;d.pageY=a.top;d.which=1;b.dispatchEvent(d)}},click(a){if(c.isPreview||!0===this.disable)return!0;var b=a.target,d=b.tagName,e=null,f=c.Instances.Builder[c.builderIndex].lastRow,g="visual"===c.mode&&b.ownerDocument===r.document?n:h(b).closest("[data-cid]")[0],l=a.type;if("click"===l){this.hideContextMenu();e=!0===a.ctrlKey||!0===a.metaKey;if(r.document.body.classList.contains("tb_standalone_lightbox")&&
!r.document.body.classList.contains("modal-open")){c.toolbar.el.contains(b)||m.Lightbox.$lightbox[0].contains(b)||m.Lightbox.$lightbox[0].classList.contains("tb_predesigned_lightbox")||m.Lightbox.close();var k=r.document.getElementsByClassName("tb_current_menu_selected")[0];k!==n&&k.classList.remove("tb_current_menu_selected");k=null}f&&!f.contains(b)&&f.classList.remove("expanded");if(!m.Lightbox.$lightbox[0].contains(b)&&(!1===e&&this.clearClicked(),g!==n)){if(!0===e&&g.classList.contains("tb_element_clicked")){g.classList.remove("tb_element_clicked");
return}g.classList.add("tb_element_clicked")}}else if("dblclick"===l&&null!==c.Forms.LayoutPart.id&&b.classList.contains("tb_overlay")){c.Forms.LayoutPart.save(a,!0);return}k=("click"===l||"dblclick"===l)&&"visual"===c.mode&&m.Lightbox.dockMode.get();if(g===n||!("dblclick"===l||!0===k&&b.classList.contains("tb_dragger"))&&b.classList.contains("tb_disable_sorting")||g.classList.contains("tb_active_layout_part"))"LI"===d&&b.classList.contains("tb_bread")?(f=c.Models.Registry.lookup(b.getAttribute("data-id")),
"setting"!==ThemifyConstructor.clicked&&"module"===ThemifyConstructor.component&&(a=m.Lightbox.$lightbox[0].getElementsByClassName("tb_lightbox_top_bar")[0].querySelector(".current a").getAttribute("href"),m.Lightbox.$lightbox.off("themify_opened_lightbox.tb_breadCrumbs").on("themify_opened_lightbox.tb_breadCrumbs",function(){"row"===ThemifyConstructor.component?m.Lightbox.$lightbox.off("themify_opened_lightbox.tb_breadCrumbs")[0].getElementsByClassName("tb_lightbox_top_bar")[0].querySelector('a[href="'+
this+'"]').click():null===c.activeModel&&m.Lightbox.$lightbox.off("themify_opened_lightbox.tb_breadCrumbs")}.bind(a)),a=null),a=null===this.breadCrumbsPath.lightbox?c.activeModel.cid:this.breadCrumbsPath.lightbox[this.breadCrumbsPath.lightbox.length-1],this.breadCrumbsPath.lightbox=this.getBreadCrumbPath(c.Instances.Builder[0].el.getElementsByClassName("tb_element_cid_"+a)[0]),a=null,f.trigger("edit","breadcrumb")):this.el.contains(b)||"click"===a.type&&b.classList.contains("tb_dragger")||this.clear();
else{"visual"!==c.mode||"A"!==d&&null===b.closest("a")||a.preventDefault();var u=g.getAttribute("data-cid");f=c.Models.Registry.lookup(u);var q=f.get("elType"),t="row"===q&&g.classList.contains("tb-page-break");if(f){if("dblclick"===l){if((!0===k||"INPUT"===d||!0===t||b.classList.contains("tb_dragger_lightbox")||null!==b.closest(".tb_clicked"))&&"tb_row_options"!==b.id)return;a.preventDefault();a.stopPropagation();!1===k&&!0!==this.isHoverMode?(g.classList.add("tb_element_clicked"),v.body[0].classList.add("tb_action_active"),
"visual"===c.mode&&c.EdgeDrag.addEdges("module"===q?f.get("mod_name"):q,f,g)):g.classList.remove("tb_element_clicked");if(!b.classList.contains("tb_row_settings")){this.hoverCid=null;f.trigger("edit",a,b);return}}else if("click"===l&&!1===k&&(b.classList.contains("tb_dragger")||null!==b.closest(".tb_dragger_options")))return;var w=!0===this.isHoverMode,B=!0!==w&&null!==this.cid;d="module"!==q?b.classList.contains("tb_action_wrap"):!0===w;this.cid=u;this.type=q;if(!0===t&&"row"===q)this.clear(),b.classList.contains("tb_row_anchor")&&
(a.preventDefault(),a.stopPropagation(),f.trigger("delete",a,b));else if((!1===d||"module"===q&&!0===w)&&null!==b.closest(".tb_action_wrap"))"click"===l&&this.actions(a);else if(!0===w&&"click"===l&&!0===this.needClear)!0===k&&!1===e&&f.trigger("edit",a,b);else if(this.clear(),!0===B&&"click"===l&&!1===e&&!1===k&&!0===this.needClear){v.body[0].classList.add("tb_action_active");var F=this,x=function(){p.removeEventListener("mousemove",x,{passive:!0,once:!0});null===F.cid&&(v.body[0].classList.remove("tb_action_active"),
F.clearClicked())};p.removeEventListener("mousemove",x,{passive:!0,once:!0});p.addEventListener("mousemove",x,{passive:!0,once:!0})}else{this.cid=u;this.type=q;l=p.getElementById("tmpl-builder_"+q+"_action").content.cloneNode(!0);if(!0===d){this.prevExpand="module"===q?g.getElementsByClassName("tb_module_action")[0]:b;if(this.prevExpand===n){this.clear();return}this.prevExpand.appendChild(l);this.prevExpand.setAttribute("id",this.el.id);this.prevExpand.style.top="";this.prevExpand.closest(".tb_action_wrap").classList.add("tb_clicked");
!0===w&&"module"===q&&(l=!0,e=g.getBoundingClientRect(),70>e.height||200>e.width?(this.prevExpand.classList.add("tb_small_action_bar"),this.prevExpand.classList.remove("tb_small_action_bar_top"),this.prevExpand.classList.remove("tb_small_action_bar_bottom"),this.prevExpand.style.top=0,40>this.prevExpand.getBoundingClientRect().top?(this.prevExpand.style.top="100%",this.prevExpand.classList.add("tb_small_action_bar_top")):this.prevExpand.classList.add("tb_small_action_bar_bottom"),70>e.height?this.prevExpand.classList.add("tb_small_action_bar_height"):
this.prevExpand.classList.remove("tb_small_action_bar_height"),200>e.width?this.prevExpand.classList.add("tb_small_action_bar_width"):this.prevExpand.classList.remove("tb_small_action_bar_width"),l=!1):this.prevExpand.classList.remove("tb_small_action_bar"),"visual"===c.mode&&(!0===l&&75>e.height&&(e=this.prevExpand.nextElementSibling,null!==e&&e.classList.contains("tb_module_btn_plus")&&null!==e.offsetParent||(e=g.parentNode.nextElementSibling),null!==e&&(e=this.prevExpand.getBoundingClientRect().bottom-
e.getBoundingClientRect().top,0<=e&&(this.prevExpand.style.top=this.prevExpand.offsetTop-e-2+"px"))),c.EdgeDrag.addEdges(f.get("mod_name"),f,g)))}else("row"!==q||"row"===q&&null!==this.breadCrumbsPath.lightbox)&&this.setBreadCrumbs(g),this.el.className="tb_show_toolbar tb_"+q+"_action",e=p.createElement("div"),e.className="tb_action_label_wrap",e.appendChild(l),"visual"===c.mode&&("module"===q?(l=f.get("mod_name"),this.el.className+=" tb_"+l+"_action",l=themifyBuilder.modules[l].name):(l=q,"row"===
q&&(u=f.get("styling").row_anchor,u!==n&&(u=u.trim(),""!==u&&(l+=" #"+u)))),u=p.createElement("div"),u.className="tb_data_mod_name",u.textContent=l.charAt(0).toUpperCase()+l.slice(1),e.appendChild(u)),this.el.appendChild(e);!0!==w&&(g.classList.add("tb_element_clicked"),v.body[0].classList.add("tb_action_active"),"visual"===c.mode&&c.EdgeDrag.addEdges("module"===q?f.get("mod_name"):q,f,g));if(!0===k&&(f.trigger("edit",a,b),!0===w||null!==this.disablePosition&&!1!==d&&!0===w))return;null===this.disablePosition&&
(!1===d&&!0!==w?(b=a.pageX,g=a.pageY,"visual"!==c.mode&&(e=c.Instances.Builder[0].el.getBoundingClientRect(),b=a.clientX-e.left,g=a.clientY-e.top+30),this.setPosition(this.el,{left:b,top:g})):c.Utils.addViewPortClass(this.prevExpand))}}else!0!==w&&this.clear()}},setBreadCrumbs(a){for(;null!==this.breadCrumbs.firstChild;)this.breadCrumbs.removeChild(this.breadCrumbs.firstChild);this.breadCrumbs.appendChild(this.getBreadCrumbs(a));null===this.el.firstChild?this.el.appendChild(this.breadCrumbs):this.el.insertBefore(this.breadCrumbs,
this.el.firstChild)},getBreadCrumbPath(a,b){b="rightClick"!==b?"lightbox":b;b=null!==this.breadCrumbsPath[b]?this.breadCrumbsPath[b]:[];if(0<b.length)return b;if(n!==a){var c=a.getAttribute("data-cid");for(c&&b.push(c);!a.classList.contains("module_row");)a=a.parentNode,(c=a.getAttribute("data-cid"))&&b.push(c)}return b},getBreadCrumbs(a,b){var d=this.getBreadCrumbPath(a,b),e=p.createDocumentFragment();if(n!==a)for(a="rightClick"===b?a.dataset.cid:c.activeModel?c.activeModel.cid:c.ActionBar.cid,b=
d.length-1;-1<b;--b){var f=p.createElement("li"),g=c.Models.Registry.lookup(d[b]),h=g.get("elType");f.textContent="column"===h?g.get("component_name"):"module"===h?g.get("mod_name"):h;f.className="tb_bread tb_bread_"+h;a===d[b]&&(f.className+=" tb_active_bc");f.setAttribute("data-id",d[b]);e.appendChild(f)}return e},actions(a){var b=a.target,d=b.tagName;if("keydown"===a.type){if("INPUT"!==d&&"TEXTAREA"!==d&&!themifyBuilder.disableShortcuts&&!m.Lightbox.$lightbox[0].contains(b)){d=a.keyCode;var e=
p.getElementsByClassName("tb_element_clicked"),f=e.length;if(0<f){a.preventDefault();a.stopPropagation();var g=null,l=null,k=n,u=!0===a.ctrlKey||!0===a.metaKey;46===d||8===d?g="delete":!0===u&&(67===d?(g="copy",f=1):68===d?g="duplicate":86===d&&(g="paste",!0===a.shiftKey&&(l="style")));1<f&&("delete"===g||"paste"===g)&&(k=!0,null!==c.activeModel&&m.Lightbox.$lightbox.is(":visible")&&ThemifyConstructor.saveComponent());for(b=f-1;-1<b;--b){var q=e[b];if(null===g){if(!0===u&&1===f&&(38===d||40===d)){var t=
38===a.which?"up":"down",r="up"===t?q.previousElementSibling:q.nextElementSibling;if(null!==r){if(q.classList.contains("module_row")){if(!r.classList.contains("module_row"))continue;var B=c.Instances.Builder[c.builderIndex].$el}else if(q.classList.contains("active_module")){if(!r.classList.contains("active_module"))continue;B=h(q.parentNode.closest(".tb_holder"))}else continue;r&&(r=h(q),B.sortable("option","beforeStart")(null,null,{item:r}),B.sortable("option","start")(null,{item:r}),"up"===t?r.prev().before(r):
r.next().after(r),B.sortable("option","update")({type:"sortupdate"},{item:r}),B.sortable("option","stop")(null,{item:r,helper:null}),!0!==this.isHoverMode&&q.classList.add("tb_element_clicked"))}}}else"delete"===g&&q.classList.contains("module_column")||(q=c.Models.Registry.lookup(h(q).closest("[data-cid]")[0].getAttribute("data-cid")),q.trigger(g,a,l,k))}"delete"!==g&&!0===this.isHoverMode||this.clear()}}}else if(a.stopPropagation(),"click"===a.type&&null!==b.closest(".switch-wrapper"))b.classList.contains("toggle_switch")&&
c.Models.Registry.lookup(h(b).closest("[data-cid]")[0].getAttribute("data-cid")).trigger("visibility",a,b);else if(a.preventDefault(),null!==this.cid&&("LI"===d||"SPAN"===d||"A"===d)&&(f=(e=b.classList.contains("tb_bread"))?b.getAttribute("data-id"):this.cid,t=null,q=c.Models.Registry.lookup(f),g=b.classList,q))if(v.body[0].classList.remove("tb_component_menu_active"),!0===e)this.needClear=null,this.disablePosition=!0,p.getElementsByClassName("tb_element_cid_"+f)[0].click(),this.disablePosition=null,
"visual"===c.mode&&(b=this.el.getBoundingClientRect(),b.right>=p.body.clientWidth&&this.setPosition(this.el,{left:b.left,top:this.el.offsetTop+55})),this.needClear=!0;else if(t=b.getAttribute("data-href"))for(a=b.parentNode.getElementsByTagName("li"),b=a.length-1;-1<b;--b)d=(q=a[b].getAttribute("data-href"))?p.getElementById(q):null,e=a[b].classList.contains("selected"),a[b].classList.remove("selected"),null!==d&&d.classList.remove("selected"),q!==t||e||("tb_row_options"===q||"tb_rgrids"===q?this.gridMenu(d):
"tb_roptions"===q&&0===d.children.length&&this.setRowOptions(d),d.classList.add("selected"),a[b].classList.add("selected"),c.Utils.addViewPortClass(d),v.body[0].classList.add("tb_component_menu_active"));else{if(g.contains("tb_edit")||g.contains("tb_styling")||g.contains("tb_visibility_component")||g.contains("tb_swap"))t="edit";else if(g.contains("tb_duplicate"))t="duplicate";else if(g.contains("tb_save_component"))t="save";else if(g.contains("tb_delete"))t="delete";else if(g.contains("tb_import")||
g.contains("tb_export"))t="importExport";else if(g.contains("tb_copy_component"))t="copy";else if(g.contains("tb_paste_component")||g.contains("tb_paste_style"))t="paste";else{if("LI"===d||"SPAN"===d||g.contains("tb_action_more")||g.contains("tb_inner_action_more")){a=b.closest("li");if(null===a)return;e=a.parentNode;t=e.classList;q=t.contains("tb_grid_list")||t.contains("tb_column_alignment")||t.contains("tb_column_gutter")||t.contains("tb_column_direction")||t.contains("tb_column_height")||t.contains("grid_tabs");
d=b.classList.contains("selected");e=e.children;if(q&&d)return;for(b=e.length-1;-1<b;--b)if(e[b].classList.remove("selected"),!1===q)for(f=e[b].getElementsByClassName("selected"),g=f.length-1;-1<g;--g)f[g].classList.remove("selected");d||(a.classList.add("selected"),v.body[0].classList.add("tb_component_menu_active"));if(q)t.contains("tb_column_alignment")?this._columnAlignmentClicked(a):t.contains("tb_column_gutter")?this._gutterChange(a):t.contains("tb_column_direction")?this._columnDirectionClicked(a):
t.contains("tb_column_height")?this._columnHeight(a):t.contains("grid_tabs")?this._switchGridTabs(a):t.contains("tb_grid_list")&&this._gridClicked(a);else{e=null!==this.prevExpand?this.prevExpand.children:this.el.getElementsByClassName("tb_action_label_wrap")[0].children;for(b=e.length-1;-1<b;--b)e[b].classList.remove("selected");d||null!==this.prevExpand&&"column"!==this.type||(e=a.getElementsByTagName("ul")[0],e!==n&&c.Utils.addViewPortClass(e))}}return}if(!0!==this.isHoverMode)this.clear();else{var x=
b.closest(".tb_action_more");null!==x&&(x=x.getElementsByTagName("ul")[0],x.style.display="none",setTimeout(function(){null!==x&&(x.style.display="")},100))}q.trigger(t,a,b)}},_switchGridTabs(a){c.ActionBar.disable=c.clearOnModeChange=!0;c.ActionBar.hoverCid=null;c.scrollTo=h(p.getElementsByClassName("tb_element_cid_"+this.cid)[0]);ThemifyConstructor.lightboxSwitch(a.getAttribute("data-id"));"visual"!==c.mode&&this.gridMenu(a.closest(".tb_toolbar_tabs"))},_gridClicked(a){var b=h(a),d=b.data("grid"),
e=this.type,f=h(".tb_element_cid_"+this.cid).first(),g=!1,l=c.activeBreakPoint,k="desktop"===l;a=m.clone(f.closest(".module_row"));g="subrow"===e;var u=f.find("."+e+"_inner").first();if(k){e=u;var q=b.data("col");e=e.add(h("#tb_rgrids"));q===n&&(q=1,b.data("col",q));for(l=6;0<l;--l)e.removeClass("col-count-"+l);e.addClass("col-count-"+q);u.attr("data-basecol",q);k&&b.closest(".tb_grid_menu").find(".tb_grid_reposnive .tb_grid_list").each(function(){var a=h(this).find(".selected"),b=h(this).data("type"),
c=a.data("col");c!==n&&(c>q||4===q&&3===c||4<=q&&4<=c&&q!=c)&&(a.removeClass("selected"),u.removeClass("tb_grid_classes col-count-"+u.attr("data-basecol")+" "+u.attr("data-col_"+b)).attr("data-col_"+b,""),h(this).closest(".tb_grid_list").find("."+b+"-auto").addClass("selected"))})}else return"-auto"!==d[0]?(a="column"+d.join("-"),q=b.data("col"),3===q&&u.attr("data-basecol")>q&&(a+=" tb_3col"),u.removeClass(u.attr("data-col_tablet")+" "+u.attr("data-col_tablet_landscape")+" "+u.attr("data-col_mobile")).addClass(a+
" tb_grid_classes col-count-"+u.attr("data-basecol")).attr("data-col_"+l,a)):u.removeClass("tb_grid_classes tb_3col col-count-"+u.attr("data-basecol")+" "+u.attr("data-col_"+l)).attr("data-col_"+l,""),"visual"===c.mode&&(h("body",r.document).height(p.body.scrollHeight),c.Utils.calculateHeight()),c.Utils.setCompactMode(u.children(".module_column")),!1;b=u.children(".module_column");k=d.length;e="module_column"+(g?" sub_column":"")+" col";for(l=0;l<k;++l)f=b.eq(l),0<f.length?f.removeClass(c.Utils.gridClass.join(" ")).addClass(e+
d[l]):c.Utils._addNewColumn({newclass:e+d[l],component:g?"sub-column":"column"},u[0]);k<u.children().length&&u.children(".module_column").eq(k-1).nextAll().each(function(){h(this).find(".tb_holder").first().children().appendTo(h(this).prev().find(".tb_holder").first());h(this).remove()});d=u.children();d.removeClass("first last");u.hasClass("direction-rtl")?(d.last().addClass("first"),d.first().addClass("last")):(d.first().addClass("first"),d.last().addClass("last"));c.Utils.columnDrag(u,!0);f=u.closest(".module_row");
c.hasChanged=!0;c.Mixins.Builder.updateModuleSort(f);c.undoManager.push(f.data("cid"),a,f,"row");v.body.triggerHandler("tb_grid_changed",[f])},_columnHeight(a){a=h(a).data("value");if(a!==n){var b=h(".tb_element_cid_"+this.cid).first(),d=c.Models.Registry.lookup(this.cid),e=m.clone(b);b=b.find("."+this.type+"_inner").first();""===a?b.removeClass("col_auto_height"):b.addClass("col_auto_height");d.set({column_h:a},{silent:!0});c.undoManager.push(this.cid,e,h(".tb_element_cid_"+this.cid).first(),"row")}},
_columnAlignmentClicked(a){a=h(a);if(a=a.data("alignment")){var b=h(".tb_element_cid_"+this.cid).first(),d=c.Models.Registry.lookup(this.cid),e=m.clone(b);b.find("."+this.type+"_inner").first().removeClass(d.get("column_alignment")).addClass(a);d.set({column_alignment:a},{silent:!0});c.undoManager.push(this.cid,e,h(".tb_element_cid_"+this.cid).first(),"row")}},_columnDirectionClicked(a){a=h(a);if(a=a.data("dir")){var b=h(".tb_element_cid_"+this.cid).first().find("."+this.type+"_inner").first(),d=
b.children(".module_column"),e=d.first();d=d.last();var f=c.Models.Registry.lookup(this.cid),g={};g[c.activeBreakPoint+"_dir"]=a;f.set(g,{silent:!0});"rtl"===a?(e.removeClass("first").addClass("last"),d.removeClass("last").addClass("first"),b.addClass("direction-rtl")):(e.removeClass("last").addClass("first"),d.removeClass("first").addClass("last"),b.removeClass("direction-rtl"));b.attr("data-"+c.activeBreakPoint+"_dir",a)}},_gutterChange(a){if(a=h(a).data("value")){var b=h(".tb_element_cid_"+this.cid).first(),
d=c.Models.Registry.lookup(this.cid),e=d.get("gutter"),f=m.clone(b);b=b.find("."+this.type+"_inner").first();c.Utils.columnDrag(b,!1,e,a);b.removeClass(e).addClass(a);d.set({gutter:a},{silent:!0});c.undoManager.push(this.cid,f,h(".tb_element_cid_"+this.cid).first(),"row")}},gridMenu(a){var b=c.activeBreakPoint,d="desktop"===b,e=c.Models.Registry.lookup(this.cid),f=e.get(b+"_dir"),g=e.get("column_alignment"),l=e.get("column_h");e=e.get("gutter");var k=p.getElementsByClassName("tb_element_cid_"+this.cid)[0].getElementsByClassName(this.type+
"_inner")[0],m=!0===d?n:k.getAttribute("data-col_"+b),q=k.children,r=q.length,w=[];for(k=0;k<r;++k)w.push(c.Utils._getColClass(q[k].className.split(" ")));q="tb_rgrids"===a.id?a:h(a).find("#tb_rgrids")[0];for(k=6;-1<k;--k)q.classList.remove("col-count-"+k);q.classList.add("col-count-"+r);w="grid-layout-"+w.join("-");a=a.getElementsByClassName("tb_grid_"+b)[0];q=a.getElementsByClassName("tb_grid_list")[0].getElementsByTagName("li");m="-auto"!==m&&m?"grid-layout-"+m.replace(/column|tb_3col/ig,"").trim():
!1;!1!==d||!1!==m&&1!==r||(m=b+"-auto");for(k=q.length-1;-1<k;--k)!0===d&&q[k].classList.contains(w)||!1===d&&q[k].classList.contains(m)?q[k].classList.add("selected"):q[k].classList.remove("selected");if("ltr"!==f)for(q=a.getElementsByClassName("tb_column_direction")[0].getElementsByTagName("li"),k=q.length-1;-1<k;--k)q[k].getAttribute("data-dir")===f?q[k].classList.add("selected"):q[k].classList.remove("selected");if(!0===d){if("col_align_top"!==g||!0===C)for(b=a.getElementsByClassName("tb_column_alignment")[0].getElementsByTagName("li"),
k=b.length-1;-1<k;--k)b[k].getAttribute("data-alignment")===g?b[k].classList.add("selected"):b[k].classList.remove("selected");if("gutter-default"!==e)for(g=a.getElementsByClassName("tb_column_gutter")[0].getElementsByTagName("li"),k=g.length-1;-1<k;--k)g[k].getAttribute("data-value")===e?g[k].classList.add("selected"):g[k].classList.remove("selected");if(l)for(g=a.getElementsByClassName("tb_column_height")[0].getElementsByTagName("li"),k=g.length-1;-1<k;--k)g[k].getAttribute("data-value")==l?g[k].classList.add("selected"):
g[k].classList.remove("selected")}},setRowOptions(a){var b=null,d=c.activeModel,e=ThemifyConstructor.component,f=c.Models.Registry.lookup(this.cid),g=f.get("styling");g||(g={});null!==d&&(b="module"===c.activeModel.get("elType")?"mod_settings":"styling",b=c.activeModel.get(b));if(a.children[0]!==n)for(;a.firstChild;)a.removeChild(a.firstChild);ThemifyConstructor.values=g;ThemifyConstructor.component=this.type;c.activeModel=f;a.appendChild(ThemifyConstructor.create(ThemifyConstructor.data.row.setting.options.slice(0,
6)));ThemifyConstructor.values=b;c.activeModel=d;ThemifyConstructor.component=e},clear(){if(null!==this.type){this.cid=this.type=null;for(this.el.classList.remove("tb_show_toolbar");null!==this.el.firstChild;)this.el.removeChild(this.el.firstChild);if(null!==this.prevExpand&&this.prevExpand!==n){for(;null!==this.prevExpand.firstChild;)this.prevExpand.removeChild(this.prevExpand.firstChild);this.prevExpand.removeAttribute("id");this.prevExpand.closest(".tb_action_wrap").classList.remove("tb_clicked");
this.prevExpand=null}this.clearSelected();v.body[0].classList.remove("tb_action_active");v.body[0].classList.remove("tb_component_menu_active")}},clearSelected(){"visual"===c.mode&&c.EdgeDrag.clearEdges()},clearClicked(){for(var a=c.Instances.Builder[0].el.getElementsByClassName("tb_element_clicked"),b=a.length-1;-1<b;--b)a[b].classList.remove("tb_element_clicked")},setPosition(a,b){a.removeAttribute("data-top");var d=a.getBoundingClientRect(),e=d.width;d=d.height+40;var f="visual"===c.mode?x.pageYOffset:
c.toolbar.el.offsetTop+this.topH,g="visual"===c.mode?p.body:c.Instances.Builder[0].el,l=g.clientWidth;b=b.nodeType!==n?h(b).offset():b;b.right=b.bottom="";b.left-=parseFloat(e/2);b.top-=d;b.left+e>l?(b.left="auto",b.right=10):0>b.left&&(b.left=30);b.top>g.clientHeight?"visual"!==c.mode&&(b.top="auto",b.bottom=50):f>b.top&&(a.dataset.top=!0,b.top+=2*d-25,"visual"!==c.mode&&(b.top-=d/2));for(var k in b)a.style[k]="auto"!==b[k]&&""!==b[k]?b[k]+"px":b[k]}};c.Forms.register_validator=function(a,b){this.Validators[a]=
b};c.Forms.get_validator=function(a){return this.Validators[a]!==n?this.Validators[a]:this.Validators.not_empty};c.Forms.register_validator("email",function(a){var b=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;a=a.split(",");for(var c=a.length-1;-1<c;--c)if(!b.test(a[c]))return!1;return!0});c.Forms.register_validator("not_empty",function(a){return!(!a||""===a.trim())});c.GS={styles:{},initContent:!1,
loadingPosts:!1,allLoaded:!1,el:null,dropdown:null,isShown:null,field:null,isGSPage:p.body.classList.contains("gs_post"),activeGS:null,xhr:null,key:"global_styles",previousModel:null,liveInstance:null,init(){if(!0===this.isGSPage)if(r.document.body.classList.add("gs_post"),"visual"!==c.mode||!0===v.is_builder_loaded)this.openStylingPanel();else{var a=this;r.Themify.body.one("themify_builder_ready",function(b){a.openStylingPanel();a=null})}else null!==themifyBuilder.globalStyles&&(this.extend(this.styles,
themifyBuilder.globalStyles),themifyBuilder.globalStyles=null)},extend(a,b){for(var c in b)b[c]!==n&&(a[c]=b[c]);return a},openStylingPanel(){var a=function(){null===ThemifyConstructor.label&&(ThemifyConstructor.label=themifyBuilder.i18n.label);var b=themifyBuilder.globalStyleData.type;b=c.Models.Registry.lookup(c.Instances.Builder[c.builderIndex].el.getElementsByClassName(("row"===b||"column"===b||"subrow"===b?"module_":"module-")+b)[0].dataset.cid);b.set("styleClicked",{silent:!0});c.isPreview=
!1;b.trigger("edit",null);c.isPreview=!0;v.body.one("themify_builder_save_data",a)};a();c.toolbar.el.getElementsByClassName("tb_toolbar_builder_preview")[0].click()},setCss(a,b,d){"visual"===c.mode&&c.liveStylingInstance.setCss(a,b,d)},createCss(a,b,c){ThemifyStyles.GS={};return ThemifyStyles.createCss(a,b,c,this.styles)},findUsedItems(a){a=JSON.stringify(a);for(var b=/"global_styles":"(.*?)"/mg,c,e="";null!==(c=b.exec(a));)e+=" "+c[1].trim();e=e.trim();if(""!==e){e=h.unique(e.split(" "));a=[];for(b=
e.length-1;-1<b;--b)this.styles[e[b]]!==n&&a.push(e[b]);return a}return!1},globalStylesHTML(){if(!0===this.isGSPage||null!==this.activeGS)return!1;const a=p.createElement("div");var b=p.createElement("div");const d=p.createElement("span");this.isShown=null;this.field=ThemifyConstructor.hidden.render({id:c.GS.key,is_responsive:!1,value:ThemifyConstructor.values[c.GS.key],control:!1},ThemifyConstructor);a.className="tb_gs_container";if(this.field.value){let a=this.field.value.split(" "),b="";for(let c=
a.length-1;-1<c;--c)this.styles[a[c]]!==n&&(b+=" "+a[c]);b=b.trim();this.field.value=b}else this.field.value="";b.className="tb_gs_icon";b.addEventListener("click",function(a){if(a.target.classList.contains("tb_gs_icon")){const b=this.el;if(b.classList.contains("tb_gs_dropdown_opened"))a.stopPropagation(),b.classList.remove("tb_gs_dropdown_action","tb_gs_dropdown_opened");else{b.classList.add("tb_gs_dropdown_opened","tb_gs_dropdown_action");const a=function(d){null===b||b.contains(d.target)||(p.removeEventListener("click",
a,{passive:!0}),"visual"===c.mode&&r.document.removeEventListener("click",a,{passive:!0}),b.classList.remove("tb_gs_dropdown_action","tb_gs_dropdown_opened"))};p.addEventListener("mousedown",a,{passive:!0});"visual"===c.mode&&r.document.addEventListener("mousedown",a,{passive:!0})}}}.bind(this),{passive:!0});d.className="tb_gs_tooltip";d.textContent=themifyBuilder.i18n.gs;b.appendChild(c.Utils.getIcon("ti-brush-alt"));b.appendChild(d);a.appendChild(this.field);a.appendChild(b);this.el=a;""!==this.field.value&&
(b=this.stylingOverlay(),null!==b&&a.appendChild(b));a.addEventListener("click",this.initClickEvent.bind(this));this.initContent=!1;return this.el},initHTML(){var a=p.createElement("div"),b=this.field.value.trim();if(""!==b){b=b.split(" ");for(let c=0,e=b.length;c<e;++c)this.styles[b[c]]!==n&&a.appendChild(this.createSelectedItem(b[c]))}a.className="tb_gs_selected_styles";this.el.appendChild(a);a=this.el.getElementsByClassName("tb_gs_icon")[0];a.parentNode.insertBefore(p.getElementById("tmpl-global_styles").content.cloneNode(!0),
a.nextSibling);this.initContent=!0},createSelectedItem(a){const b=this.styles[a],d=p.createElement("div"),e=p.createElement("span"),f=p.createElement("span"),g=p.createElement("span");d.className="tb_selected_style";d.dataset.styleId=a;g.className="tb_gs_edit";g.appendChild(c.Utils.getIcon("ti-pencil"));d.appendChild(g);e.innerText=b.title;d.appendChild(e);f.className="tb_delete_gs tf_close";d.appendChild(f);return d},saveAs(){const a=this;m.LiteLightbox.prompt(themifyBuilder.i18n.enterGlobalStyleName,
function(b){if(null!==b){if(""===b)return alert(themifyBuilder.i18n.enterGlobalStyleName),a.saveAs(),!1;a.saveAsCallback(b)}})},saveAsCallback(a){ThemifyConstructor.setStylingValues(c.activeBreakPoint);let b=c.activeModel.get("elType");const d=this,e=c.Utils.clear(ThemifyConstructor.values);"module"===b&&(b=c.activeModel.get("mod_name"));delete e[this.key];h.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tb_save_as_new_global_style",tb_load_nonce:themifyBuilder.tb_load_nonce,
type:b,styles:e,title:a},beforeSend(){m.showLoader("show")},error(){m.showLoader("error")},success(a){m.showLoader("hide");"success"===a.status?(a=a.post_data,d.styles[a.class]=a,c.Utils.saveCss(c.Utils.clear(a.data),"",a.id),m.LiteLightbox.confirm(themifyBuilder.i18n.addSavedGS,function(b){if("yes"===b){d.isGSPage=!0;b=d.field.value;m.Lightbox.$lightbox[0].getElementsByClassName("reset-styling")[0].click();d.isGSPage=!1;b=a.class+" "+b;b=b.trim();d.field.value=b;b=b.split(" ");const e=d.el.getElementsByClassName("tb_gs_selected_styles")[0];
e.innerHTML="";for(let a=0,c=b.length;a<c;++a)e.appendChild(d.createSelectedItem(b[a]));c.GS.generateValues(null,b,!0);b=d.stylingOverlay();null!==b&&d.el.appendChild(b)}d.addItemToDropdown([a.class])},{buttons:{no:{label:ThemifyConstructor.label.no},yes:{label:ThemifyConstructor.label.y}}})):alert(a.msg)}})},delete(a){if(null!==this.field){c.hasChanged=!0;var b=this.el.querySelector('.global_style_item[data-style-id="'+a+'"]');const d=this.el.querySelector('.tb_selected_style[data-style-id="'+a+
'"]');null!==b&&b.classList.remove("selected");null!==d&&d.parentNode.removeChild(d);b=this.field.value.trim().split(" ");b.splice(b.indexOf(a),1);this.field.value=b=b.join(" ");null!==c.ActionBar.contextMenu&&c.ActionBar.contextMenu.contains(this.field)?c.ActionBar.rightClickGS(a,b,!0):this.generateValues(a,b.split(" "),!0);return!0}},insert(a){if(null!==this.field){c.hasChanged=!0;null!==this.dropdown&&this.dropdown.querySelector('.global_style_item[data-style-id="'+a+'"]').classList.add("selected");
this.el.getElementsByClassName("tb_gs_selected_styles")[0].appendChild(this.createSelectedItem(a));let d=this.field.value+" "+a;this.field.value=d=d.trim();if(""!==d){var b=this.stylingOverlay();null!==b&&(this.el.classList.add("tb_gs_dropdown_action"),this.el.appendChild(b))}null!==c.ActionBar.contextMenu&&c.ActionBar.contextMenu.contains(this.field)?c.ActionBar.rightClickGS(a,d):this.generateValues(a,d.split(" "))}},search(){const a=this;this.el.querySelector("#global-style-search").addEventListener("input",
function(b){const c=b.target.value.toUpperCase(),e=this.el,f=function(){const a=e.getElementsByClassName("tb_gs_list")[0].getElementsByClassName("global_style_item");for(let b=a.length-1;-1<b;--b){let d=a[b].getElementsByClassName("global_style_title")[0];d&&(a[b].style.display=-1<d.innerHTML.toUpperCase().indexOf(c)?"":"none")}};null!==a.xhr&&(a.xhr.abort(),a.xhr=null);a.allLoaded||setTimeout(function(){a.loadMore(c,f)},100);f()}.bind(this),{passive:!0})},addItemToDropdown(a){if(null!==this.dropdown){var b=
p.createDocumentFragment(),c=this.field.value.split(" "),e=this.dropdown.getElementsByClassName("tb_no_gs_item")[0];for(let d=0,e=a.length;d<e;++d){let e=this.styles[a[d]],f=p.createElement("div"),g=p.createElement("span"),h=p.createElement("span");f.className="global_style_item";f.className+=-1!==c.indexOf(a[d])?" selected":"";f.dataset.styleId=a[d];h.className="global_style_title";h.innerText=e.title;g.className="global_style_type";g.innerText=e.type;f.appendChild(h);f.appendChild(g);b.appendChild(f)}e.parentNode.insertBefore(b,
e)}},loadMore(a,b){const c=this,e=[];this.loadingPosts=!0;for(let a in this.styles)this.styles[a].id!==n&&e.push(this.styles[a].id);this.xhr=h.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{s:a,action:"tb_get_gs_posts",tb_load_nonce:themifyBuilder.tb_load_nonce,loaded:e},success(d){c.extend(c.styles,d);d=Object.keys(d);a||(c.allLoaded=10>d.length);c.addItemToDropdown(d);c.loadingPosts=!1;b&&b()}})},initDropdown(){this.dropdown=this.el.getElementsByClassName("tb_gs_list")[0];const a=
Object.keys(this.styles);this.addItemToDropdown(a);10>a.length&&!1===this.allLoaded&&this.loadMore();!1===this.allLoaded&&this.dropdown.addEventListener("scroll",this.onScroll.bind(this),{passive:!0});this.search()},initClickEvent(a){!0!==this.initContent&&this.initHTML();const b=a.target,c=b.classList;if("LABEL"===b.nodeName||c.contains("tb_open_gs"))return!0;"insert"===b.dataset.action?(a.preventDefault(),a.stopImmediatePropagation(),this.el.classList.remove("tb_gs_dropdown_action"),b.dataset.init===
n&&(this.initDropdown(),b.dataset.init=!0)):c.contains("global_style_title")?(a.preventDefault(),a.stopImmediatePropagation(),this.insert(b.parentElement.dataset.styleId)):c.contains("tb_delete_gs")?(a.preventDefault(),a.stopImmediatePropagation(),this.delete(b.parentElement.getAttribute("data-style-id"))):"save"===b.dataset.action?(a.preventDefault(),a.stopImmediatePropagation(),this.saveAs()):c.contains("tb_gs_edit")&&this.liveEdit(b.parentNode.dataset.styleId)},onScroll(a){!1===this.allLoaded&&
!1===this.loadingPosts&&(a=a.target,a=Math.max(a.scrollHeight-(a.scrollTop+a.offsetHeight),0),0<a&&200>=a&&(this.loadingPosts=!0,this.loadMore()))},updated(a,b,d,e){!1===this.isGSPage&&"visual"===c.mode&&"module"!==c.activeModel.get("elType")&&this.extraStyle(b,d,e)},setImport(a,b,c,e){if(!0!==e)for(let b in a)this.styles[b]!==n&&delete a[b];if(0<Object.keys(a).length){this.loadingPosts=!0;const d=this;m.showLoader("show");h.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{onlySave:e?
1:0,action:"tb_import_gs_posts_ajax",tb_load_nonce:themifyBuilder.tb_load_nonce,data:JSON.stringify(a)},error(){m.showLoader("error")},success(a){d.loadingPosts=!1;if(a)for(let b in a)d.styles[b]=a[b];b&&b(c);m.showLoader("hide")}})}else b&&b(c)},generateValues(a,b,d){if(!0!==this.isGSPage&&"visual"===c.mode){var e=c.activeModel.get("elType");"module"===e&&(e=c.activeModel.get("mod_name"));var f=c.activeModel.get("element_id");f={styling:ThemifyStyles.generateGSstyles(b,e,this.styles),element_id:f};
ThemifyStyles.disableNestedSel=!0;null===this.liveInstance&&(this.liveInstance=c.createStyleInstance(),this.liveInstance.init(!0,!0));e=this.createCss([f],e);var g=this.liveInstance,h=[],k=c.activeBreakPoint,m=g.prefix,q=new RegExp(m,"g");ThemifyStyles.disableNestedSel=null;if(!0===d){d=ThemifyConstructor.breakpointsReverse;for(var n=d.length-1;-1<n;--n){c.activeBreakPoint=d[n];g.setMode(d[n],!0);var p=g.currentSheet;p=p.cssRules?p.cssRules:p.rules;for(var r=p.length-1;-1<r;--r)if(-1!==p[r].selectorText.indexOf(m)){let a=
p[r].selectorText.replace(/,\s+/g,",").replace(q,"").split(","),b=p[r].cssText.split("{")[1].split(";");if(-1!==a[0].indexOf(".tb_text_wrap"))for(var v=a.length-1;0<v;--v)-1!==a[v].indexOf(".tb_text_wrap")&&a.splice(v,1);for(v=b.length-2;-1<v;--v)g.setLiveStyle(b[v].trim().split(": ")[0].trim(),"",a)}}}delete e.gs;for(let a in e)if("fonts"===a||"cf_fonts"===a)for(let b in e[a])m=b,0<e[a][b].length&&(m+=":"+e[a][b].join(",")),h.push(m);else{c.activeBreakPoint=a;g.setMode(a,!0);for(let b in e[a]){m=
b.replace(/,\s+/g,",").replace(q,"").split(",");for(let c=0,f=e[a][b].length;c<f;++c)for(d=e[a][b][c].split(";"),n=d.length-2;-1<n;--n)""!==d[n]&&(p=d[n].split(":")[0],r=d[n].replace(p+":","").trim(),"background-image"===p&&-1!==d[n].indexOf("svg")&&-1!==d[n].indexOf("data:")&&(r+=";"+d[n+1]),g.setLiveStyle(p,r,m))}}0<h.length&&ThemifyConstructor.font_select.loadGoogleFonts(h.join("|"));c.activeBreakPoint=k;this.updated(a,e,f,b);this.liveInstance=null}},extraStyle(a,b,d){var e=null!==this.liveInstance?
this.liveInstance:c.liveStylingInstance,f=e.prefix.length-1,g=0!==e.getComponentBgOverlay().length;d=e.$liveStyledElmt;var h=g,k={top:!1,bottom:!1,left:!1,right:!1},m=0;a:for(var q in a)if("fonts"!==q&&"cf_fonts"!==q&&"gs"!==q)for(let b in a[q]){!1===h&&(h=-1!==b.indexOf("builder_row_cover",f));if(-1!==b.indexOf("tb_row_frame",f))for(let a in k)if(!1===k[a]&&-1!==b.indexOf("tb_row_frame_"+a,f)){k[a]=!0;++m;break}if(!0===h&&4===m)break a}!1===g&&!0===h&&e.addOrRemoveComponentOverlay();if(0<m){a=p.createDocumentFragment();
for(var r in k)!0===k[r]&&0===d.children(".tb_row_frame_"+r).length&&(q=p.createElement("div"),q.className="tf_abs tb_row_frame tb_row_frame_"+r,a.appendChild(q));d.children(".tb_action_wrap").after(a)}(r=b.styling!==n?b.styling.background_type:"none")||(r="image");"image"===r&&"builder-parallax-scrolling"===b.styling.background_repeat&&b.styling.background_image?(d[0].classList.add("builder-parallax-scrolling"),ThemifyBuilderModuleJs.backgroundScrolling(d)):(d[0].classList.remove("builder-parallax-scrolling"),
d[0].style.backgroundPosition="","image"===r&&"builder-zoom-scrolling"===b.styling.background_repeat&&b.styling.background_image?(d[0].classList.add("builder-zoom-scrolling"),ThemifyBuilderModuleJs.backgroundZoom(d)):(d[0].classList.remove("builder-zoom-scrolling"),d[0].style.backgroundSize=""))},liveEdit(a){var b={styleClicked:!0},d=!1;if(null===c.activeModel&&null!==c.ActionBar.contextMenu&&c.ActionBar.contextMenu.contains(this.field)){var e=c.Instances.Builder[c.builderIndex].el.getElementsByClassName("tb_element_clicked")[0];
if(e===n)return;c.activeModel=c.Models.Registry.lookup(e.getAttribute("data-cid"));b.element_id=c.activeModel.get("element_id");this.previousModel=c.activeModel.cid;d=!0;c.Utils.scrollToDropped(e)}else null!==c.activeModel&&(this.previousModel=c.activeModel.cid,b.element_id=c.activeModel.get("element_id"),ThemifyConstructor.saveComponent(!0));var f=this.styles[a],g=this,l=ThemifyConstructor.label.done,k="visual"===c.mode?h.extend(!0,{},c.liveStylingInstance):null;e=h.extend(!0,{},f.data[0]);var r=
f.type;this.activeGS=a;if("row"===r){delete e.cols;delete e.styling[this.key];var q=c.Views.init_row(e)}else"subrow"===r?(delete e.cols,delete e.styling[this.key],q=c.Views.init_subrow(e)):(delete e.styling,"column"===r?(delete e.cols[0].modules,delete e.cols[0].styling[this.key],q=c.Views.init_column(e.cols[0])):(delete e.cols[0].styling,delete e.cols[0].modules[0].mod_settings[this.key],q=c.Views.init_module(e.cols[0].modules[0])));m.Lightbox.$lightbox[0].className+=" gs_post";ThemifyConstructor.label.done=
ThemifyConstructor.label.s_s;c.ActionBar.hideContextMenu();m.Lightbox.$lightbox.one("themify_opened_lightbox.tb_gs_edit",function(){this.getElementsByClassName("current")[0].getElementsByClassName("tb_tooltip")[0].textContent=ThemifyConstructor.label.g_s+" - "+f.title});q.model.set(b,{silent:!0});q.model.trigger("edit",null);const t=function(a){v.body.off("themify_builder_lightbox_close.tb_gs_edit themify_builder_save_component.tb_gs_edit");m.Lightbox.$lightbox[0].classList.remove("gs_post");ThemifyConstructor.label.done=
l;q.model.destroy();"visual"===c.mode&&(k.prefix&&(c.liveStylingInstance=k,c.liveStylingInstance.$liveStyledElmt=h(p.querySelector(k.prefix)),null===g.previousModel||"row"!==r&&"column"!==r&&"subrow"!==r||(a=c.Models.Registry.lookup(g.previousModel))&&"module"===a.get("elType")&&(c.liveStylingInstance.getComponentBgOverlay().remove(),c.liveStylingInstance.removeBgSlider(),c.liveStylingInstance.removeBgVideo(),c.liveStylingInstance.$liveStyledElmt.children(".tb_row_frame").remove(),c.liveStylingInstance.$liveStyledElmt[0].classList.remove("builder-zoom-scrolling",
"builder-zooming"))),k=g.liveInstance=null);g.activeGS=null};v.body.one("themify_builder_lightbox_close.tb_gs_edit",function(a){t();d?g.previousModel=null:g.reopenPreviousPanel()}).one("themify_builder_save_component.tb_gs_edit",function(a,b){a=g.activeGS;const e=g.styles[a],f=g.previousModel;delete ThemifyConstructor.values.cid;ThemifyConstructor.setStylingValues(c.activeBreakPoint);var k=ThemifyConstructor.values;const l=c.activeModel;delete k[this.key];"row"===r||"subrow"===r?(e.data[0].styling=
k,delete e.data[0].cols):(delete e.data[0].styling,delete e.data[0].cols[0].grid_class,"column"===r?(delete e.data[0].cols[0].modules,e.data[0].cols[0].styling=k):(delete e.data[0].cols[0].styling,e.data[0].cols[0].modules[0].mod_settings=k));m.showLoader("show");c.Utils.saveCss(e.data,"",e.id);e.data=c.Utils.clear(e.data);g.styles[a].data=e.data;g.activeGS=null;g.previousModel=null;if("visual"===c.mode&&c.hasChanged){k=c.Models.Registry.items;for(let b in k){let d="module"===k[b].get("elType")?k[b].get("mod_settings"):
k[b].get("styling");d[g.key]!==n&&""!==d[g.key]&&-1!==d[g.key].indexOf(a)&&(c.activeModel=k[b],g.generateValues(a,d[g.key].split(" "),!0))}g.liveInstance=null}c.activeModel=l;g.previousModel=f;t(!0);c.hasChanged=!1;h.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tb_update_global_style",tb_load_nonce:themifyBuilder.tb_load_nonce,data:e.data,id:e.id},error(){m.showLoader("error")},success(){b||d?g.previousModel=null:g.reopenPreviousPanel();m.showLoader("hide")}})})},reopenPreviousPanel(a){n!==
a?a.model.trigger("edit",a.e,a.target):null!==this.previousModel&&(a=c.Models.Registry.lookup(this.previousModel),null!==a&&(a.set({styleClicked:!0},{silent:!0}),a.trigger("edit",null)),this.previousModel=null)},stylingOverlay(){if(null===this.isShown&&null!==c.activeModel&&(null===this.el.parentNode||!this.el.parentNode.classList.contains("tb_inline_gs_show"))){this.isShown=!0;const a=p.createElement("div"),b=p.createElement("p");a.className="tb_gs_options_overlay";b.textContent=themifyBuilder.i18n.has_gs;
a.addEventListener("click",function(a){a.preventDefault();a.stopPropagation();this.parentNode.removeChild(this)},{once:!0});a.appendChild(b);return a}return null}}})(jQuery,Backbone,Themify,window,window.top,document,ThemifyBuilderCommon,void 0);
