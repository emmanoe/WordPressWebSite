'use strict';(function(e,g,x){e.ThemifyGradient=function(n,A){const y={gradient:e.ThemifyGradient.default,width:173,height:15,point:8,angle:180,circle:!1,type:"linear",onChange(){},onInit(){}},t=e(n);let m,l,p,u,v,w,q,d=[];this.initSwatchesFlag=this.isInit=!1;this.settings={};this.__constructor=function(){this.settings=e.extend({},y,A);this.update();this.settings.onInit();this.isInit=!0;return this};this.updateSettings=function(a){this.settings=e.extend({},y,a);this.update();return this};this.update=
function(){this._setupPoints();this._setup();this._render()};this.getCSSvalue=function(){const a=[],b="radial"===this.settings.type?this.settings.circle?"circle,":"":this.settings.angle+"deg,";for(let b=0,h=d.length;b<h;++b)a.push(d[b][1]+" "+d[b][0]);return this.settings.type+"-gradient("+b+a.join(", ")+")"};this.getString=function(){let a="";for(let b=0,c=d.length;b<c;++b)a+=d[b][0]+" "+d[b][1]+"|";return a.substr(0,a.length-1)};this.setType=function(a){this.settings.type=a;this.settings.onChange(this.getString(),
this.getCSSvalue())};this.setAngle=function(a){this.settings.angle=a;this.settings.onChange(this.getString(),this.getCSSvalue())};this.setRadialCircle=function(a){this.settings.circle=a;this.settings.onChange(this.getString(),this.getCSSvalue())};this._setupPoints=function(){d=[];d=e.isArray(this.settings.gradient)?this.settings.gradient:this._getGradientFromString(this.settings.gradient)};this._setup=function(){const a=this,b=g.createDocumentFragment(),c=g.createElement("div"),h=g.createElement("div"),
f=g.createElement("span"),k=g.createElement("span"),z=g.createElement("div"),q=g.createElement("div");v=g.createElement("a");p=g.createElement("div");u=g.createElement("input");m=g.createElement("div");l=g.createElement("div");let r=g.createElement("canvas");c.className="themifyGradient tf_rel";r.width=this.settings.width;r.height=this.settings.height;m.style.width=this.settings.width+Math.round(this.settings.point/2+1)+"px";m.className="points";p.className="point-color";f.className="gradient_delimiter";
k.className="gradient_percent";k.innerHTML="%";u.type="text";u.className="point-position";v.className="gradient-point-delete tf_close";v.href="#";h.className="gradient-pointer-info";l.className="content";z.style.backgroundColor="#00ff00";q.className="gradient-pointer-arrow";p.appendChild(z);h.appendChild(q);l.appendChild(p);l.appendChild(f);l.appendChild(u);l.appendChild(k);l.appendChild(v);b.appendChild(m);b.appendChild(r);h.appendChild(l);b.appendChild(h);for(c.appendChild(b);n.firstChild;)n.removeChild(n.firstChild);
n.appendChild(c);this.initSwatchesFlag||(n.parentNode.appendChild(this.swatchesHTML()),this.initSwatches(),this.initSwatchesFlag=!0);l=e(l);p=e(p);u=e(u);v=e(v);m=e(m);w=r.getContext("2d");r=e(r);r.off("click").on("click",function(b){const c=r.offset();let f="rgba(0,0,0, 1)",h=999999999999;b=b.pageX-c.left;b=Math.round(100*b/a.settings.width);for(let a=0,c=d.length;a<c;++a)d[a][0]=parseInt(d[a][0]),d[a][0]<b&&b-d[a][0]<h?(h=b-d[a][0],f=d[a][1]):d[a][0]>b&&d[a][0]-b<h&&(h=d[a][0]-b,f=d[a][1]);d.push([b+
"%",f]);d.sort(a._sortByPosition);a._render();for(let c=0,f=d.length;c<f;++c)d[c][0]===b+"%"&&a._selectPoint(m.find(".point:eq("+c+")"));"visual"===x.mode&&setTimeout(a._colorPickerPosition,315)});this.pointEvents();t[0].addEventListener("keyup",function(b){const c=b.keyCode||b.which||0;8!==c&&46!==c||"INPUT"===window.top.document.activeElement.tagName||(p.siblings(".point-position").focus(),a.removePoint(b))},{passive:!1})};this.pointEvents=function(){const a=this,b=n.getElementsByClassName("point-position"),
c=function(b){let c=parseInt(e.trim(this.value));isNaN(c)?c=0:0>c?c=Math.abs(c):98<=c&&(c=98);"focusout"!==b.type?(c=Math.round(c*a.settings.width/100),e(this).closest(".themifyGradient").find(".themify_current_point").css("left",c),a._renderCanvas()):this.value=c};for(let a=b.length-1;-1<a;--a)b[a].addEventListener("focusout",c,{passive:!0}),b[a].addEventListener("keyup",c,{passive:!0})};this._render=function(){this._initGradientPoints();this._renderCanvas()};this._colorPickerPosition=function(){const a=
ThemifyBuilderCommon.Lightbox.$lightbox,b=l.find(".minicolors"),c=b.find(".minicolors-panel");0<c.length&&(a.offset().left+a.width()<=c.offset().left+c.width()?b.addClass("tb_minicolors_right"):b.removeClass("tb_minicolors_right"))};this._initGradientPoints=function(){const a=this;var b=g.createDocumentFragment();const c=[],h=function(){a._selectPoint(this);"visual"===x.mode&&(a._colorPickerPosition(),e(g).trigger("mouseup"))};for(;m[0].firstChild;)m[0].removeChild(m[0].firstChild);for(let f=0,k=
d.length;f<k;++f){let k=g.createElement("div");k.className="point";k.style.backgroundColor=d[f][1];k.style.left=parseInt(d[f][0])*a.settings.width/100+"px";k.removeEventListener("click",h,{passive:!0});k.addEventListener("click",h,{passive:!0});b.appendChild(k);c[f]=k}m[0].appendChild(b);for(b=c.length-1;-1<b;--b)e(c[b]).draggable({axis:"x",containment:"parent",start(a,b){t.addClass("tb_gradient_drag").focus()},stop(a,b){t.removeClass("tb_gradient_drag").focus();"visual"===x.mode&&e(g).trigger("mouseup")},
drag(b,c){a._selectPoint(this,!0);a._renderCanvas()}})};this.hexToRgb=function(a){a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,c,h,f){return c+c+h+h+f+f});return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null};this._selectPoint=function(a,b){const c=this;q=e(a);a=parseInt(q.css("left"));u.val(Math.round(a/this.settings.width*100));a-=30;0>a&&window.top.document.body.classList.contains("tb_module_panel_docked")&&
(a=3);t.find(".gradient-pointer-info").css("marginLeft",a+"px");if(b)return!1;t.focus();q.addClass("themify_current_point").siblings().removeClass("themify_current_point");a=q.css("backgroundColor");b=a.substr(4,a.length);b=b.substr(0,b.length-1);t.find(".point-color .minicolors").remove();b=p.find(".themify-color-picker");0===b.length&&(b=e('<input type="text" class="themify-color-picker" />'),b.appendTo(p).minicolors({opacity:!0,changeDelay:10,change(a,b){a=c.hexToRgb(a);a||(a={r:255,g:255,b:255},
b=1);q.css("backgroundColor","rgba("+a.r+","+a.g+","+a.b+","+b+")");c._renderCanvas()}}),t.find(".minicolors").first().addClass("minicolors-focus"),v.off("click").on("click",this.removePoint.bind(this)));a=a.replace(/^rgba?\(|\s+|\)$/g,"").split(",");let h=4===a.length?a.pop():1;a=this._rgbToHex(a);b.val(a).attr("data-opacity",h).data("opacity",h).minicolors("settings",{value:a})};this._renderCanvas=function(){const a=n.getElementsByClassName("point");d=[];for(let b=0,c=a.length;b<c;++b){let c=Math.round(parseInt(a[b].style.left)/
this.settings.width*100);d.push([c+"%",a[b].style.backgroundColor])}d.sort(this._sortByPosition);this._renderToCanvas();if(this.isInit)this.settings.onChange(this.getString(),this.getCSSvalue())};this._renderToCanvas=function(){const a=w.createLinearGradient(0,0,this.settings.width,0);for(let b=0,c=d.length;b<c;++b)a.addColorStop(parseInt(d[b][0])/100,d[b][1]);w.clearRect(0,0,this.settings.width,this.settings.height);w.fillStyle=a;w.fillRect(0,0,this.settings.width,this.settings.height)};this._getGradientFromString=
function(a){const b=[];a=a.split("|");for(let d=0,f=a.length;d<f;++d){var c=void 0;let f=a[d];c=f.indexOf("%");let h=f.substr(c-3,c);"100"===h||"100%"===h?c="100%":(c=1<c?parseInt(f.substr(c-2,c)):parseInt(f.substr(c-1,c)),c+="%");b.push([c,f.replace(c,"")])}return b};this._rgbToHex=function(a){function b(a){a=parseInt(a,10);if(isNaN(a))return"00";a=Math.max(0,Math.min(a,255));return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)}const c=a[1],d=a[2];return"#"+b(a[0])+b(c)+b(d)};
this._sortByPosition=function(a,b){a=parseInt(a[0]);b=parseInt(b[0]);return a<b?-1:a>b?1:0};this.removePoint=function(a){a.preventDefault();if(1<d.length){d.splice(q.index(),1);const a=l[0].parentNode;a.style.display="none";setTimeout(function(){a.style.display=""},50);this._render()}};this.swatchesHTML=function(){const a=g.createDocumentFragment(),b=g.createElement("div"),c=g.createElement("ul"),d=themifyColorManager.makeImportExportDropdown(),f=g.createElement("a");f.className="tb_gradient_add_swatch tf_plus_icon";
let e=g.createElement("span");e.className="themify_tooltip";e.innerText=ThemifyConstructor.label.save_gradient;f.appendChild(e);f.href="#";f.addEventListener("click",this.saveSwatch.bind(this));b.className="tb_cm_dropdown_icon";b.tabIndex=1;e=g.createElement("span");e.className="themify_tooltip";e.innerText=ThemifyConstructor.label.ie_gradient;b.appendChild(e);d.addEventListener("click",this.swatchesDropdownClicked.bind(this));b.appendChild(x.Utils.getIcon("ti-import"));b.appendChild(d);c.className=
"tb_gradient_swatches";c.addEventListener("click",this.swatchClicked.bind(this));a.appendChild(f);a.appendChild(b);a.appendChild(c);return a};this.swatchesDropdownClicked=function(a){a.preventDefault();a.stopPropagation();a=a.target;const b=a.classList;b.contains("tb_cm_export")?(a.parentNode.parentNode.parentNode.blur(),g.location.assign(themifyCM.exportGradientsURL)):b.contains("tb_cm_import")&&(a.parentNode.parentNode.parentNode.blur(),themifyColorManager.importColors("gradients"))};this.saveSwatch=
function(){if(""===this.getString()||""===this.getCSSvalue())return!1;var a=Object.keys(themifyCM.gradients),b=this.getCSSvalue();for(let c=a.length-1;-1<c;--c)if(themifyCM.gradients[a[c]].css===b)return null;a=themifyColorManager.UID();b={id:a,setting:JSON.parse(JSON.stringify(this.settings)),gradient:this.getString(),css:b,points:d};themifyCM.gradients[a]=b;this.addSwatch(b);themifyColorManager.updateColorSwatches("gradients")};this.addSwatch=function(a,b){const c=g.createElement("li"),d=g.createElement("span");
c.className="tb_gradient_swatch";c.style.background=a.css;c.dataset.id=a.id;d.className="tb_delete_swatch tf_close";c.appendChild(d);if(b)a=n.parentElement.getElementsByClassName("tb_gradient_swatches")[0],a.insertBefore(c,a.firstChild);else{a=ThemifyBuilderCommon.Lightbox.$lightbox[0].getElementsByClassName("tb_gradient_swatches");for(let b=0,d=a.length;b<d;++b)a[b].insertBefore(c.cloneNode(!0),a[b].firstChild)}};this.swatchClicked=function(a){a.preventDefault();a=a.target;const b=a.classList;b.contains("tb_gradient_swatch")?
this.selectSwatch(a.dataset.id):b.contains("tb_delete_swatch")&&(this.removeSwatch(a.parentNode.dataset.id),themifyColorManager.updateColorSwatches("gradients"))};this.removeSwatch=function(a){const b=ThemifyBuilderCommon.Lightbox.$lightbox[0].querySelectorAll('.tb_gradient_swatch[data-id="'+a+'"]');for(let a=b.length-1;-1<a;--a)b[a].parentNode.removeChild(b[a]);delete themifyCM.gradients[a]};this.selectSwatch=function(a){a=themifyCM.gradients[a];this.setAngle(a.setting.angle);this.setRadialCircle(a.setting.circle);
this.setType(a.setting.type);this.settings.gradient=a.gradient;this.update();var b=n.parentElement;const c=b.getElementsByClassName("themify-gradient-type")[0],d=b.querySelector('input[type="checkbox"]');b=b.getElementsByClassName("themify-gradient-angle")[0];c.value=a.setting.type;Themify.triggerEvent(c,"change");d.checked=a.setting.circle;Themify.triggerEvent(d,"change");b.value=a.setting.angle;Themify.triggerEvent(b,"change")};this.initSwatches=function(){const a=Object.keys(themifyCM.gradients);
themifyCM.gradients=a.length?themifyCM.gradients:{};for(let b=0,c=a.length;b<c;b++)this.addSwatch(themifyCM.gradients[a[b]],!0)};return this.__constructor()};e.ThemifyGradient.default="0% rgba(0,0,0, 1)|100% rgba(255,255,255,1)";e.fn.ThemifyGradient=function(g){return this.each(function(){void 0===e(this).data("themifyGradient")&&e(this).data("themifyGradient",new e.ThemifyGradient(this,g))})}})(jQuery,document,tb_app);
