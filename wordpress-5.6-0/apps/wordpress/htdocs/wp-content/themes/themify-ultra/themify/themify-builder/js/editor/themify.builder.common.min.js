'use strict';var ThemifyBuilderCommon;
(function(g,h,f,k){window.top!==window.self&&(window.wp.shortcode=window.top.wp.shortcode,jQuery.ui=window.top.jQuery.ui,jQuery.fn.mouse=window.top.jQuery(window.top.document).mouse,jQuery.fn.sortable=window.top.jQuery(window.top.document).sortable);ThemifyBuilderCommon={loader:null,showLoader(a){null===this.loader&&(this.loader=g(f.document.getElementById("tb_alert")));"show"===a?(this.loader[0].classList.add("tb_busy"),this.loader[0].style.display="block"):"spinhide"===a?this.loader.fadeOut(300,
function(){this.classList.remove("tb_busy")}):("error"!==a&&(a="done"),this.loader[0].classList.remove("tb_busy"),this.loader[0].classList.add("tb_"+a),this.loader.delay(500).fadeOut(500,function(){this.classList.remove("tb_"+a)}))},clone(a){if(null===a)return a;void 0!==a[0]&&(a=a[0]);a=a.cloneNode(!0);g(a).find("#tb_component_bar").empty().attr("id","").closest(".tb_clicked").removeClass("tb_clicked");if("visual"===tb_app.mode){var b=a.getElementsByTagName("video");if(0<b.length){const d=a.getElementsByClassName("big-video-wrap");
for(let a=b.length-1;-1<a;--a)b[a].pause();for(b=d.length-1;-1<b;--b)d[b]&&d[b].parentNode.removeChild(d[b])}}return g(a)},Clipboard:{key:"themify_builder_clipboard_",set(a,b){const d={};d[a]=b;localStorage.setItem(this.key+"content",JSON.stringify(d))},get(a){const b=JSON.parse(localStorage.getItem(this.key+"content"));return void 0!==b[a]?b[a]:!1}},alertWrongPaste(){alert(themifyBuilder.i18n.text_alert_wrong_paste)},autoComplete(a){var b=g(".themify_tax_autocomplete",a);if(0<b.length){var d=[];
b.each(function(){var a=g(this),b=a.closest(".tb_input").find("input.query_category_multiple"),f=b.val();g(this).autocomplete({minLength:2,source(b,c){b=g.trim(b.term);g.getJSON(themifyBuilder.ajaxurl,{term:g.trim(b),tax:a.data("tax"),action:a.data("action")},function(a,b,d){c(a)})},select(a,c){b.val(c.item.value);this.value=c.item.label;return!1}}).focus(function(){g(this).autocomplete("search");return!1});if(f&&"undefined"!==f){var e={};e[a.data("tax")]=f;d.push(e)}else b.val("")});0<d.length&&
g.ajax({url:themifyBuilder.ajaxurl,type:"POST",dataType:"json",data:{data:d,action:"themify_builder_get_tax_data"},success(b){if(b)for(var c in b)g("#themify_search_cat_"+b[c].tax,a).val(b[c].val)}})}},Lightbox:{$lightbox:null,lightboxStorageKey:f.document!==k?"themify_builder_lightbox_frontend_pos_size":"themify_builder_lightbox_backend_pos_size",setup(){const a=ThemifyBuilderCommon;f.document.body.appendChild(k.getElementById("tmpl-builder_lightbox").content);this.$lightbox=g("#tb_lightbox_parent",
f.document);a.LiteLightbox.modal=new wp.media.view.Modal({controller:{trigger(){}}});a.LiteLightbox.modal.on("attach",function(){this.el.classList.add("tb_lite_lightbox_modal")});this.bindEvents()},bindEvents(){const a=this;a.responsiveTabs();a.$lightbox.one("themify_opened_lightbox",function(){a.resizable.init();"visual"===tb_app.mode&&a.$lightbox[0].getElementsByClassName("builder_cancel_docked_mode")[0].addEventListener("click",function(a){a.preventDefault();a.stopPropagation();f.document.body.classList.add("themify_lightbox_drag");
ThemifyBuilderCommon.Lightbox.dockMode.close();g(k).triggerHandler("mouseup");setTimeout(function(){f.document.body.classList.remove("themify_lightbox_drag")},300)});a.$lightbox[0].getElementsByClassName("tb_close_lightbox")[0].addEventListener("click",function(){a.close()},{passive:!0})});themifyBuilder.disableShortcuts||a.controlByKeyInput()},getLightboxStorage(){const a=localStorage.getItem(this.lightboxStorageKey);return a?JSON.parse(a):{}},updateLightboxStorage(a){localStorage.setItem(this.lightboxStorageKey,
JSON.stringify(_.extend(this.getLightboxStorage(),a)))},resizable:{$el:null,w:"",h:"",x:"",y:"",axis:"",overlay:!1,minWidth:350,maxWidth:880,minHeight:320,maxHeight:.9*f.document.documentElement.clientHeight,update:!0,init(){const a=this,b=ThemifyBuilderCommon.Lightbox,d=f.document.body.classList;var c=function(c,f){if(void 0!==f&&c&&c.target.classList.contains("builder-lightbox"))switch(c.type){case "dragstart":b.dockMode.get()&&!d.contains("tb_standalone_lightbox")&&null===c.originalEvent.target.closest("li")&&
a.$el[0].getElementsByClassName("builder_cancel_docked_mode")[0].click();d.add("themify_lightbox_drag");k.body.classList.add("tb_start_animate");b.fixContainment();break;case "dragstop":d.remove("themify_lightbox_drag"),k.body.classList.remove("tb_start_animate"),b.fixContainment(),a.remember(),"visual"===tb_app.mode&&g(k).triggerHandler("mouseup");case "drag":b.dockMode.drag(c,f)}};this.$el=b.$lightbox;a.$el.draggable({handle:a.$el.find(".tb_lightbox_top_bar,.tb_action_breadcrumb"),scroll:!1,cancel:".tb_options_tab,.tb_lightbox_actions",
start:c,drag:c,stop:c});c=this.$el[0].getElementsByClassName("tb_resizable");for(let b=c.length-1;-1<b;--b)c[b].addEventListener("mousedown",function(b){1===b.which&&(b.preventDefault(),a.maxHeight=.9*f.document.documentElement.clientHeight,a.x=b.clientX,a.y=b.clientY,a.w=parseInt(a.$el.outerWidth(),10),a.h=parseInt(a.$el.outerHeight(),10),a.axis=this.dataset.axis,a.$el[0].classList.add("tb_resizing"),f.document.addEventListener("mousemove",a.resize,{passive:!0}),f.document.addEventListener("mouseup",
a.stop,{passive:!0}),d.add("tb_start_animate"),h.body.addClass("tb_start_animate"),f.document.body.classList.add("tb_panel_resize"),"se"!==a.axis&&"x"!==a.axis&&"sw"!==a.axis&&"ne"!==a.axis&&"nw"!==a.axis||a.setupLightboxSizeClass())},!1);a.setupLightboxSizeClass()},remember(){if(!f.document.body.classList.contains("tb_standalone_lightbox")){var a=ThemifyBuilderCommon.Lightbox.resizable,b=a.$el.position();a={top:b.top,left:b.left,width:a.$el.outerWidth(),height:a.$el.outerHeight()};ThemifyBuilderCommon.Lightbox.updateLightboxStorage(a);
h.body.triggerHandler("themify_builder_resize_lightbox")}},setupLightboxSizeClass(a){var b=ThemifyBuilderCommon.Lightbox.resizable;null!==b.$el&&(a||(a=parseInt(b.$el.width())),b=b.$el[0].classList,750<a?b.add("larger-lightbox"):b.remove("larger-lightbox"),540>a?b.add("tb_lightbox_small"):b.remove("tb_lightbox_small"))},resize(a){const b=ThemifyBuilderCommon.Lightbox.resizable;if("w"===b.axis){if(a=b.x+b.w-a.clientX,a>b.maxWidth&&(a=b.maxWidth),a>=b.minWidth&&a<=b.maxWidth){var d=b.$el[0].style.width;
b.$el[0].style.width=a+"px";b.$el[0].style.left=parseInt(b.$el[0].style.left)+parseInt(d)-a+"px";b.setupLightboxSizeClass(a)}}else{var c="-y"===b.axis||"ne"===b.axis||"nw"===b.axis?b.y+b.h-a.clientY:b.h+a.clientY-b.y;a="sw"===b.axis||"nw"===b.axis?b.x+b.w-a.clientX:b.w+a.clientX-b.x;a>b.maxWidth&&(a=b.maxWidth);if(("se"===b.axis||"x"===b.axis||"sw"===b.axis||"nw"===b.axis||"ne"===b.axis)&&a>=b.minWidth&&a<=b.maxWidth){d=b.$el[0].style.width;b.$el[0].style.width=a+"px";if("sw"===b.axis||"nw"===b.axis)b.$el[0].style.left=
parseInt(b.$el[0].style.left)+parseInt(d)-a+"px";b.setupLightboxSizeClass(a)}if(("se"===b.axis||"y"===b.axis||"-y"===b.axis||"sw"===b.axis||"nw"===b.axis||"ne"===b.axis)&&c>=b.minHeight&&c<=b.maxHeight){if("-y"===b.axis||"nw"===b.axis||"ne"===b.axis)b.$el[0].style.top=parseInt(b.$el[0].style.top)+parseInt(b.$el[0].style.height)-c+"px";b.$el[0].style.height=c+"px"}}h.body.triggerHandler("themify_builder_resize_lightbox")},stop(a){a=ThemifyBuilderCommon.Lightbox;const b=a.resizable;b.$el.removeClass("tb_resizing");
f.document.removeEventListener("mousemove",b.resize,{passive:!0});f.document.removeEventListener("mouseup",b.stop);a.fixContainment();b.remember();a=g("body",f.document);a=a.add("body");a.removeClass("tb_start_animate");f.document.body.classList.remove("tb_panel_resize");"visual"===tb_app.mode&&g(k).triggerHandler("mouseup");tb_app.ActionBar.disable=!0;setTimeout(function(){tb_app.ActionBar.disable=null},7)}},fixContainment(){const a=ThemifyBuilderCommon.Lightbox,b=a.$lightbox.outerWidth();var d=
g(f);const c=d.width()-20;d=d.height()-30;var m=a.$lightbox.position();const l=m.left;m=m.top;let e={};0>l?e.left=20:l+b>c&&(e.left=c-b);0>m?e.top=0:m>d&&(e.top=d);for(var q in e)a.$lightbox[0].style[q]=e[q]+"px"},setStandAlone(a,b,d){var c=this.$lightbox.outerWidth(),g=this.$lightbox.outerHeight(),l=f.document.documentElement.clientWidth,e=f.document.documentElement.clientHeight;d||"visual"!==tb_app.mode||(this.dockMode.get()&&(tb_app.toolbar.$el.find(".tb_toolbar_add_modules").click(),f.document.body.classList.contains("tb_panel_minimized")||
("desktop"!==tb_app.activeBreakPoint?a+=this.dockMode.isLeft?150:-150:this.dockMode.isLeft&&(a+=300))),"desktop"!==tb_app.activeBreakPoint&&(a+=(l-tb_app.iframe.width())/2+8));a-=c/2;5>=a?a=5:a+c>l&&(a=l-c-20);b+=50;b+g>e&&(b=e-g-5);0>b&&(b=5);this.$lightbox.css({left:a,top:b}).one("themify_opened_lightbox",function(){tb_app.Utils.addViewPortClass(this)})},open(a,b,d){const c=ThemifyBuilderCommon.Lightbox,m=f.document,l=m.getElementById("tb_lightbox_container"),e=function(e){c.$lightbox[0].style.display=
"none";for("function"===typeof b&&b.call(c,e);l.firstChild;)l.removeChild(l.firstChild);"string"===typeof e?l.innerHTML=e:l.appendChild(e);e=m.body.classList.contains("tb_standalone_lightbox");var p=null;if(!1===e){var n={top:100,left:Math.max(0,g(f).width()/2-300),width:600,height:500};_.extend(n,c.getLightboxStorage())}else n={top:"",left:"",width:"",height:""};for(var h in n)c.$lightbox[0].style[h]=""!==n[h]?n[h]+"px":"";!1===e&&(!0===c.dockMode.get()?(c.dockMode.setDoc(),p=!0):c.fixContainment());
"function"===typeof d&&d.call(c,l);null===p&&c.resizable.setupLightboxSizeClass(n.width);c.$lightbox[0].style.display="block";c.$lightbox.triggerHandler("themify_opened_lightbox");if("inline"!==a.loadMethod)for(h=l.getElementsByClassName("tb_tabs"),e=h.length-1;-1<e;--e)for(n=h[e].getElementsByTagName("a"),p=n.length-1;-1<p;--p)n[p].addEventListener("click",ThemifyConstructor.switchTabs);"visual"===tb_app.mode&&g(k).triggerHandler("mouseup");tb_app.Instances.Builder[tb_app.builderIndex].lastRowShowHide()};
"inline"===a.loadMethod?(h.body.triggerHandler("themify_builder_lightbox_close"),m.body.classList.remove("tb_standalone_lightbox"),e(ThemifyConstructor.run(a.templateID))):"html"===a.loadMethod?(tb_app.autoSaveCid=null,c.close(!0),!0===a.contructor?e(ThemifyConstructor.run(a.data,a.save)):e(a.data)):(ThemifyBuilderCommon.showLoader("show"),tb_app.autoSaveCid=null,c.close(!0),a.data.nonce=themifyBuilder.tb_load_nonce,a=_.defaults(a||{},{type:"POST",url:themifyBuilder.ajaxurl}),g.ajax(a).done(function(b){!0===
a.contructor?e(ThemifyConstructor.run(b)):e(b);ThemifyBuilderCommon.showLoader("spinhide")}))},close(a){const b=ThemifyBuilderCommon.Lightbox;h.body.triggerHandler("themify_builder_lightbox_before_close");"visual"===tb_app.mode&&f.jQuery("body").trigger("themify_builder_lightbox_close",a);a||(b.$lightbox[0].style.display="none",tb_app.autoSaveCid=null);b._cleanLightBoxContent();a||(tb_app.undoManager.updateUndoBtns(),"visual"===tb_app.mode&&g(k).triggerHandler("mouseup"),tb_app.Instances.Builder[tb_app.builderIndex].lastRowShowHide(!0),
tb_app.Utils.removeViewPortClass(b.$lightbox[0]));tb_app.ActionBar.hoverCid=null;tb_app.ActionBar.clearSelected();h.body.triggerHandler("themify_builder_lightbox_close",a)},dockMode:{key:"themify_builder_docked",leftKey:"themify_builder_docked_left",workspace:f.document.body.getElementsByClassName("tb_workspace_container")[0],minEl:null,width:322,isDocked:null,isLeft:null,set(a){(this.isDocked=a)?(localStorage.setItem(this.key,a),this.isLeft?localStorage.setItem(this.leftKey,!0):localStorage.removeItem(this.leftKey)):
(localStorage.removeItem(this.key),localStorage.removeItem(this.leftKey));h.body.triggerHandler("themify_builder_resize_lightbox")},get(){return"visual"===tb_app.mode&&(null===this.isDocked&&(this.isDocked="true"===localStorage.getItem(this.key)),!0===this.isDocked)?(this.isLeft="true"===localStorage.getItem(this.leftKey),!0):!1},minimize(a){a.stopPropagation();a=f.document.body.classList;a.contains("tb_panel_minimized")?a.remove("tb_panel_minimized"):a.add("tb_panel_minimized");tb_app.Utils._onResize(!0)},
setDoc(){null===tb_app.toolbar.getStorage()&&localStorage.setItem(this.key,!0);if(this.get()){const a=f.document.body.classList,b=tb_app;a.contains("tb_panel_docked")?ThemifyBuilderCommon.Lightbox.resizable.setupLightboxSizeClass(this.width):(a.add("tb_panel_docked"),this.isLeft?(a.add("tb_panel_left_dock"),a.remove("tb_panel_right_dock")):(a.add("tb_panel_right_dock"),a.remove("tb_panel_left_dock")),b.Utils._onResize(!0),ThemifyBuilderCommon.Lightbox.resizable.setupLightboxSizeClass(this.width),
h.body.triggerHandler("themify_builder_resize_lightbox"),this.minEl=tb_app.toolbar.el.getElementsByClassName("tb_docked_minimize")[0],this.minEl.addEventListener("click",this.minimize,{passive:!0}),b.Views.Toolbar.prototype.removeFloat(),b.Views.Toolbar.prototype.openFloat(),b.Views.Toolbar.prototype._setResponsiveTabs())}},drag(a,b){if("visual"===tb_app.mode&&!this.get()){const d=f.document.body.classList;if(!d.contains("tb_standalone_lightbox")){const c=a.pageX+20>=f.innerWidth;a=a.type;this.isLeft=
!c&&0>b.offset.left;(c||this.isLeft)&&"drag"===a?(d.add("tb_dock_highlight"),this.isLeft?d.add("tb_dock_left_highlight"):d.remove("tb_dock_left_highlight")):d.remove("tb_dock_highlight","tb_dock_left_highlight");(c||this.isLeft)&&"dragstop"===a&&(this.set(!0),this.setDoc())}}},close(a){if("visual"===tb_app.mode&&this.get()){var b=ThemifyBuilderCommon.Lightbox,d=f.document.body.classList,c=b.getLightboxStorage();c={width:c.width?c.width:b.resizable.minWidth,height:c.height?c.height:b.resizable.minHeight,
top:f.innerHeight/2-b.$lightbox.innerHeight()/2,left:f.innerWidth/2-b.$lightbox.innerWidth()/2};b.$lightbox.css(c);a&&f.document.body.classList.contains("tb_panel_closed")&&tb_app.Views.Toolbar.prototype.openFloat();if(this.isLeft||!a)a?this.isLeft?d.remove("tb_panel_right_dock"):d.remove("tb_panel_left_dock"):(d.remove("tb_panel_left_dock","tb_panel_right_dock","tb_panel_docked"),null!==this.minEl&&(this.minEl.removeEventListener("click",this.minimize,{passive:!0}),this.minEl=null),null!==tb_app.activeModel&&
localStorage.getItem("tb_panel_closed")&&tb_app.Views.Toolbar.prototype.closeFloat(),tb_app.Views.Toolbar.prototype.setFloat(),d.contains("tb_standalone_lightbox")||this.set(null));b.resizable.setupLightboxSizeClass(c.width);tb_app.Utils._onResize(!0)}}},_cleanLightBoxContent(){let a=this.$lightbox.find("#tb_lightbox_container")[0];for(;null!==a.firstChild;)a.removeChild(a.firstChild);for(a=this.$lightbox[0].getElementsByClassName("tb_options_tab")[0];null!==a.firstChild;)a.removeChild(a.firstChild);
for(a=this.$lightbox[0].getElementsByClassName("tb_lightbox_actions_wrap")[0];null!==a.firstChild;)a.removeChild(a.firstChild);for(a=this.$lightbox[0].getElementsByClassName("tb_action_breadcrumb")[0];null!==a.firstChild;)a.removeChild(a.firstChild)},controlByKeyInput(){function a(a){if(27===a.keyCode&&tb_app.activeModel)a.preventDefault(),a.stopPropagation(),ThemifyBuilderCommon.Lightbox.close();else if(83===a.which&&(!0===a.ctrlKey||!0===a.metaKey)&&"INPUT"!==window.top.document.activeElement.tagName&&
"TEXTAREA"!==window.top.document.activeElement.tagName){a.preventDefault();a.stopPropagation();a=tb_app.activeModel?g(".builder_save_button",ThemifyBuilderCommon.Lightbox.$lightbox):null;if(null===a||0===a.length)a=tb_app.toolbar.$el.find(".tb_toolbar_save");a.click()}}g(k).on("keydown.tb_shortcut",a);if("visual"===tb_app.mode)g(f.document).on("keydown.tb_shortcut",a)},responsiveTabs(){var a=null,b,d,c=null,m=function(h,e,m){setTimeout(function(){if("styling"===ThemifyConstructor.clicked){a:{var e=
null===a?f.document.getElementById("tb_options_styling"):null;null===a&&(a=e.getElementsByClassName("tb_tabs")[0]);if(void 0!==a){if(!d)if(b=a.getElementsByTagName("ul")[0],void 0!==b)if(e=b.getElementsByTagName("li"),e=e[e.length-1],e=g(e),a=g(a),"rtl"===k.dir){const b=e.outerWidth();d=window.innerWidth-(e.offset().left+b)+b-(window.innerWidth-(a.offset().left+a.outerWidth()))}else d=e.offset().left+e.outerWidth()-a.offset().left;else break a;a.innerWidth()<=d?(a[0].classList.add("tb_compact_tabs"),
b.classList.add("tb_ui_dropdown_items"),null===c&&(c=k.createElement("span"),c.className="tb_ui_dropdown_label",c.tabIndex="-1",c.textContent=b.getElementsByClassName("current")[0].textContent,b.parentNode.insertBefore(c,b))):(a[0].classList.remove("tb_compact_tabs"),b.classList.remove("tb_ui_dropdown_items"))}}"themify_builder_tabsactive"===h.type&&null!==c&&(c.textContent=b.getElementsByClassName("current")[0].textContent)}},4)};h.body.on("themify_builder_tabsactive themify_builder_resize_lightbox",
m).on("themify_builder_lightbox_close",function(){a=b=d=c=null});this.$lightbox.on("themify_opened_lightbox",m)}},LiteLightbox:{modal:null,confirmView:Backbone.View.extend({template:wp.template("builder_lite_lightbox_confirm"),className:"tb_lite_lightbox_content",initialize(a){this.options=a||{}},render(){this.el.innerHTML=this.template({message:this.options.message,buttons:this.options.buttons})},events:{"click button":"buttonClick"},buttonClick(a){a.preventDefault();this.trigger("litelightbox:confirm",
g(a.currentTarget).data("type"))}}),promptView:Backbone.View.extend({template:wp.template("builder_lite_lightbox_prompt"),className:"tb_lite_lightbox_content",initialize(a){this.options=a||{}},render(){this.$el.html(this.template(this.options))},events:{"click button":"buttonClick","keypress .tb_litelightbox_prompt_input":"keyPress"},buttonClick(a){a.preventDefault();this.trigger("litelightbox:prompt",g(a.currentTarget).data("type"),this.$el.find(".tb_litelightbox_prompt_input").val())},keyPress(a){13===
a.which&&this.trigger("litelightbox:prompt","ok",g(a.currentTarget).val())}}),confirm(a,b,d){d=_.defaults(d||{},{buttons:{no:{label:"No"},yes:{label:"Yes"}}});d.message=a;a=new ThemifyBuilderCommon.LiteLightbox.confirmView(d);ThemifyBuilderCommon.LiteLightbox.modal.content(a);ThemifyBuilderCommon.LiteLightbox.modal.open();a.on("litelightbox:confirm",function(a){ThemifyBuilderCommon.LiteLightbox.modal.close();g.isFunction(b)&&b.call(this,a)})},prompt(a,b,d){d=_.defaults(d||{},{buttons:{cancel:{label:"Cancel"},
ok:{label:"OK"}}});d.message=a;a=new ThemifyBuilderCommon.LiteLightbox.promptView(d);ThemifyBuilderCommon.LiteLightbox.modal.content(a);ThemifyBuilderCommon.LiteLightbox.modal.open();a.on("litelightbox:prompt",function(a,d){ThemifyBuilderCommon.LiteLightbox.modal.close();g.isFunction(b)&&b.call(this,"cancel"===a?null:d)})},alert(a){ThemifyBuilderCommon.LiteLightbox.confirm(a,null,{buttons:{yes:{label:"OK"}}})}},templateCache:{templates:[],get(a){if(void 0===this.templates[a]){const b=k.getElementById(a);
this.templates[a]=b.innerHTML;setTimeout(function(){b.parentNode.removeChild(b)},6E3)}return this.templates[a]}},setToolbar(){const a=k.getElementById("tb_toolbar_template"),b=a.content;"visual"===tb_app.mode?k.body.appendChild(b):a.parentNode.insertBefore(b,a);a.parentNode.removeChild(a)},isImageUrl(a){if("undefined"===typeof a||""==a)return!1;a=a.split("?")[0].split(".");return-1!=="jpg jpeg tiff png gif bmp svg".split(" ").indexOf(a[a.length-1])}}})(jQuery,Themify,window.top,document);
